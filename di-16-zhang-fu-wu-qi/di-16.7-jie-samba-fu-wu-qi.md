Section 16.7 Samba Server

Samba is the re-entry of SMB/CIFS (Server Message Block, Server Message Block) protocols. CIFS (Common Internet File System, General Internet File System) is a derivative agreement for SMB.

Samba is also the Portuguese/English equivalent of “samba”. There's a sense of enthusiasm.

samba tcp/139, 445 port to open firewall; ddp/137, 138 port.

# Install samba

- Install with pkg:

```sh '
# pkg install samba420
````

- or install with Ports:

```sh '
#cd/usr/ports/net/samba420/
# Make install clean
````

# See after installation

```sh '
# pkginfo-D samba420
samba420-4.20.7_4:
On installation:
How to start: http://wiki.samba.org/index.php/Samba4/HOWTO
How to start: See official guide

? Your compliance is: /usr/local/etc/smb4.conf
:: Your profile path is: /usr/local/etc/smb4.conf

All the relevant data are under: /var/db/samba4
:: All relevant databases are located at:/var/db/samba4

All the logs are under: /var/log/samba4
:: All logs are located at:/var/log/samba4

*Provisioning script is: /usr/local/bin/samba-tool
* # Initialized script: /usr/local/bin/samba-tool

For the working DNS updates you will need to either build dns/ bind9*
# If you need to use the DNS update function properly, you need:
With the available GSSAPI
# Or build the dns/bind9* that enabled GSSAPI (recommended GCSSAPI_MIT5)
I don't know if I'm going to be able to do this, but I'm not going to do this.
# Or install dns/samba-nsupdate packages, which pre-configure the required support.

You will need to share the 'nsupdate' community in the
Smb4.conf file:
# You need to specify the location of the nsupdate command in smb4.conf:

= /usr/local/bin/samba-nsupdate-g # Example Configuration

For ad hoc documentation check: https://wiki.samba.org/index.php/User_Documentation
# More documents are available:

Port relaid bug reports can go to the https://gitlab.com/samba-freebsd/ports/-/issues or
# Issues related to FreeBSD port should be submitted to:

To the FreeBSD Bugzilla https://bugs.freebsd.org/

# All issues related to Samba itself can be submitted to:
All Samba returned bug reports should go to the: https://bugzilla.samba.org/
````

# Configure samba

- Configure services

```sh '
♪ With service samba ♪
````

- Create `/usr/local/etc/smb4.conf ' with the following addition and save


```ini '
[global]
= SMB2

[root]
This post is part of our special coverage Global Development 2011.
Path = / root
= no
= yes
= yes
printable = no
= 0755
````

Annotations:

- `[global] ' : global configuration, applicable to all shared items.
- `min protocol = SMB2 ': limit the minimum support protocol to SMB2 to facilitate high-end Windows access
- `[root] ' : define a sharing called `root ' .
- `Commment = root's stuff ' : This shared description is visible in Windows browsers.
- `path = /root ' : the actual path for sharing is `/root ' ,** not recommended ** shared in the physical environment.
- `public = no ' : no anonymous access is allowed (equivalent to `guest ok = no ' ).
- `browseable = yes ' : shares can be viewed among network neighbours.
- `writable = yes ' : Allows the client to write to the directory.
- `printable = no ' : not printer sharing.
- `create mask = 0755 ' : Default permission to create a new file is 755, owner reads and writes, group and other users read only.

I don't...

- Create samba root user and configure password:

```sh '
# Smbpasswd-a root
````

- Start service.

```sh '
# With service samba #
````


- View samba status:

```sh '
# With service samba #
It's running as pid 1520.
Smbd is running as pid 1525.
````

- Access to shared folders under Windows using the following command (subject to actual IP, copy not working):

>** Skills**
>
> Visit share folder description under Windows: Press Windows + **R** (lowcase r can also) to open the Run dialogue box. Enter the following command in the dialogue box (replaces the contents of the example with the actual IP address and the shared folder name):

```Batch '
\\192.168.179.150
````

![.. ..gitbook/assets/samba1.png]

Enter the username `root ' just created and the password:

![.. ..gitbook/assets/samba2.png]

Connection success:

![.. .gitbook/assets/samba3.png]

Set Samba as a domain member

Environment: freebsd 12

Configure static IP addresses

Use the following command configuration:

```sh '
# bsdconfig
````

Configure hostname

The host name should be configured at the time the system is installed and you can view or edit settings at `/etc/rc.conf ' :

```sh '
Hostname=fb
````

Configure DNS

Edit `/ec/resolv.conf ' to read:

```sh '
♪ Generalized by
SVROS.COM //Setting Field Control Domain Name
# nameserver 192,168.253.2

Nameserver 192.168.253.130 // Setup domain controller IP address
Nameserver 223.5.5.5
Nameserver 127.0.0.1
I don't know, options edns0.
````

# # Modify '/etc/syscl.conf '

```sh '
# echo "kern.maxfiles=25600" > /etc/syscl.conf
# echo "kern.maxfilesperproc=16384" > /etc/syscl.conf
# echo "net.inet.tcp.sendspace=65536" > /etc/syscl.conf
#echo "net.inet.tcp.recvspace=65536" > /etc/syscl.conf
````

## Create '/etc/krb5.conf '

```ini '
[libdefaults]
Default_realm = SVROS.COM // set domain name
= true
= true
= 24h
= 7d
= yes
````

# # Modify '/etc/nsswitch.conf '

```sh '
# sed-i-e "s/passwd: */passwd: files winbind/"/etc/nsswitch.conf
# sed-i-e "s/group:.*/group: files winbind/"/etc/nsswitch.conf
````

## Create '/usr/local/etc/smb4.conf '

```ini '
[global]
Workgroup = SVROS
Server string = Samba Server Version %v
Security = ads
Realm = SVROS.COM
= no
= no
= no
Socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBF=131072 SO_SNDBUF=131072
= true

:back = tdb
:range = 100,000-299999
idmap config SVROS: back
idmap config SVROS :range = 10000-99999
= +
== sync, corrected by elderman ==
♪ We've got a lot of work to do ♪
♪ We're going to die ♪
♪ We've got a lot of work to do ♪
== sync, corrected by elderman == @elder_man
template homedir = /home/%D/%U
template shell = /bin/ false

I'm sorry.
= yes
= yes
=2
Log file = /var/log/samba4/log.%m
=50

== sync, corrected by elderman == @elder_man

[testshare]
This post is part of our special coverage Syria Protests 2011.
Path = /samba/testshare
= no
"Domain Users"
= 0770
= 0770
= 0660
= 0660
````

Optimization of physical access to the last two lines of "testshare" above (optional)

```sh '
= 0750
= 0750
````

Add samba to the field

```sh '
I'm not sure if you're going to do this.
I don't know what you're talking about.
♪ Should report "Join is OK"
♪ On your DC, open the DNS MMC and add an "A" entry for your BSD service so clients can find it
````

# # make samba start and set to start self-start

```sh '
# echo "samba_server_enable=YES" / etc/rc.conf
# echo "winbindd_enable=YES" / etc/rc.conf
# With service samba #
````

# # Test Kerberos

```sh '
I don't know.
♪ Enter domain admin password, it should return to the program with no priorities
klist
#Credentials Cache: FILLE: /tmp/krb5cc_0
#Priscipal: administrator
# I don't know
IssuedExpicipal
# Dec 6 10:15:39 2021 Feb 4 20:15:39 2021 krbtgt
````

# # Test Winbind

```sh '
Wbinfo-u
# Should return the domain user list

Wbinfo-g
# Should return the list of domain user groups

Now passwd
# The user list should end with a domain user with UID greater than 10000

Oh, get group
# The end of the user group list should include domain user groups with GIDs greater than 10000
````

# # Execute if wbinfo command shows error

```sh '
# With service samba #
````

# # Create shared folders

```sh '
#mkdir-p/samba/testshare
# Down "administrator": "domain uss"/samba/testshare
# medium 0770 / samba/testshare
````

If only the owner is allowed to read and write, only the group is allowed to read, set as follows:

```sh '
#chmod 0750/samba/testshare
````

If only the owner is allowed to read and write, the group and others cannot read and write, set with the following command:

```sh '
# medium-R0700/samba/testshare
````

# The failure and the lack of competition

The Samba log is located at `/var/log/samba4 ' .
。