Section 16.3 Gitlab-EE

# Install Gitlab-EE

```sh
# pkg install gitlab-ee
```

Or use Ports:

This Port also contains Gitlab CE (Community version). To install EE (Enterprise version), it must be specified that __CODESPAN_0_:

```sh
# cd /usr/ports/www/gitlab/
# make FLAVORS=ee install clean
```

# # See after installation

```sh
# pkg info -D  gitlab-ee
gitlab-ee-17.8.2_1:
On install:
Gitlab was installed successfully.
# GitLab 已成功安装。

You now need to set up the various companies of Gitlab, so please
follow the instructions in the side at:

https://gitlab.com/mfechner/freebsd-gitlab-docu/blob/master/install/17.8-freebsd.md
# Next you need to configure GitLab components。
# Please refer to the FreeBSD installation guide link above for settings。

On upward from gitlab-ee <11.9.7:
Please make sure you read in UPDATING!
# If you upgrade from an old version below 11.9.7
# Please read the entries in the ___CODESPAN_0_file 20190423 in FreeBSD reports

On upward:
If you just incorporated an Major upgrad of Gitlab, for example you
switched from 17.5.x to 17.6.x, please follow the instructions in the side at:

https://gitlab.com/mfechner/freebsd-gitlab-docu/blob/master/update/17.7-17.8-freebsd.md
# if you upgrade the main version (e.g. from 17.5 to 17.6.x)
# Please follow the upgraded guidelines above。

If you just incorporated an individual upward of GitLab please follow
i don't know, the instructions in the side at:

https://gitlab.com/mfechner/freebsd-gitlab-docu/blob/master/update/freebsd_pact_versions.md
# If it's just a small upgrade (e.g. from 17.8.1 to 17.8.2)
# See the updated guide for the patches above。
````

the developers have completed their installation instructions at <https://gitlab.com/mfechner/freebsd-gitlab-docu/blob/master/install/17.8-freebsd.md>

if you want to sponsor the developer:

# Start service

```sh
# service gitlab enable
```

# PostgreSQL

The current Gitlab supported PostgreSQL version is 16 or more

```sh
# pkg install postgresql16-server postgresql16-contrib
```

or

```sh
# cd /usr/ports/databases/postgresql16-server/ && make install clean
# cd /usr/ports/databases/postgresql16-contrib/ && make install clean
```

# Initialize the database #


```sh
# service postgresql enable
# service postgresql initdb
# su - postgres
$ /usr/local/bin/pg_ctl -D /var/db/postgres/data16 -l logfile start
```

# # Create Database Related

```sql
$ psql -d template1 -U postgres -c "CREATE USER git CREATEDB SUPERUSER PASSWORD 'password';" # 将数据库密码设置为 password
CREATE ROLE
$ psql -d template1 -U postgres -c "CREATE DATABASE gitlabhq_production OWNER git;"
CREATE DATABASE
$ psql -U git -d gitlabhq_production
psql (16.8)
Type "help" for help.
gitlabhq_production-# \q
$ exit
```

# # SWITCH BACK __CODESPAN_0_

```sh
# psql -U postgres -d gitlabhq_production -c "CREATE EXTENSION IF NOT EXISTS pg_trgm;"
# psql -U postgres -d gitlabhq_production -c "CREATE EXTENSION IF NOT EXISTS btree_gist;"
# psql -U postgres -d gitlabhq_production -c "CREATE EXTENSION IF NOT EXISTS plpgsql;"
```

# Configure Redis

Redis has automatically been installed as a dependent。

View post-installation information:

```sh
root@ykla:/ # pkg info -D redis
redis-7.4.2:
On install:
To setup "redis" you need to edit the configuration file:
      /usr/local/etc/redis.conf
# 要配置 Redis，你需要编辑配置文件：
# /usr/local/etc/redis.conf

To run redis from startup, add redis_enable
in your /etc/rc.conf.
# In order for Redis to run automatically on system startup, the following rows should be added to the /etc/rc.conf file:
♪ Retis_enable ♪
````

# # configure socket

```sh
root@ykla:/ # echo 'unixsocket /var/run/redis/redis.sock' >> /usr/local/etc/redis.conf
root@ykla:/ # echo 'unixsocketperm 770' >> /usr/local/etc/redis.conf
```

Configure services

```sh
root@ykla:/ # service redis enable
redis enabled in /etc/rc.conf
root@ykla:/ # service redis restart
redis not running? (check /var/run/redis/redis.pid).
Starting redis.
```

Configure user privileges

ADD __CODESPAN_0_USER TO __CODESPAN_1_GROUP

```sh
# pw groupmod redis -m git
```


# Configure guit (configuring Git global settings for guit users)

```sh
root@ykla:/ # su -l git -c "git config --global core.autocrlf input" # Web 编辑器需要
root@ykla:/ # su -l git -c "git config --global gc.auto 0" #  GitLab 在需要时会自动运行 git gc
root@ykla:/ # su -l git -c "git config --global repack.writeBitmaps true" # 加速仓库的对象访问和克隆操作
root@ykla:/ # su -l git -c "git config --global receive.advertisePushOptions true" # 允许服务器在 git push 时支持推送参数
root@ykla:/ # su -l git -c "git config --global core.fsync objects,derived-metadata,reference" # 减少服务器崩溃时存储库损坏的风险
root@ykla:/ # su -l git -c "mkdir -p /usr/local/git/.ssh" # 确保 .ssh 目录存在
root@ykla:/ # su -l git -c "mkdir -p /usr/local/git/repositories" # # 确保存储库目录存在，并设置正确的权限，下同
root@ykla:/ # chown git /usr/local/git/repositories
root@ykla:/ # chgrp git /usr/local/git/repositories
root@ykla:/ # chmod 2770 /usr/local/git/repositories
```

# Configure Gitlab

THE PROFILE PATH IS __CODESPAN_0_。

## adjust Gitlab load

```sh
root@ykla:/ # sysctl hw.ncpu
hw.ncpu: 16
```

EDIT __CODESPAN_0, REPLACE __CODESPAN_1 WITH THE VALUE OF THE OUTPUT ABOVE, I.E. __CODESPAN_2_。

## Configure GitLab Database

- EDIT __CODESPAN_0:

AMEND __CODESPAN_0 TO `password: "password"`_ (__CODESPAN_2_ IS THE DATABASE PASSWORD SET ABOVE)


- GitLab needs write permissions to create a symbol link:

```sh
# chown git /usr/local/share/gitlab-shell  
```

```sh
root@ykla:/ #cd /usr/local/www/gitlab # 注意路径
root@ykla:/usr/local/www/gitlab # su -l git -c "cd /usr/local/www/gitlab && rake gitlab:setup RAILS_ENV=production" #  初始化 GitLab 数据库和相关配置
Missing Rails.application.credentials.secret_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.otp_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.db_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.openid_connect_signing_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_primary_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_deterministic_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_key_derivation_salt for production environment. The secret will be generated and stored in config/secrets.yml.
Creating a backup of secrets file: /usr/local/www/gitlab/config/secrets.yml: /usr/local/www/gitlab/config/secrets.yml.orig.1740894999
This will create the necessary database tables and seed the database.
You will lose any previous data stored in the database.
Do you want to continue (yes/no)? yes # 此处输入 yes 按回车键

Drapped data 'getlabhq_protection'
Created data 'getlabhq_protection'

== sync, corrected by elderman == @elder_man
Creating the default ApplicationSetting record.
= /usr/local/www/gitlab/db/fixtures/prevention/001_application_settings.rb took 0.56 seconds

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/protection/002_default_organization.rb took 0.04 seconds

=Sed from/usr/local/www/gitlab/db/fixtures/project/003_admin.rb
Administrator account created:

login: root # note username
you'll be prepared to create one on your first visit.

== sync, corrected by elderman == @elder_man

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/prevention/004_create_base_work_item_types.rb took 0.05 seconds

== sync, corrected by elderman == @elder_man

OKAY
== sync, corrected by elderman == @elder_man

=Sed from/usr/local/www/gitlab/db/fixtures/project/010_settings.rb
Saved CI JWT signing key
Saved CI Job Token signing key
== sync, corrected by elderman == @elder_man

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/project/020_create_work_item_hierarchy_restrations.rb took 0.03 seconds

== sync, corrected by elderman == @elder_man

OKAY
== sync, corrected by elderman == @elder_man

=Sed from ee/db/fixtures/prevention/010_license.rb
=ee/db/fixtures/project/010_license.rb took 0.00 seconds

=Sed from ee/db/fixtures/protection/027_plans.rb

OKAY
=ee/db/fixtures/project/027_plans.rb took 0.02 seconds

== sync, corrected by elderman == @elder_man

OKAY
=ee/db/fixtures/project/041_create_ai_settings.rb took 0.02 seconds
== sync, corrected by elderman ==
````

Withdrawal of authority just granted:

```sh
# chown root /usr/local/share/gitlab-shell
```

- Check that Gitlab and its environment are properly configured

```sh
root@ykla:/usr/local/www/gitlab # su -l git -c "cd /usr/local/www/gitlab && rake gitlab:setup RAILS_ENV=production"
Missing Rails.application.credentials.secret_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.otp_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.db_key_base for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.openid_connect_signing_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_primary_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_deterministic_key for production environment. The secret will be generated and stored in config/secrets.yml.
Missing Rails.application.credentials.active_record_encryption_key_derivation_salt for production environment. The secret will be generated and stored in config/secrets.yml.
Creating a backup of secrets file: /usr/local/www/gitlab/config/secrets.yml: /usr/local/www/gitlab/config/secrets.yml.orig.1740894999
This will create the necessary database tables and seed the database.
You will lose any previous data stored in the database.
Do you want to continue (yes/no)? yes

Drapped data 'getlabhq_protection'
Created data 'getlabhq_protection'

== sync, corrected by elderman == @elder_man
Creating the default ApplicationSetting record.
= /usr/local/www/gitlab/db/fixtures/prevention/001_application_settings.rb took 0.56 seconds

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/protection/002_default_organization.rb took 0.04 seconds

=Sed from/usr/local/www/gitlab/db/fixtures/project/003_admin.rb
Administrator account created:

i'm sorry
you'll be prepared to create one on your first visit.

== sync, corrected by elderman == @elder_man

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/prevention/004_create_base_work_item_types.rb took 0.05 seconds

== sync, corrected by elderman == @elder_man

OKAY
== sync, corrected by elderman == @elder_man

=Sed from/usr/local/www/gitlab/db/fixtures/project/010_settings.rb
Saved CI JWT signing key
Saved CI Job Token signing key
== sync, corrected by elderman == @elder_man

== sync, corrected by elderman == @elder_man

OKAY
= /usr/local/www/gitlab/db/fixtures/project/020_create_work_item_hierarchy_restrations.rb took 0.03 seconds

== sync, corrected by elderman == @elder_man

OKAY
== sync, corrected by elderman == @elder_man

=Sed from ee/db/fixtures/prevention/010_license.rb
=ee/db/fixtures/project/010_license.rb took 0.00 seconds

=Sed from ee/db/fixtures/protection/027_plans.rb

OKAY
=ee/db/fixtures/project/027_plans.rb took 0.02 seconds

== sync, corrected by elderman == @elder_man

OKAY
=ee/db/fixtures/project/041_create_ai_settings.rb took 0.02 seconds
== sync, corrected by elderman ==
````

Change permission:

```sh
root@ykla:/usr/local/www/gitlab # chown root /usr/local/share/gitlab-shell
```

Compilation resources:

```sh
root@ykla:/usr/local/www/gitlab # su -l git -c "cd /usr/local/www/gitlab && rake gitlab:env:info RAILS_ENV=production"

System Information
System:
Proxy: no
Current User:git
Using RVM:no
Ruby Version: 3.2.7
Gem Version: 3.6.4
Bundler Version: 2.6.4
Rake Version: 13.2.1
Redis Version: 7.4.2
Sidekiq Version: 7.2.4
Go Version: unknown

GitLab Information
Version: 17.8.2-ee
Revision: Unknown
Directory: /usr/local/www/gitlab
DB Adapter: PostgreSQL
DB Version: 16.8
URL: http://localhost
HTTP Clane URL: http://localhost/some-group/some-project.git
SSH Clone URL: git@localhost: come-group/some-project.git
Elasticsearch: No
Geo:no
Using LDAP: no
Using Omniauth: yes
Omniath Providers:

Gitlab Shell
Version: 14.39.0
Repository documents:
-default: unix:/usr/local/www/gitlab/tmp/sockets/private/gitaly.socket
GitLab Shell Path: /usr/local/share/gitlab-shell

Gitaly
i don't know!
GRPC: Unable: 14:conventions to all backends working; last error: FAILED_PRONDITION: unix: /usr/local/www/gitlab/tmp/sockets/private/gitaly.socket: confect Failed: Adr: unix:/usr/local/www/gitlab/tmp/sockets/privat/gitaly/gita/gita/err: 14c/eg/ / / / / / / / / / / / _: / / / / / / / / / / / / / / / / / _( _ _ _ _ _ _( _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
/usr/local/www/gitlab/lib/gitlab/gitaly_client.rb: 291 in `execute'
/usr/local/www/gitlab/lib/gitlab/gitaly_client/call.rb:18:in `block in call'
/usr/local/www/gitlab/lib/gitlab/gitaly_client/call.rb:60:in `recording_request'
/usr/local/www/gitlab/lib/gitlab/gitaly_client/call.rb:17:in `call'
/usr/local/www/gitlab/lib/gitlab/gitaly_client.rb: 280:in `call'
/usr/local/www/gitlab/lib/gitlab/gitaly_client/server_service.rb:14:in `info'
/usr/local/www/gitlab/lib/tasks/gitlab/info.rake:99:in `block (4 levels) in <top (required)'
/usr/local/www/gitlab/lib/tasks/gitlab/info.rake:97:in `blocks (3 levels) in <top (required)>'
Tasks: TOP =
See full face by running task with-trace
````

- If you're using the code.js

Authorizes:

```sh
root@ykla:/ # chown git /usr/local/www/gitlab/package.json
```

Set the Python version, using __CODESPAN_0_ for preset reading:

```sh
root@ykla:/ # ls /usr/local/bin/python3.11
/usr/local/bin/python3.11
```

After confirmation:

```
root@ykla:/ # su -l git -c "cd /usr/local/www/gitlab && yarn config set python /usr/local/bin/python3.11"
yarn config v1.22.19
success Set "python" to "/usr/local/bin/python3.11".
Done in 0.03s.
```

Compilation resources:

```sh
root@ykla:/ # su -l git -c "cd /usr/local/www/gitlab && yarn install --production --pure-lockfile"
yarn install v1.22.19
$ node ./scripts/frontend/preinstall.mjs
[WARNING] package.json changed significantly. Removing node_modules to be sure there are no problems.
[1/5] Validating package.json...
[2/5] Resolving packages...
[3/5] Fetching packages...
[4/5] Linking dependencies...

.

[7/8] tile-setter-json [7/8] tile-setter-json
[7/8] testosterone
[-8] waiting...
[-8] waiting...
while you're on "1.22.19".
Done in 109.27s.
````

Continue to compile resources:

```sh
# su -l git -c "cd /usr/local/www/gitlab && RAILS_ENV=production NODE_ENV=production USE_DB=false SKIP_STORAGE_VALIDATION=true bundle exec rake gitlab:assets:compile"

...it would take about 10 minutes to omit, and in general, it would take two more times if the memory spills were indicated, and if the memory spills were repeated

The file does not involve any side effects, we are all good.
____CODESPAN_0_finished in 0.3715113498 seconds
````

- Remove Database Super Administrator

```sh
root@ykla:/ # psql -d template1 -U postgres -c "ALTER USER git WITH NOSUPERUSER;"
ALTER ROLE
```

- Start Gitlab

```sh
# service gitlab start

...and omitted..

Started in 45s.
The Gitlab service with Pid 8202 is running.
The Gitlab Sidekiq job director with Pid 8212 is running.
The Gitlab Work with Pid 8216 is running.
Gitaly with Pid 8218 is running.
Gitlab and all its companies are up and running.
````

# Nginx

# Install

```sh
# pkg install nginx
```

Or:

```
# cd /usr/ports/www/nginx/ 
# make install clean
```

## CONFIGURE __CODESPAN_0_

EDIT __CODESPAN_0_, FOUND

```ini
http {
    include       mime.types;
    default_type  application/octet-stream;

```

Amend to read as follows:

```ini
http {
    include       mime.types;
    default_type  application/octet-stream;
    include       /usr/local/www/gitlab/lib/support/nginx/gitlab; # 加入此行
```

# Configure Services

```sh
root@ykla:/ # service nginx enable
nginx enabled in /etc/rc.conf
root@ykla:/ #  service nginx start
Performing sanity check on nginx configuration:
nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok
nginx: configuration file /usr/local/etc/nginx/nginx.conf test is successful
Starting nginx.
```

# Configure Gitlab Pages

```sh
root@ykla:/ # su -l git -c "openssl rand -base64 32 > /usr/local/www/gitlab/.gitlab_pages_secret"
root@ykla:/ # chmod 640 /usr/local/www/gitlab/.gitlab_pages_secret
root@ykla:/ # chgrp gitlab-pages /usr/local/www/gitlab/.gitlab_pages_secret
```

# Start service #

```sh
# sysrc gitlab_pages_enable="YES"
# service gitlab_pages start
```

# Check configuration

```sh
root@ykla:/ # su -l git -c "cd /usr/local/www/gitlab && rake gitlab:check RAILS_ENV=production"
Checking GitLab subtasks ...

Checking Gitlab Shell...

GitLab Shell: ... GitLab Shell > = 14.39.0? OK (14.39.0)
Running/usr/local/share/gitlab-shell/bin/gitlab-shell-check
Internal API available: OK
Redis aviable via international API: OK
you know, glitlab-shell self-check relevant

Checking Gitlab Shell..

Checking Gitaly...

Gitaly:

Checking Gitaly..

Checking Sidekiq...

Sidekiq:
Number of Sidekiq programmes (cluster/worker) 1/1

Checking Sidekiq..

Checking Incoming Email...

Incoming Email: ...Reply by email is disabled in config/gitlab.yml

Checking Incoming Email..

Checking LDAP...

LDAP is disabled in config/gitlab.yml

Checking LDAP..

Checking Gitlab App...

Does that make sense
Tables are tricked
All migrations up
No, no, no
Gitlab config exists
Gitlab config up to date
Can config exists
Resque config exists
Log directable
I don't know
It's not like you're going to do it
The Upleads direct their missions
Uploads of directory tmp has proper permissions
No, no, no
Try fixing it:
Install the Service
For more information see:
"Install the Service"
Please fix the error above and run the checks.
Can't check because of previous officers
Projects have namesspace: can't check, you have no projects
Redis version > 6.2.14
Ruby > = 3.0.6 ? Yes (3.2.7)
I'm sorry, sir
Active users:...1
No, no
Trying to fix error obviously
Gitlab configured to store new projects in Hashed status
All projects are in Hashed status
Elesticsearch 7.x-8.x or OpenSearch 1.x
All migrations must be fulfilled before doing a major upgrad..

Checking Gitlab App..


Checking Gitlab subtasks..
````


# Start Gitlab

```sh
# service gitlab restart
```

OPEN THE BROWSER AND ENTER THE IP BACK TO THE CAR, WHERE MY NAME IS __CODESPAN_0_. PLEASE ENTER YOUR E-MAIL AND SET YOUR PASSWORD (MINIMUM 8 BIT, COMPLEX PASSWORD)。

![.. ..getbook/assets/getlab1.png]

Login:

![.. ..getbook/assets/gitlab2.png]

![.. ..gitbook/assets/gitlab3.png]

# Set Chinese

Click on your head, click on "Preference", find "Localization", select the Chinese language, then click "Save Changes":


![. . ..gitbook/assets/gitlab4.png]


# Activate

>** Warning**
>
> This part is for personal learning purposes only, and we do not have any responsibilities to use for commercial purposes. > Please support the original. (https://about.gitlab.com/pricing/)。

Installation of __CODESPAN_0_(gem is a ruby package manager, which has been installed as a dependent automatic:

```sh
root@ykla:~ # gem install gitlab-license
Fetching gitlab-license-2.6.0.gem
Successfully installed gitlab-license-2.6.0
Parsing documentation for gitlab-license-2.6.0
Installing ri documentation for gitlab-license-2.6.0
Done installing documentation for gitlab-license after 0 seconds
1 gem installed

A new basis of Ruby Gems is available: 3.6.4 – 3.6.5!
Run __CODESPAN to update your establishment.
````

```sh
root@ykla:~ # mkdir gitlab-license
root@ykla:~ # cd gitlab-license/
root@ykla:~/gitlab-license # ee license.rb
```

WRITE THE FOLLOWING TO __CODESPAN_0_

```ruby
require "openssl"
require "gitlab/license"
key_pair = OpenSSL::PKey::RSA.generate(2048)
File.open("license_key", "w") { |f| f.write(key_pair.to_pem) }
public_key = key_pair.public_key
File.open("license_key.pub", "w") { |f| f.write(public_key.to_pem) }
private_key = OpenSSL::PKey::RSA.new File.read("license_key")
Gitlab::License.encryption_key = private_key
license = Gitlab::License.new
license.licensee = {
"Name" => "ykla", # 你的用户名
"Company" => "CFC", # 你的机构
"Email" => "yklaxds@gmail.com", # 你的电子邮箱
}
license.starts_at = Date.new(2025, 1, 1) # 开始时间
license.expires_at = Date.new(2050, 1, 1) # 结束时间
license.notify_admins_at = Date.new(2049, 12, 1)
license.notify_users_at = Date.new(2049, 12, 1)
license.block_changes_at = Date.new(2050, 1, 1)
license.restrictions = {
active_user_count: 10000,
}
puts "License:"
puts license
data = license.export
puts "Exported license:"
puts data
File.open("GitLabBV.gitlab-license", "w") { |f| f.write(data) }
public_key = OpenSSL::PKey::RSA.new File.read("license_key.pub")
Gitlab::License.encryption_key = public_key
data = File.read("GitLabBV.gitlab-license")
$license = Gitlab::License.import(data)
puts "Imported license:"
puts $license
unless $license
raise "The license is invalid."
end
if $license.restricted?(:active_user_count)
active_user_count = 10000
if active_user_count > $license.restrictions[:active_user_count]
    raise "The active user count exceeds the allowed amount!"
end
end
if $license.notify_admins?
puts "The license is due to expire on #{$license.expires_at}."
end
if $license.notify_users?
puts "The license is due to expire on #{$license.expires_at}."
end
module Gitlab
class GitAccess
    def check(cmd, changes = nil)
    if $license.block_changes?
        return build_status_object(false, "License expired")
    end
    end
end
end
puts "This instance of GitLab Enterprise Edition is licensed to:"
$license.licensee.each do |key, value|
puts "#{key}: #{value}"
end
if $license.expired?
puts "The license expired on #{$license.expires_at}"
elsif $license.will_expire?
puts "The license will expire on #{$license.expires_at}"
else
puts "The license will never expire."
end
```

Generate relevant files:

```ruby
root@ykla:~/gitlab-license # ruby license.rb 
License:
#<Gitlab::License:0x00001333815f0f88>
Exported license:
eyJkYXRhIjoiZlhQdzNWWldFOTIrcHFrNUx1MlZqQXBaZkpQVi9yaHJxN0cy
T2pVK3dYZGk4dllHM1JTblR3S2N2YTYyXG5LTTJFVmlpMU1iZTZaaHFmOTJu
ZGRucTlpbHdRZ05OODZINkV2NCttbWx1bW95UnYyYVhtSjhPSkZjRzVcbjll
……省略一部分……
Q2hNd0ViZFJCNFlpK3R2M1dYMS9LXG4xendIMEVNWFJhT3dPN1BUaDd2Mngx
NVhvSTNxZTN3STFjNTFyOUFJeGc9PVxuIiwiaXYiOiIzcDByN01MelpSck10
K2YwbWhobEpRPT1cbiJ9
Imported license:
#<Gitlab::License:0x0000133381f3ece8>
This instance of GitLab Enterprise Edition is licensed to:
Name: ykla
Company: CFC
Email: yklaxds@gmail.com
The license will expire on 2050-01-01
```

Backup old public key:

```sh
# cp /usr/local/www/gitlab/.license_encryption_key.pub /usr/local/www/gitlab/.license_encryption_key.pub.back
```

Viewes the files in the directory. The new generation became three things:

```sh
root@ykla:~/gitlab-license # ls
GitLabBV.gitlab-license	license_key
license.rb		license_key.pub
```

Replace the old public key with the broken public key:

```sh
root@ykla:~/gitlab-license # cp license_key.pub /usr/local/www/gitlab/.license_encryption_key.pub
```

```sh
root@ykla:~/gitlab-license # cat GitLabBV.gitlab-license
eyJkYXRhIjoiZlhQdzNWWldFOTIrcHFrNUx1MlZqQXBaZkpQVi9yaHJxN0cy
T2pVK3dYZGk4dllHM1JTblR3S2N2YTYyXG5LTTJFVmlpMU1iZTZaaHFmOTJu
ZGRucTlpbHdRZ05OODZINkV2NCttbWx1bW95UnYyYVhtSjhPSkZjRzVcbjll
……省略一部分……
Q2hNd0ViZFJCNFlpK3R2M1dYMS9LXG4xendIMEVNWFJhT3dPN1BUaDd2Mngx
NVhvSTNxZTN3STFjNTFyOUFJeGc9PVxuIiwiaXYiOiIzcDByN01MelpSck10
K2YwbWhobEpRPT1cbiJ9
```

Open <http://192.168.197.128/admin/application_settings/general> (this is mine, with attention to changing to your IP address), click on "Add License", click on "Input Licence Key" and copy the output `GitLabBV.gitlab-license`_ above to the license box:

![.. ..gitbook/assets/gitlab10.png]

![.. ..gitbook/assets/gitlab8.png]

References

[GitLab EE 16 Install Cracker] (https://blog.menggui.com/articles/GitLab-Install.html)


# Import external items

open <http://192.168.197.128/admin>, click universal, select import and export settings on the right, select items needed, save them。

![.. ..getbook/assets/gitlab5.png]


![.. . ..gitbook/assets/gitlab6.png]


![...getbook/assets/getlab7.png]

References

- [CI/CD Notes. Gitlab Series: 2024 Update - Set Gitlab Import Source]



# Fragmentation and unfinished business


# Log

- CODESPAN_0_
- CODESPAN_0_
- CODESPAN_0_
- CODESPAN_0_

# CODESPAN_0__


```
root@ykla:/ # service gitlab status
The GitLab web server with pid 8202 is running.
The GitLab Sidekiq job dispatcher with pid 8212 is running.
The GitLab Workhorse with pid 8216 is running.
Gitaly with pid 8218 is running.
GitLab and all its components are up and running.
```


IF THE RUNNING STATE AND THE ERROR LOG ARE NORMAL, THEN THE MEMORY MAY HAVE SPILLED (AND NOT ENOUGH 8G):


```
# dmesg

...and omitted..

swap_pager: out of swap space
swp_pager_getswaspace(11) failed
swap_pager: out of swap space
swp_pager_getswaspace(27) failed
swp_pager_getswaspace(11) failed
swp_pager_getswapsspace(4): failed
swp_pager_getswaspace(1): failed
swp_pager_getswaspace (9): failed
swp_pager_getswaspace(1): failed
swp_pager_getswapsspace (20) failed
swp_pager_getswapsspace(4): failed
pid 7965 (node), jid 0, uid 211, was killed: failed to recover memory
7822 (ruby32), jid 0, uid 211, was killed:
````

If it is still a mistake 500, it is recommended that it be repeated。

References

- [Installation, backup, migration and reporting of Gitlab on Centos 7] (https://www.ifeegoo.com/the-installation-backup-mission-restore-of-gitlab-on-centos-7.html)


