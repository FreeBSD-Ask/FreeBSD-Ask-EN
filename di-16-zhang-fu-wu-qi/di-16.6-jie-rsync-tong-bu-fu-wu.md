Section 16.6 Rsync Sync Service

Rsync is "remote sync" meaning "telesynchronous"。


# Environmental Overview

![..gitbook/assets/image.png]

SERVERS A AND B ARE ALL __CODESPAN_0_。

- SERVER A (LAUNCHER, CLIENT): _CODESPAN_0_
- SERVER B (SYNC SOURCE, SERVICE END): __CODESPAN_0_


DESIGN REQUIREMENTS: SYNC SERVER B DATA TO SERVER A:B (SERVICE-END) > A (CLIENT). ABOUT B MIRROR TO A。

# SERVER B (SYNC SOURCE) CONFIGURATION

# # install rsync

- install with pkg:

```sh
# pkg install rsync
```

- or install with Ports:

```
# cd /usr/ports/net/rsync/ 
# make install clean
```

## query rsync after installation

```sh
root@ykla:~ #  pkg info -D rsync
rsync-3.4.1_2:
On install:
Some scripts provided by rsync, such as rrsync,
require Python, which is not installed by default.

Installation hint:
some scripts provided by rsync (e. g. rrsync) need Python
Python is not installed by default。
````

# # CONFIGURE FOLDERS TO BACK UP __CODESPAN_0_


```sh
# mkdir -p /home/test # 新建需要备份的文件夹 `test`
# chown root /home/test/ # 设置其属主为 `root`
# cd /home/test/ # 切换路径
# touch txt001 txt002 # 在其内部新建测试文件
```

## EDIT __CODESPAN_0_FILE


EDIT __CODESPAN_0_, WRITING:

```ini
# 服务端操作系统的用户
uid = root

# Groups of users of service-end operating systems
*girl

# Contained in source directory
i'm sorry, i'm sorry

# Listening address
adress = 192,168,179.150

# TCP PORT FOR COMMUNICATION, DEFAULT 873
port = 873

# Log File Location
the blog file = /var/log/rsyncd.log

# FILE LOCATION FOR ARCHIVE PROCESS ID
pid file = / var/run/rsyncd.pid

# Allowed client address
= 192,168,179.128

# Share module name, custom name, not necessarily the same as sync directory
[testcom]

# synchronized directory name, must be the user and group specified by uid parameters
path = /home/test

# Module description text
this post is part of our special coverage global development 2011

# Is it read-only
= yes

# The type of file that will not be compressed while synchronizing
*.gz *.tgz *.zip *.z *.rpm *.deb *.bz2

# Authorized accounts
= root

# define password file for rsync client authentication
= /ec/rsyncd_users.db
````

## Create a password file (service-end) to authenticate an authorized backup account

- EDIT __CODESPAN_0_, WRITE:

```sh
root:12345678   # 支持多个用户，一行一个即可。
```

Note**
>
>THE SERVICE-END PASSWORD FILE SHOULD CONTAIN A MAP OF THE USERNAME AND PASSWORD. FORMAT __CODESPAN_0_。

- Limit access to data files, otherwise errors are reported:

```sh
# chmod 600 /etc/rsyncd_users.db
```

# # Service Settings

```sh
# service rsyncd enable # 开机启动
# service rsyncd start  # 启动服务
```

# # view rsync running port number

```sh
# sockstat | grep rsync
root     rsync       1198 5   tcp4   192.168.179.150:873   *:*
```

# SERVER A (LAUNCHER) CONFIGURATION

install rsync。

## CONFIGURE __CODESPAN_0_

CREATE LOCAL FOLDER __CODESPAN_0_ AND SET ASSOCIATED PERMISSIONS:

```sh
# mkdir -p /home/testBackUp
# chown root:wheel /home/testBackUp/
```

# # Startend access sync source

DOWNLOAD THE FILE TO THE LOCAL __CODESPAN_0_ DOWNLOAD DIRECTORY. MANUALLY ENTER THE PASSWORD:

```sh
# rsync -avz root@192.168.179.150::testcom /home/testBackUp
Password: # 输入服务器 B 设置的密码，即 123456
receiving incremental file list
./
txt001
txt002

you know, 65 bytes received 151 bytes 86.40 bytes/sec
total size is 0 speedup is 0.00
````

__CODESPAN_0_IS DEFINED BY __CODESPAN_1 ABOVE AS A SYNCHRONISED DIRECTORY FROM THE SERVER。

Appendix: Specify how to password file

Creates a password file (client) that authorizes backup account authentication。

- EDIT __CODESPAN_0_, WRITE:

```sh
12345678          
```

- LIMIT PERMISSION TO OTHERWISE REPORT ERRORS __CODESPAN_0_。

```
# chmod 600 /etc/rsyncd_users.db
```

Note**
>
>Format is a password and the client should contain only the password。

Synchronising:

```sh
# rsync -auvz --progress --password-file=/etc/rsyncd_users.db root@192.168.179.150::testcom /home/testBackUp
receiving incremental file list
./
txt001
              0 100%    0.00kB/s    0:00:00 (xfr#1, to-chk=1/3)
txt002
              0 100%    0.00kB/s    0:00:00 (xfr#2, to-chk=0/3)

15 years ago, 65 bytes received 151 bytes 432.00 bytes/sec
total size is 0 speedup is 0.00
````

# # See sync

```sh
root@ykla:~ # ls -l  /home/testBackUp
total 1
-rw-r--r--  1 root wheel 0 Apr 17 18:33 txt001
-rw-r--r--  1 root wheel 0 Apr 17 18:33 txt002
```
