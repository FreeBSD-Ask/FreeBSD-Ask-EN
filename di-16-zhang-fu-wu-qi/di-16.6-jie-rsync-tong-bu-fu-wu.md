Section 16.6 Rsync Sync Service

Rsync is "remote sync" meaning "telesynchronous".


# Environmental Overview

![..gitbook/assets/image.png]

Servers A and B are all `FreeBSD-14.2-RELEASE-amd64 ' .

- Server A (launcher, client): `192.168.100.128 '
- Server B (Sync source, service end): `192.168.100.150 '


Design requirements: Sync server B data to server A:B (service-end) > A (client). About B mirror to A.

# Server B (Sync Source) Configuration

# # Install rsync

- Install with pkg:

```sh '
# Pkg install rsync
````

- or install with Ports:

````
#cd/usr/ports/net/rsync/
# Make install clean
````

## Query rsync after installation

```sh '
root@ykla:
rsync-3.4.1_2:
On install:
Some scripts helped by rsync, such as rrsync,
Now, Python, which is not settled by default.

Installation hint:
Some scripts provided by rsync (e. g. rrsync) need Python
Python is not installed by default.
````

Configure folders to back up


```sh '
# mkdir-p/home/test # new folder #
# Down root / home/test/ # set its owner to 'root '
# cd/home/test/ # switch path
# Touch txt001 txt002
````

## Edit `rsyncd.conf ' files


Edit `/usr/local/etc/rsync/rsyncd.conf ' to read:

```ini '
# Users of service-end operating systems
uid = root

# Groups of users of service-end operating systems
*Girl

# Contained in source directory
I'm sorry, I'm sorry.

# Listening address
Adress = 192,168,179.150

# TCP port for communication, default 873
Port = 873

# Log File Location
The blog file = /var/log/rsyncd.log

# File location for archive process ID
Pid file = / var/run/rsyncd.pid

# Allowed client address
= 192,168,179.128

# Share module name, custom name, not necessarily the same as sync directory
[testcom]

# Synchronized directory name, must be the user and group specified by uid parameters
Path = /home/test

# Module description text
This post is part of our special coverage Global Development 2011.

# Is it read-only
= Yes

# The type of file that will not be compressed while synchronizing
*.gz *.tgz *.zip *.z *.rpm *.deb *.bz2

# Authorized accounts
= root

# Define password file for rsync client authentication
= /ec/rsyncd_users.db
````

## Create a password file (service-end) to authenticate an authorized backup account

- Edit `/etc/rsyncd_users.db ' , writing:

```sh '
Root: 12345678 # Support multiple users, one line at a time.
````

Note**
>
>The service-end password file should contain a map of the username and password. Format `Authorized account username: password ' .

- Limit access to data files, otherwise errors are reported:

```sh '
#chmod 600/etc/rsyncd_users.db
````

# # Service Settings

```sh '
♪ service rsyncd available ♪
# service rsyncd start #
````

# # View rsync running port number

```sh '
# Sockstat #
Root rsync 1198 5 tcp 492 168.179.150: 873 *:*
````

# Server A (launcher) configuration

Install rsync.

# # Configure '/home/testBackUp/ '

Create local folder `/home/testBackUp/ ' and set associated privileges:

```sh '
# mkdir-p/home/testBackUp
# Down root: wheel/home/testBackUp
````

# # Startend access sync source

Downloading files to local `/home/testBackUp/ ' download directory requires manual input of passwords:

```sh '
#rsync-avz root@192.168.179.150:testcom/home/testBackUp
Password: # Enter the password set by server B, i. e. 123456
Receiving essential file list
./
txt001
txt002

You know, 65 bytes received 151 bytes 86.40 bytes/sec
Total size is 0 Speedup is 0.00
````

`testcom ' is a synchronised directory from the server, defined as `/usr/local/etc/rsync/rsyncd.conf ' above.

Appendix: Specify how to password file

Creates a password file (client) that authorizes backup account authentication.

- Edit `/etc/rsyncd_users.db ' , writing:

```sh '
12345678
````

- Limit permission, otherwise errors will be reported.

````
#chmod 600/etc/rsyncd_users.db
````

Note**
>
>Format is a password and the client should contain only the password.

Synchronising:

```sh '
#rsync-auvz-product-password-file=/etc/rsyncd_users.db root@192.168.179.150:testcom/home/testBackUp
Receiving essential file list
./
txt001
0 100% 0.00kB/s 00:00 (xfr#1, to-chk=1/3)
txt002
0 100% 0.00kB/s 00:00 (xfr#2, to-chk=0/3)

15 years ago, 65 bytes received 151 bytes 432.00 bytes/sec
Total size is 0 Speedup is 0.00
````

# # See sync

```sh '
#ls-l/home/testBackUp
Total 1
-rw-r-r-- 1 root wheel 0 Apr 17 18:33 txt001
-rw-r-r-r- 1 root wheel 0 Apr 17 18:33 txt002
````
