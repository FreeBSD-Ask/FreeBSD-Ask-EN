Section 16.4 Time service


# Configure Timezones

- SET THE TIME ZONE WITH __CODESPAN_0_。

- Use command line:

```sh
# cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```

---|---

Each user can set its own time zone, setting the __CODESPAN_0_ variable in the user's shell configuration file。

- sh, bash, zsh

```sh
export TZ=CST-8 
# 或
export TZ=Asia/Shanghai
```

- csh

```sh
setenv TZ CST-8
# 或
setenv TZ "Asia/Shanghai"
```

- In the crontab configuration file, set the __CODESPAN_0_ variable to be sufficient:

```sh
CRON_TZ=CST-8
0 8 * * * date >> ~/date.log
```

- Consider RTC time as local time (compatible Windows time to prevent a difference of 8 hours)

```sh
# touch /etc/wall_cmos_clock # 创建验证文件
# reboot                     # 重启系统
# sysctl machdep.wall_cmos_clock # 验证内核参数
machdep.wall_cmos_clock: 1
```

References

- [i'm sorry] (https://man.freebsd.org/cgi/man.cgi?adjkerntz (8))

# Configure sync time

setup to start ntp service

```sh
# service ntpd enable
```

# set ntp service to start

```sh
# sysrc ntpd_sync_on_start="YES"
```

## EDIT __CODESPAN_0_FILE

```sh
# ee /etc/ntp.conf
```

Add Additional Clock Server

```sh
server time.windows.com
server 0.cn.pool.ntp.org
server 1.cn.pool.ntp.org
server 2.cn.pool.ntp.org
server 3.cn.pool.ntp.org
```

Service

- start ntp service

```sh
# service ntpd start
```

- restart ntp service

```sh
# service ntpd restart
```

# Show the current time #

```sh
$ date
2025年 3月22日 星期六 15时27分29秒 CST
```

# # Manual sync time (optional)

```sh
# ntpdate time.windows.com
```

- The order must be used when there is a significant time difference, and the other orders will not take effect:

```sh
# ntpdate -u pool.ntp.org
```
