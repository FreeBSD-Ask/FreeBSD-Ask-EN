# Section 10.3 Podman

Podman was designed to replace Docker, and it's almost identical to Docker's orders, and you can even set aliases for use。

Podman's realization on FreeBSD is based on Jail, and you can view the current container by command __CODESPAN_0。

# Install Podman

we install sysutils/podman-suet, which will help us install sysutils/buildah, sysutils/podman and sysutils/skopeo。

- install with pkg

```sh
# pkg install podman-suite
```

- Install with Ports:

```sh
# cd /usr/ports/sysutils/podman-suite/ 
# make install clean
```

- View installation configuration:


```sh
root@ykla:~ # pkg info -D podman
podman-5.3.2_2:
On install:                              # 安装时：
The FreeBSD port of the Podman container engine is experimental and should be
used for evaluation and testing purposes only.
# Podman 容器引擎的 FreeBSD 移植版本是实验性的，仅供评估和测试使用。

us$sudo podman run-rm quick.io/dougrabson/hello

Podman can start contacts after a host is rebooted
# Podman can restart the container after the host is restarted. To enable this function, please execute:

US$Sysrc Podman_enable=YES

and start the conversation with a current policy:
# And start the container with a restart strategy:

you know, i'm not sure if you're gonna be able to do that

It is possible to run many Linux contacts using FreeBSD's Linux integration:
# Many Linux container mirrors can be run using the FreeBSD simulation:

US$Sysrc llinux_enable=YES
that's what i'm talking about
you know, i'm not sure what you're talking about
NAME = "Alpine Linux"

On upgrade from Podman < 4.7.1 #
In Podman-4.7.0 and later, complexion creds moved from
/run/containers/0/auth.json to/root/.config/containers/auth.json
the file to the new location or just re-entity to the requited registrations.
# In Podman 4.7.0 and more, the certificate of certification of the registration form has been located from
#/run/containers/0/auth.json moved to /root/.config/containers/auth.json。
# You can move the file to a new location or re-enter the required mirror registration form。
````


configure fstab

WRITE __CODESPAN_0_

```sh
fdesc   /dev/fd         fdescfs         rw      0       0
```

The following orders are then executed to give immediate effect to them:

```sh
# mount -t fdescfs fdesc /dev/fd
```

Configure the network

- Copy Profile

```sh
# cp /usr/local/etc/containers/pf.conf.sample /etc/pf.conf
```

- EDIT __CODESPAN_0, REPLACE __CODESPAN_1_ WITH YOUR CURRENT WEBCARD, USING __CODESPAN_2_

```sh
v4egress_if = "ix0"
v6egress_if = "ix0"
```

- start pf

```sh
# kldload pf # 加载内核模块，仅需这一次，以后会自动加载
# echo 'net.pf.filter_local=1' >> /etc/sysctl.conf.local # 将容器主机上的连接重定向到容器内部运行
# sysctl net.pf.filter_local=1 # 立即生效
# service pf enable # 开启服务器
# service pf start # 启动 pf 防火墙
```

# create zfs storage pool

- if you use zfs:

```sh
# zfs create -o mountpoint=/var/db/containers zroot/containers
```

- if you don't ** use zfs:

```sh
# sed -I .bak -e 's/driver = "zfs"/driver = "vfs"/' /usr/local/etc/containers/storage.conf
```


# Start service

```sh
# service linux enable
# service linux start
# service podman enable
# service podman start
```


# Test Ubuntu mirror

- Test to pull Ubuntu

```sh
root@ykla:~ # podman pull --os=linux docker.io/library/ubuntu:latest
Trying to pull docker.io/library/ubuntu:latest...
Getting image source signatures
Copying blob 0622fac788ed done   |
Copying config a0e45e2ce6 done   |
Writing manifest to image destination
a0e45e2ce6e6e22e73185397d162a64fcf2f80a41c597015cab05d9a7b5913ce
```

- View the currently pulled mirror

```sh
root@ykla:~ # podman images
REPOSITORY                TAG         IMAGE ID      CREATED      SIZE
docker.io/library/ubuntu  latest      a0e45e2ce6e6  3 weeks ago  80.6 MB
```

- Print system version (5 lines before printing only)

```sh
root@ykla:~ # podman run --os=linux ubuntu /usr/bin/cat "/etc/os-release" | head -5
PRETTY_NAME="Ubuntu 24.04.2 LTS"
NAME="Ubuntu"
VERSION_ID="24.04"
VERSION="24.04.2 LTS (Noble Numbat)"
VERSION_CODENAME=noble
```

- Enter the container

```sh
root@ykla:~ # podman run -it --os=linux ubuntu /bin/bash # 进入容器
root@3b6d47dea81e:/# apt update # 现在已经在容器内部了
Get:1 http://archive.ubuntu.com/ubuntu noble InRelease [256 kB]
Get:2 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]

...The following omissions ..
root@3b6d47dea81e:/ #exit# exit container
i don't know
# back to the host
````

# Test nginx packaging packaged by FreeBSD maintainer


```sh
# podman pull quay.io/dougrabson/nginx
# podman run -d --name mynginx -p 8080:80 quay.io/dougrabson/nginx
```

Opens the web page __CODESPAN_0_ to view the nginx page of the test。

More use

- Check the log

```sh
# podman logs 容器名称
```

- See status

```sh
root@ykla:~ # podman ps # 查看当前运行的容器
CONTAINER ID  IMAGE                            COMMAND               CREATEDSTATUS        PORTS                 NAMES
ca088c9c56fc  quay.io/dougrabson/nginx:latest  /usr/local/sbin/n...  3 minutes agoUp 3 minutes  0.0.0.0:8080->80/tcp  mynginx
root@ykla:~ # podman ps -a # 查看所有状态，包括运行失败的容器
CONTAINER ID  IMAGE                            COMMAND               CREATED STATUS                     PORTS                              NAMES
e8ea65b7e6c9  docker.io/library/nginx:latest   nginx -g daemon o...  17 minutes ago Exited (0) 292 years ago   0.0.0.0:8080->80/tcp               nginx-test
ca088c9c56fc  quay.io/dougrabson/nginx:latest  /usr/local/sbin/n...  3 minutes ago Up 3 minutes               0.0.0.0:8080->80/tcp               mynginx
```

- Stop and delete containers

```sh
# podman stop 容器名称
# podman rm 容器名称
```

- Delete mirror (must remove the quoted container before deleting the mirror)

```sh
# podman rmi 镜像名称
```

# Pull FreeBSD

```sh
# podman pull docker://freebsd/freebsd-runtime:14.2
```

see also [freebsd/freebsd-runtime] (https://hub.docker.com/r/freebsd/freebsd-runtime/tags)

# References

- [Podman Industries] (https://podman.io/docs/information), official installation course
- [Install Podman and run Containers in FreeBSD 14] (https://cloudspinx.com/install-podman-and-run-containers-in-freebsd/)
