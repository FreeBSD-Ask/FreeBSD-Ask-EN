# Section 17.13 Cady

# Install

```sh
# pkg ins caddy
```

or

```sh
# cd /usr/ports/www/caddy/ 
# make install clean
```

# View installation configuration

```sh
root@ykla:~ #
root@ykla:~ # pkg info -D caddy
caddy-2.9.1:
On install:
To enable caddy:
# 启用 Caddy：

- Edit/usr/local/etc/caddy/Cadyfile
See https://caddyserver.com/docs/
# - Edit /usr/local/etc/caddy/Cadyfile
# see https://caddyserver.com/docs/ get more profile

- Run'service caddy enough
# - Run 'servicecaddy available' to enable the Cady service to start automatically on system startup

Not while Cady historically deals to run as root: how well, it is long-standing
i'm sorry, but i'm sorry, but i'm sorry
# Note that while Cady currently defaults to run as root:wheel, it is strongly recommended to run as a non-privileged user such as www:www。

- Use security/portacl-rc to make it work
# - use security/portacl-rc to enable privileged port binding:

# pkg install security/portacl-rc
# sysrc portacl_users+ #www
# sysrc portacl_user_www_tcp=https
# sysrc portacl_user_www_udp= "https"
♪ service portacl enough
♪ service portacl start
# These commands install and enable portacl port access controls, allowing unprivileged users (e. g. www) to bind HTTP and HTTPS ports

- CONFIGURE Cady to run as:
# - Configure Cady running as www:www user

#sysrc cady_user #
# Use this command to configure Cady to run by www:www user and group

- Not if Cady has been started as root strictly in
/var/log/caddy, /var/db/caddy, and /var/run/caddy may require their ownship
i'm going to have to change.
# Note that if Cady had started as root, the documents in /var/log/caddy, /var/db/caddy and /var/run/caddy may need to change ownership of the document manually。

/usr/local/etc/rc.d/caddy has the following instructions:
#/usr/local/etc/rc.d/caddy default configuration as follows:

- Server log: /var/log/caddy/caddy.log
(runtime messages, NOT an access.log)
# - server log: /var/log/caddy/caddy.log
# This file contains running-time log information rather than access log

- Automatic SSL curtificate status: /var/db/caddy/data/caddy/
# - Automatic SSL certificate storage location: /var/db/caddy/data/caddy/

-Adminization endpoint: /unix/var/run/caddy/caddy.sock
# - manage endpoints@unix/var/run/caddy/caddy.sock
# Management interface access via Unix

- Runs as root: wheel (this will change to www: in the future)
# - currently run as root:wheel user by default, with future changes to www:www user identity

On upward from cady<23.0:
The default settlements for cady runtime files have changed!
# upgrade from caddy< 2.3.0:
# Cady Runtime file default location changed

- Caddy's runtime log is now/var/log/caddy/caddy.log
(was / var/log/caddy.log)
# - Caddy Runtime Log is now in / var/log/caddy/caddy.log (formerly / var/log/caddy.log)

- Automatic SSL tables are now stopped in /var/db/caddy/data/caddy
(was / root/.local/share/caddy)
# - Automatic SSL certificates are now stored in /var/db/caddy/data/caddy (formerly / root/. local/share/caddy)

- Configuration atosaves are now stopped in /var/db/caddy/config/caddy
(was / root/.config/caddy)
# - configure autosaving is now stored in / var/db/caddy/config/caddy (formerly / root/.config/caddy)

See/usr/local/etc/rc.d/caddy
# you can change these default settings. see /usr/local/etc/rc.d/caddy for more information

On upgrade from cady<2.7.4_2:
The default Cady administration endpoint location has been changed from
localhost: 2019 to a protected Unix domain
/var/run/caddy/caddy.sock
# upgrade from caddy < 2.7.4_2:
# The default Cady management endpoint position has been changed from localhost:2019 to a protected Unix domain package
# in / var/run/caddy/caddy.sock

This can be overrided with the ___ CODESPAN, or by specifying
in the Cadyfile ___ CODESPAN_0-section, documented here:
# This can be covered by the __CODESPAN_0_rc variable, or specified in the __CODESPAN_1_ part of the Cadyfile. See here for more information:

https://caddyserver.com/docs/caddyfile/options#admin

The previous decision, partly paid with the service running as root,
you know, maybe have serious security problems for sharing machines with untrusted
i'm sorry, sir.
# previous default settings, especially when used with root identity, may pose serious security risks to shared machines, especially in untrusted user environments。

On upward:
It is STRONGLY RECOMMENDED TO RUN Cady as an unprivileged user, such as
www, rather than the current default of root: wheel.
# Uptime:
# Strongly recommends that Cady run as a non-privileged user, e. g. www:www, not the current default root:wheel。

If you have received upon earlier sentences:
# If you rely on early default settings:

- Use security/portacl-rc to make it work
# - enable privileged port binding with security/portacl-rc:

# pkg install security/portacl-rc
# sysrc portacl_users+ #www
# sysrc portacl_user_www_tcp=https
# sysrc portacl_user_www_udp= "https"
♪ service portacl enough
♪ service portacl start
# Install and configure portacl to allow unprivileged users (e. g. www) to bind HTTP and HTTPS ports

- Stop the server, and update owners on Cady runtime files:
# - Stop the server and update the Caddy running time file ownership:

♪ service caddy stop
#down -R www:www.var/db/caddy/var/log/caddy/var/run/caddy
# Stop the Cady service and change ownership of the file to www:www user

The other changes may be important depending on your exact Cady
i don't know what you're talking about.
# Based on your Cady configuration, there might be other changes。

- Change the default runtime user, and restart the server:
# - Change the default running time user and restart the server:

#sysrc cady_user #
♪ service caddy start
# Use this command to change the running time user and group of Caddy to www:www, and restart the Caddy service
````

Configure

Note**
>
> ERROR DUE TO THE INABILITY OF NON-PRIVILEGED USER TO OPEN THE 443 PORT_CODESPAN_0_。

INSTALL THE ABOVE-MENTIONED CODESPAN_0_:

```sh
# pkg install security/portacl-rc
# sysrc portacl_users+=www
# sysrc portacl_user_www_tcp="http https"
# sysrc portacl_user_www_udp="https"
# service portacl enable
# service portacl start
```

Configure services:

```sh
# service caddy enable # 请按顺序执行
# service caddy start # 请按顺序执行
# service caddy stop # 请按顺序执行
# sysrc caddy_user=www caddy_group=www
# chown -R www:www /var/db/caddy /var/log/caddy /var/run/caddy
```

New Test Page:

```sh
# mkdir -p /usr/local/www/caddy/
```

EDIT __CODESPAN_0_, WRITING:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeBSD 中文社区欢迎你！</title>
</head>
<body>
    <h1 style="text-align: center;">Hello World !</h1>
</body>
</html>
```

```
root@ykla:~ # service caddy start
Starting caddy... done
Log: /var/log/caddy/caddy.log
```

OPEN __CODESPAN_0:

[Cady FreeBSD] (..gitbook/assets/caddy1.png)

References

- [Cady Install and Use Tutor] (https://blog.ovvv.top/posts/f3ac7ef6/), HTML from this test page

