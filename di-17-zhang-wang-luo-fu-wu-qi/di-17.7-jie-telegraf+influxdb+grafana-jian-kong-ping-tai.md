# 17.7 Telegraf+InfluxDB+Grafana

# InfluxDB Install and Configure

InfluxDB is an open source database for the storage and analysis of time series data.

# Install

```sh '
# pkg install influxdb
````

Or...

```sh '
#cd /usr/ports/datases/influxdb/
# Make install clean
````

# # Service management

- Add Start

```sh '
# For service influxd enough
````

- Start service.

```sh '
# Service influxd start
````

## Change influxd configuration

You can modify the influxd configuration yourself.

- Profile path is `/usr/local/etc/influxd.conf '

```sh '
#ee /usr/local/etc/influxd.conf
````

- Restart the service after the change has been completed:

```sh '
# Service influxd present
````

## Create influxd database

``sql
Influx
Connected to http://localhost:8086 version 1.8.10
InfluxDB shell version: 1.8.10
>CREATE DATABASE mydb # Create Database
> CREATE USER username WITH PASWORD 'password'# Creates database users and passwords. The username set here is username and password is password
> SHOW DATABASES # View Database
Name: data
Name
I'm sorry.
_international
Oh, mydb.
>
> quit # exit database
````

# Telegraf

# Install

```sh '
# Pkg install telegraf
````

Or...

````
#cd /usr/ports/net-mgmt/telegraf/
# Make install clean
````

# Add starter #

```sh '
# Service telegraf available
````


## Configure influxdb connections

We use the influxdb-1.8 version, which is configured in the configuration file as follows:

Profile path: `/usr/local/etc/telegraf.conf ' .

```sh '
# Configure influxdb connection content, content here and the InfluxDB database connection password above
[outputs.infouxdb]
urls = ["http://127.0.0.1:8086"]
Database = "mydb"
= "username"
Password = "password"
````

# Configure collection indicators #

Profile path: `/usr/local/etc/telegraf.conf ':

The relevant indicators are collected from the system cpu, dissk, diskio, memory and swap. Below are some of the elements of the telegraf profile: some are default open and some are manually released. For further information see [official document] (https://docs.infoluxdata.com/telegraf/v1.26/configration/).

```sh '
[inputs.mem]

# Swap
[inputs.swap]

# Disk
[inputs.dissk]
ignore_fs = ["tmpfs", "devtmpfs", "so9660", "overlay", "aufs", "squashfs"]

# Disk IO
[inputs.diskio]

# Processes
[inputs.processes]

# System (Uptime and so on)
[inputs.system]

♪ networking
[inputs.net]

Get the number of events and group them by status
[inputs.processes]
````

# Start service #

```sh '
# Service telegraf start
````

# Grafana


# Install Grafana #

```sh '
# Pkg install grafana
````

# Set the system up

```sh '
♪ Service gravaana enough
````

# Start service #

```sh '
# Service gravaana start
````

# Login grafana

The default login address is: `http://localhost:3000',

![..gitbook/assets/grafana1.png]

- Default login password:
- Username (username): `admin '
- Password (cipher): `admin '

![..gitbook/assets/grafana2.png]

After login, you will be asked to change the password.

Configure data sources

- Click on the top left corner **Connects** - > Choose **Add new condition**

[grafana-datasource-add] (..gitbook/assets/grafana-datasource-add.png)

- Enter `InfluxDB '-> the selected search **InfluxDB**, click

[choose-influxdb] (.../.gitbook/assets/grafana-data-search.png)

- Click on the top right corner **Add new data source** button -> Configure InfluxDB related content.

[grafana-datasource-create] (..gitbook/assets/grafana-data-create.png)

- Enter the InfluxDB connection information on the data source configuration page, as follows:
Note**
>
>We use influxdb1.8 above, so the `InfluxQL' must be selected

`URL ' input: `http://localhost:8086'.

[grafana-influxdb-source-config1] (..getbook/assets/grafana-influxdb-source-config1.png)

Database enter `mydb '; User enter `username '; password enter `password ' (these are set at the step of creating influxd database).

[grafana-influxdb-source-config2] (.gitbook/assets/graffana-influxdb-source-config2.png)


Click **Save & Test '** button to save configuration. Prompted successful links and obtained data:

[grafana-influxdb-source-config3] (.gitbook/assets/graffana-influxdb-source-config3.png)

# # Configure Dashboard

Select the dashboard that displays the data, which can be developed either by itself or by others in the [official template] (https://grafana.com/grafana/dashboards/). Import here a template of id as [928] (https://grafana.com/grafana/dashboards/928-telegraf-system-dashboard/).

- Import template, click **  ** - ** `Import dashboard '** on the top right corner into the import template page.

![..getbook/assets/grafana-dashboard-import.png]

- Select `id ' to be imported as a `928 ' template, enter `928 ' and click “Load”.

![..getbook/assets/grafana-dashboard-import-config.png]

Select our database.

![..gitbook/assets/grafana-dashboard-import-config2.png]

- The end effect of the template.

![..getbook/assets/grafana-dashboard-result.png]

# Set Chinese

Home--Adminization-- General--

![..gitbook/assets/grafana4.png]

# Fragmentation and unfinished business

Information on kernels, networks, CPUs is not shown. Seems to be related to Proc.

WaitResolve.
。