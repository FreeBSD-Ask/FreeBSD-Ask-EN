# 17.7 Telegraf+InfluxDB+Grafana

# InfluxDB Install and Configure

InfluxDB is an open source database for the storage and analysis of time series data。

# Install

```sh
# pkg install influxdb
```

Or..

```sh
# cd /usr/ports/databases/influxdb/ 
# make install clean
```

# # Service management

- Add Start

```sh
# service influxd enable
```

- Start service

```sh
# service influxd start
```

## change influxd configuration

you can modify the influxd configuration yourself。

- PROFILE PATH IS __CODESPAN_0_

```sh
# ee /usr/local/etc/influxd.conf
```

- Restart the service after the change has been completed:

```sh
# service influxd restart
```

## create influxd database

```sql
# influx # 连接数据库
Connected to http://localhost:8086 version 1.8.10
InfluxDB shell version: 1.8.10
> CREATE DATABASE mydb # 创建数据库
> CREATE USER username WITH PASSWORD 'password' # 创建数据库用户及密码。此处设置的用户名是 username，密码是 password
> SHOW DATABASES # 查看数据库
name: databases
name
----
_internal
mydb
>
> quit # 退出数据库
```

# Telegraf

# Install

```sh
# pkg install telegraf
```

Or..

```
# cd /usr/ports/net-mgmt/telegraf/ 
# make install clean
```

# Add starter #

```sh
# service telegraf enable
```


## configure influxdb connections

we use the influxdb-1.8 version, which is configured in the configuration file as follows:

PROFILE PATH: _CODESPAN_0_。

```sh
# 配置 influxdb 连接内容，此处的内容和上面配置的 InfluxDB 数据库连接账号密码
[[outputs.influxdb]]
  urls = ["http://127.0.0.1:8086"]
  database = "mydb" 
  username = "username"
  password = "password"
```

# Configure collection indicators #

PROFILE PATH: __CODESPAN_0_:

The relevant indicators are collected from the system cpu, dissk, diskio, memory and swap. Below are some of the elements of the telegraf profile: some are default open and some are manually released. For further information, please see [Office documents] (https://docs.infoluxdata.com/telegraf/v1.26/contigation/)。

```sh
[[inputs.mem]]

# swap
[inputs.swap]

# disk
[inputs.dissk]
ignore_fs = ["tmpfs", "devtmpfs", "so9660", "overlay", "aufs", "squashfs"]

# Disk IO
[inputs.diskio]

# processes
[inputs.processes]

# System (Uptime and so on)
[inputs.system]

♪ networking
[inputs.net]

Get the number of events and group them by status
[inputs.processes]
````

# Start service #

```sh
# service telegraf start
```

# Grafana


# Install Grafana #

```sh
# pkg install grafana
```

# Set the system up

```sh
# service grafana enable
```

# Start service #

```sh
# service grafana start
```

# login grafana

THE DEFAULT LOGIN ADDRESS IS:

![..gitbook/assets/grafana1.png]

- Default login password:
- Username (username):_CODESPAN_0_
- Password (cipher): _CODESPAN_0_

![..gitbook/assets/grafana2.png]

After login, you will be asked to change the password。

Configure data sources

- Click on the top left corner **Connects** - > Choose **Add new condition**

[_other organiser] (. .gitbook/assets/grafana-datasource-add.png)

- Enter __CODESPAN_0-> **InfluxDB**, click

[forose-influxdb] (..gitbook/assets/grafana-data-search.png)

- Click on the top right corner **Add new data source** button -> Configure InfluxDB related content。

[gravana-datasource-create] (..gitbook/assets/grafana-data-create.png)

- Enter the InfluxDB connection information on the data source configuration page, as follows:
Note**
>
>We use influxdb1.8 above, so the selected query language must be selected `InfluxQL` (the default is)

__CODESPAN_0_INPUT:_CODESPAN_1_。

[gravaana-influxdb-source-config1] (. .getbook/assets/grafana-influxdb-source-config1.png)

Datacase enter __CODESPAN_0; User enter __CODESPAN_1; password enter `password`_ (these are set at the time of creating the influxd database)。

[this post is part of our special coverage gravaana-infoluxdb-source-config2] (.getbook/assets/grafana-influxdb-source-config2.png)


CLICK **_CODESPAN_0** TO SAVE THE CONFIGURATION. PROMPTED SUCCESSFUL LINKS AND OBTAINED DATA:

[_other ororganiser] (. .gitbook/assets/grafana-influxdb-source-config3.png)

# # Configure Dashboard

Select the dashboard that displays the data, which can be developed either by itself or by others in [Office Template] (https://grafana.com/grafana/dashboards/). Import here a template of id as [928] (https://grafana.com/grafana/dashboards/928-telegraf-system-dashboard/)。

- IMPORT TEMPLATE, CLICK **-CODESPAN_0**->-CODESPAN_1** ON THE TOP RIGHT CORNER TO ENTER THE IMPORT TEMPLATE PAGE。

![..getbook/assets/grafana-dashboard-import.png]

- Select the template __CODESPAN_0_ to import __CODESPAN_1_, enter __CODESPAN_2_, then click “Load”。

![..getbook/assets/grafana-dashboard-import-config.png]

Select our database。

![..gitbook/assets/grafana-dashboard-import-config2.png]

- The end effect of the template

![..getbook/assets/grafana-dashboard-result.png]

# Set Chinese

Home--Adminization-- General--。

![..gitbook/assets/grafana4.png]

# Fragmentation and unfinished business

Information on kernels, networks, CPUs is not shown. Seems to be related to Proc。

Pending。
