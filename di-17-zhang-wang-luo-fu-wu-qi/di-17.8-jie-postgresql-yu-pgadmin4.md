# Section 17.8 PostgreSQL and pgAdmin4

PostgreSQL is a free object relationship database (Object-Relational Database, ORDB). PostgreSQL was first published in June 1989. There are several versions available on FreeBSD. More than MySQL in terms of throughput, source-code clarity and average time-consuming.

It's worth mentioning that PostgreSQL also originated from the University of California at Berkeley. PostgreSQL licence is [PostgreSQL licence] (https://www.postgresql.org/about/licence/), similar to BSDL.

# PostgreSQL installation example (6 versions all)

# Install

```sh '
# Pkg install-y postgresql16-server
````

Or...

```sh '
#cd/usr/ports/datases/postgresql16-server/
# Make install clean
````

View installation configuration

```sh '
For procedural plans and postgresql operations, please note that
You might have to update them when updating the service.
# If you use process language or PostgreSQL functions, you may need to update the server simultaneously.

If you have many tumbles and many clits running,
I'm sorry to bother you.
Well, apparently.
# If you have a large number of tables and clients, it is recommended to use sysctl to upgrade kern.maxfiles or to reconfigure kernel parameters.

The port is set up to use autovacuum for new data, but you might
There.
Is a periodic script, /usr/local/etc/periodic/ Daily/502.pgsql, that
You can use it to backup and personal vacum on all
It's `vacum analize'.
For autovacuum settings, please review
~postgres/data/postgresql.conf.
# The port defaults to enable aautovacum for the new database, but you should still move vacum and backup regularly.
# There is a daily script /usr/local/etc/periodic/ Daily/502.pgsql that can be used to back up every night and vacum all databases.
# Default execution of `vacum analize ' , available in scripts. See postgresql.conf for the setting of autovacum.

If you plan to access your PostgreSQL service using ODBC, please
/usr/local/share/postgresql/odbc.sql
To get the operations referred for ODS communication.
# If you want to access PostgreSQL through ODBC, run the Odbc.sql script to install the required compatibility functions.

Please note that if you use the rc script,
/usr/local/etc/rc.d/postgresql, to initiaize the data, unicode
(UTF-8) will be used to store caractor data by default.
No, postgresql_litdb_flags or use login.conf settings dropped below to
See the start rc script for more information.
# If you initialize the database with rc scripts, the character data will be stored by default using UTF-8 encoding.
# You can change this by setting up postgresql_initdb_flags or login.conf, as detailed in the rc foot note.

To set lives, environment stuff like locale and collect and other
Things, you can set up a class in/etc/login.
Add something simple to this to/etc/login.conf:
# If you need to set initialisation parameters such as resource limitations, language environment, sorting rules, you can predescribe a login class in /etc/login.conf.
Add something simple to this to/etc/login.conf:
I don't...
Postgres: \\
:lang=en_US.UTF-8:\
:setenv=LC_COLLATE=C:\
:tc=default:
I don't...
# Example login type settings that define language and sorting rules.

And run 'cap_mkdb/etc/login.conf'.
Then add 'postgresql_login_class=postgres' to/etc/rc.conf, or
It's as the postgress user's login class in/etc/passwd.
# Run Cap_mkdb effective after adding login class and set postgresql_login_class.
# Or specify this login class for postgres users directly in /etc/passwd.

== sync, corrected by elderman == @elder_man

To use PostgreSQL, enough it in rc.conf using

== sync, corrected by elderman ==
Enable PostgreSQL service.

To initialize the data, run

I don't know, service postgresql initdb
# Initializing the database.

You can then start PostgreSQL by running:

Service postgresql start
# Start PostgreSQL service.

For postmaster settings, see ~postgres/data/postgresql.conf
# postmaster set in postgresql.conf.

FreeBSD's PostgreSQL port logs to syslog by default
See ~postgres/data/postgresql.conf for moreinfo
# PostgreSQL defaults on FreeBSD by syslog log, see postgresql.conf.

If you're not using a checking field like ZFS, you might...
It can be effective during
The initdb case, by adding the "--data-checksums"
The postgresql_initdb_flags rcvar.
Check the initdb(1) manpage for more information
And make sure you understand the performations.
# If you do not use a file system like ZFS with a checksum, it is recommended that the PostgreSQL data check function be activated.
# You can use --data-checksums at initdb stage, or pg_checksums later.
# Please refer to the initdb manual and understand its possible performance implications.

== sync, corrected by elderman ==== sync, corrected by elderman == @elder_man

SECURITY ADVICE
# Safety advice

If updating from a version 16x < 16.3
A security value was found in the system views pg_stats_ext
And pg_stats_ext_extprs, technically allowing officially based data
If this is of concern in your
Instability, run the SQL script/usr/local/share/postgresql/fix-CVE-2024-4317sql
For debts, see?
https://www.postgresql.org/support/security/CVE-2024-4317/
# If you upgrade from the following 16.3 versions, pg_stats_ext and pg_stats_ext_exprs have a security loophole that may lead to the authentication user seeing data that should not be seen.
# If you're concerned about this, please implement the six-CVE-2024-4317.sql for each database.
# For more information, see Official Gazette: https://www.postgresql.org/support/security/CVE-2024-4317/
````

# Add starter #

```sh '
# Service postgresql available
````

# Initialize the database #

```sh '
# Service postgresql initdb
````

Example output:

``sql
# service postgresql initdb
The files coming to this data system will be owned by us.
This user must also own the service process.

The data ruler will be intitiated with this local situation:
No, no, no, no.
LC_COLLATE:
LC_CTYPE: C.UTF-8
LC_MSAGES: C.UTF-8
LC_Monetary: C.UTF-8
LC_NUMERIC: C.UTF-8
LC_TIME: C.UTF-8
The default text will be set to "english".

Data page checks are disabled.

/ var/db/postgres/data16... ok
Creating subdirectors... ok
I don't know if I'm going to be able to help you with this.
I'm sorry, I'm sorry.
I'm not sure I'm going to be able to do this,
Singing default time zero...
Creating configries... ok
Running bootstream... ok
I don't know what you're talking about.
Syncing Data to Disk... ok

Initdb: warning: enabling "trust"
You can change this by tinging pg_hba. cof or using the option-A, or-auth-local and-auth-host, the next time you run initb.

You can now start the database service us:

/usr/local/bin/pg_ctl-D/var/db/postgres/data16-l logfilestart
````

# Login to use #

Postgresql default does not have root users and uses `postgres ' login to create them.

Example output:

``sql
# psql
FATAL:
````

Correct use:

``sql
# Switch user
# su - postgres

# Start the service
$/usr/local/bin/pg_ctl-D/var/db/postgres/data16-l logfilestart

# Create new user ykla and set password
You know, I've been thinking about it.
Enter password for new rule:
Enter it again:
It's okay.
# Create database
$ Createdb new_db
#Register in the database and give the user ykla access to the database.
$psql
psql (16.7)
Type "help" for help.

Postgres=#ALTER USER ykla WITH ENCRYPTED PASSWORD 'password';
Aller Rolle.
Postgres=#
Postgres =#GRANT ALL PRIVILES ON DATABASE new_db TO ykla;
GRANT
# Exiting the database
Postgres=#q
$exit
Root@ykla:
````

# Deep in PostgreSQL Service Management

# Initialization proposal #

The initialization of the database proposal was to use `service postgresql initdb ' , which was the easiest way. But there are some techniques in there.

Here is how to use `postgresql_initdb_flags`rc script parameters.

`postgresql_initdb_flags ' is defaulted on `-encoding=utf-8-lc-collate=C'. The meaning is clear: assigned to UTF-8 and to ASCII.

It is suggested that the `sysrc ' be set as follows:

```sh '
# sysrc postgresql_initdb_flags=-encoding=utf-8-lc-collate=C-A scram-sha-256-W"
````

Explanation:

- `-A scram-sha-256 ' for specifying the default authentication method. Otherwise the default authentication method in `pg_hba.conf ' is `trust ' , i.e. no password login;
- `-W ' is used to request `postgres ' user passwords for initialization, so that the passwords are set without login.

This would simplify some initialization. Similarly, the `postgresql_initdb_flags ' parameter could be used to control initialization in a flexible manner.

# # Manage multiple database examples (clusters)

PostgreSQL can run several examples on a machine, which is very useful when testing different configurations and separating environments.

The tool for managing multiple database examples is commonly used on the Debian/Ubuntu system at `pg_ctlcluster ' , i.e. a `pg_ctl ' envelope.

FreeBSD does not have this tool, but the rc script on FreeBSD PostgreSQL contains these management features and is easy to use.

Two naming examples will be created below: Main, Dev.

## # Configure Examples

```sh '
# Add a Main instance
# sysrc postgresql_profiles+=main

# Add a dev instance
# sysrc postgresql_profiles+=dev

# Of course, you can set several examples at once
# Sysrc postgresql_profiles #

# Corresponds to Main Case Data Catalogue2
# sysrc postgresql_main_data=/var/db/postgres/main

# Corresponds to dev data directory3
#sysrc postgresql_dev_data=/var/db/postgres/dev

# Data directories must be set for each instance
# (see previous two)

# Set initialization parameter 1 for main instance
# dev instance default to initialize and compare
# Sysrc postgresql_main_initdb_flags #

# Enable or close for each instance
# Sysrc postgresql_main_enableES
# Sysrc postgresql_dev_enable
````

Note:

-1 Place the example name in the rc parameter name, which is the parameter name for the corresponding example.
- 2 `postgresql_data ' , `postgresql_enable ' may still be used. This is when these parameters are used as default values for example parameters and when no example parameter is found. But the default parameter will not be used when you clearly configure the example parameter.
-3 In managing multiple examples, it is recommended that only the parameters associated with the example name be used, rather than those without the example name. The benefits are clarity and control flexibility, and different examples can be set up differently.

## # Initialise the directory of examples

```sh '
# Service postgresql initdb
````

This will initiate two database examples.

This method can also be used for initialization of the final designation of the example name of the order and for new examples:

```sh '
# Service postgresql initdb mine
# Service postgresql initdb dev
````

Note:**
>
> Two different examples must be run on different ports, so the port number of the corresponding example needs to be modified.

Here the `main ' example uses the default `5432 ' port without modification; the `dev ' example uses the `5433 ' port to modify the corresponding profile

Amend `/var/db/postgres/dev/postgresql.conf'. Found port rows, amend as follows:

```ini '
Port = 5433
````

# Start stop and restart #

```sh '
# Service postgresql start
# Service postgresql status
# Service postgresql restart
# Service postgresql stop
````

This is done for all examples. Example:

```sh '
# service postgresql start #
== sync, corrected by elderman ==
Start postgresql
== sync, corrected by elderman ==
Start postgresql
# service postgresql status
== sync, corrected by elderman ==
Status postgresql
pg_ctl: service is running (PID: 2624)
"/var/db/postgres/main"
== sync, corrected by elderman ==
Status postgresql
pg_ctl: service is running (PID: 2641)
"/var/db/postgres/dev"
# service postgresql restart #
== sync, corrected by elderman ==
Now postgresql
== sync, corrected by elderman ==
Now postgresql
# service postgresql status
== sync, corrected by elderman ==
Status postgresql
pg_ctl: service is running (PID: 2685)
"/var/db/postgres/main"
== sync, corrected by elderman ==
Status postgresql
pg_ctl: service is running (PID: 2701)
"/var/db/postgres/dev"
# service postgresql stop #
== sync, corrected by elderman ==
Stop postgresql
== sync, corrected by elderman ==
Stop postgresql
# service postgresql status
== sync, corrected by elderman ==
Status postgresql
pg_ctl: no service running
== sync, corrected by elderman ==
Status postgresql
pg_ctl: no service running
````

You can specify an instance name to operate alone:

```sh '
# Service postgresql start dev
# Service postgresql restart dev
# Service postgresql status dev
# Service postgresql stop dev
````

Example:

```sh '
# Service postgresql start dev
Start postgresql
# Service postgresql status dev
Status postgresql
pg_ctl: service is running (PID: 2807)
"/var/db/postgres/dev"
# Service postgresql restart dev
Now postgresql
# Service postgresql stop dev
Stop postgresql
````

# Install pgAdmin4

The following curriculum is based on FreeBSD 13.0.

pgAdmin4 is the most popular open-source application for managing the PostgreSQL database server. pgAdmin4 provides a functional graphical user interface to easily manage the database. It was written in Python and Javascript/jQuery. It can be used in many environments, such as Linux, Windows, Unix, and in desktop and server mode.

Note**
>
>PgAdmin4 will not be installed unless the PostgreSQL database is installed.

pgAdmin4 needs to be run in python environments and installed through python pip, so python is installed first. This is the default version of Python 3.8, note that there is no python environment by default on FreeBSD 13. The following commands are available:

```sh '
# Python
python: Command not found # indicates that no python environment is currently installed
````

# Install Python and pip

```sh '
# Pkg install python
````

The pip is the Python package manager. It is used to install and manage the Python package and the relying package relationship.

The virtualenv is used to create a virtual python environment, a python environment specific to the project.

This is actually being installed by creating a separate Python environment by virtualenv.

Install pip from py38-pip package:

```sh '
# pkg install py38-pip
````

# # Install Configuration virtualenv

Creates a separate Python environment using virtualenv. Virtualenv will create its own Python installed environment, which does not support a library with a global or another virtual environment. Runs the following commands to install Virtualenv.

```sh '
# pkg installation py38-virtualenv # (Python version is 3.8 for this installation, so py38)
````

Create a virtual environment for pgAdmin4 by running the following commands

```sh '
#virtualenv-3.8 pgadmin4
````

If the creation is completed, the following shows that a virtual environment called `pgadmin4 ' was created under the root directory of root users of root.

``Python '
Using base prefix '/usr/local'
New python available in /home/vagrant/pgadmin4/bin/python3.8
Also creating available in/home/vagrant/pgadmin4/bin/python
Installing setuptools, pip, hey...done.
I don't know, do.
````

# # Install sqlite3

```sh '
#pkg install py38-sqlite3
````

Activate the created virtual environment.

```sh '
#sourcepgadmin4/bin/activate.csh
````

You'll see the shell has become (pgadmin4) (the following operations are performed under the shell)

Examples include:

``Python '
(pgadmin4) root@ykla: ~

````

## Install pgAdmin4

The pip source is now always required to use https, which needs to be installed because of the lack of SSL certificates.

``Python '
(pgadmin4)root@ykla:#pkg install ca_root_nss
````

Then switch the pip to the source, here using the Qinghua source:

``Python '
Pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
````

Some of them depend on openjpeg for installation.

``Python '
(pgadmin4) root@ykla:~pkg install openjpeg
````

If wrong:

``Python '
WARNING: Retry (total=3, connect=None, read=None, redirect=None, status=None)) after consideration by 'SSLertVerror (1, '[SL: CERTIFICATE_VERIFY_FAILED] certain verifiate is not yet valid_sl.c:1136)')')
````

It's caused by incorrect times.

```sh '
{\cHFFFFFF}{\cH00FF00} ntpdate ntp.api.bz
(pgadmin4) root@ykla:~ntpdate ntp.api.bz
17 Dec 16:35: 36 ntpdate [1453]: step timeserver 114.118.7.161 infset +4065911037 sec
````

Then you can install pgAmdin4 and its dependent environment.

```sh '
(pgadmin4) root@ykla:~pkg install rust
(pgadmin4) root@ykla:~ip install pgadmin4
````

Note**
>
>If the memory is insufficient (less than 4GB) and there is no swap, the `killed ' is hinted, and if the problem arises, add an exchange space (swap).

Configure and run pgAdmin4

Create profile for pgAdmin4 after installation, copy pgAdmin4 profile:

``Python '
(pgadmin4) root@ykla:~cp./pgadmin4/lib/python3.8/site-packages/pgadmin4/config.py./pgadmin4/lib/python3.8/site-packages/pgadmin4/config_local.pyy
````

Edits a local copy of the configuration file with the ee editor.

```sh '
(pgadmin4) root@ykla:~ee./pgadmin4/lib/python3.8/site-packages/pgadmin4/config_local.py
````

Found `DEFAULT_SERVER ' to change the address of the default server interception to `0.0.0.0 ' . Found port for `DEFAULT_SERVER_PORT' modified application listening.

Examples include:

```sh '
DEFAULT_SERVER = '0.0.0.0'
DEFAULT_SERVER_PORT = 5050
````

Manually create software directories:

```sh '
(pgadmin4) root@ykla:~mkdir-p/var/lib/pgadmin
(pgadmin4) root@ykla:~mkdir/var/log/pgadmin
````

The following command is executed after the configuration file editing is completed to initialize the account number and login password.

```sh '
(pgadmin4) root@ykla:#pgadmin4
````

Examples are shown below:

``Python '
NOTE: Coordination for SERVER mode.
Enter the email address and password to use for the intimacy pgAdmin user account:
Email address: your_email
Password: your_new_password # Enter your login password
Retype password: # Enter password again
Starting pgAdmin 4. Please navigate to http://0.0.0.0:5050 in yourbrowser.
````

Now we have installed and run pgAdmin4 and can access the Web control panel at `http://ip:5050 ':

![...gitbook/assets/pglogin.png]

![...gitbook/assets/pglogin2.png]

![.. ..gitbook/assets/pglogin3.png]

# Keep pgAdmin4 running backstage

If the service closes next time the installation user (in this case `root ') must use pgadmin4 to enter the root directory, perform the following command:

```sh '
Root@ykla:#sourcepgadmin4/bin/activate.csh
(pgadmin4) root@ykla:~pgadmin4 &
````

Hint: `& ` means backstage running

After service starts, enter ` ` `in the current interface, press the Return key to switch to the front desk command line to allow the service program to run backstage.

Upgrade pgAdmin4

This is a test of whether to use a pip directly to upgrade an old version.

The pgadmin4 update is more frequent, if it is necessary to upgrade the pgadmin4 directory created with the original virtualenv and then execute the following instructions again with the installed user:

``Python '
Root@ykla:~virtualenv-3.8 pgadmin4
````

Activate after Virtual Directory is created

``Python '
Root@ykla:#sourcepgadmin4/bin/activate.csh
````

Do not open service after active, directly execute upgrade

``Python '
(pgadmin4) root@ykla:~ip install --upgrad pgadmin4
````

Start-up after upgrade

``Python '
(pgadmin4) root@ykla:#pgadmin4
````

The login account and password are still the same (no update hint after login, see the version as the latest).
。