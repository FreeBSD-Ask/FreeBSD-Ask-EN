# Section 17.6 NextClaud - Based on PostgreSQL


# Install nextcloud


For ease of installation, use Ports instead of pkg:

```sh '
#cd/usr/ports/www/textcloud/
# make config
````

`PGSQL ' , `SMB ' , `PCNTL ' ; untick `MYSQL ' :

[nextcloud Port] (..gitbook/assets/ports-netclould-pgsql.png)

Compile installation:

```sh '
# Make BATCH=yes important clean
````

# Install Configuration PostgreSQL

Installation (please note the `postgresql-client ' version of the above default ports installation and try to be as consistent as possible)

Note**
>
>To install `databases/php83-pdo_pgsql', php version should be the same if you use pkg installation

```sh '
# pkg install postgresql16-server
````

Or:

```sh '
#cd/usr/ports/datases/postgresql16-server/
# Make install clean
````

Configure:

```sh '
# service postgresql available
Postgresql available in/etc/rc.conf
````

Initialize Database

```sh '
# service postgresql initdb
The files coming to this data system will be owned by us.
This user must also own the service process.

The data ruler will be intitiated with this local situation:
No, no, no, no.
LC_COLLATE:
LC_CTYPE: C.UTF-8
LC_MSAGES: C.UTF-8
LC_Monetary: C.UTF-8
LC_NUMERIC: C.UTF-8
LC_TIME: C.UTF-8
The default text will be set to "english".

Data page checks are disabled.

/ var/db/postgres/data16... ok
Creating subdirectors... ok
I don't know if I'm going to be able to help you with this.
I'm sorry, I'm sorry.
I'm not sure I'm going to be able to do this,
Singing default time zero...
Creating configries... ok
Running bootstream... ok
I don't know what you're talking about.
Syncing Data to Disk... ok

Initdb: warning: enabling "trust"
You can change this by tinging pg_hba. cof or using the option-A, or-auth-local and-auth-host, the next time you run initb.

You can now start the database service us:

/usr/local/bin/pg_ctl-D/var/db/postgres/data16-l logfilestart

````

``sql
Root@ykla:/usr/ports/www/nextcloud #su - postgres # switch to database user
$ /usr/local/bin/pg_ctl-D /var/db/postgres/data16/-l logfilestart#
Waiting for service to start...
I'm sorry.
$psql -Upostgres
psql (16.7)
Type "help" for help.

Postgres=#create user nextcloud; # Create the desired user
CREATE ROLE
Postgres =#\password nextcloud # Create user nextcloud password, note slash to enter: \
Enter new password for user "nextcloud":
Enter it again:
Postgres=#create database nextcloud owner=nextcloud;# Create owner of the required database
CREATE DATABASE
Postgres-#\ # exit, note the slash to enter:\
````

>** Skills**
>
>Remote access to database server please configure `/var/db/postgres/data16/pg_hba.conf ' .
>
> Example (paragraph IP `10.0.50.5/32 ' does not apply as a copy):
>
> ```sh '
>host nextcloud nextcloud 10.0.50.5/32 scram-sha-256
> ````



# Install `mod_php '

Note that the version can be judged by `php-v ' commands and must be consistent:

```sh '
#php-v
PHP 8.3.17 (cli) (built: Feb 15 2025 01:11:28) (NTS)
Copyright (c) The PHP Group
Zend Engineering v4.3.17, Copyright (c) Zend Technologies
With Zend OPcache v. 8.3.17, Copyright (c), by Zend Technologies
````

```sh '
# pkg install mod_php83
````

````
# Service php_fpm capable
# Service php_fpm start
````


# Based on Apache

```sh '
# pkg install apace24
````

Or...

```sh '
#cd/usr/ports/www/apache24/
# Make install clean
````

Configure services:

```sh '
# With service apace24 available
````

# # View Apache Configuration Method


```sh '
root@ykla:/usr/ports/www/textcloud #pkginfo-Dmod_php83
root@ykla: ~ #pkginfo-Dmod_php83
mod_php83-8.4.4_1:
On install:
*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***

Consider switching to pp-fpm and mod_fast_cgi as per Apache httpd project
See https://cwiki.apache.org/confluence/display/HTTPD/PHP-FPM
It is recommended to switch to php-fpm and mod_fast_cgi, as recommended by the Apache httpd project. For further information, see https://cwiki.apache.org/confluence/display/HTTPD/PHP-FPM

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***

If you are building PHP-based reports in poudriere (8) or Synth with ZTS capable,
I'm sorry to bother you, but I'm sorry.
If you're in poudriere (8)or the PHP base port in Synth where ZTS is enabled, add WITH_MPM=event to /etc/make.conf to prevent build failure.

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***

Make sure inex.php is part of your Directory Index.
Make sure that index.php is part of Directory Index.

You should add the following to your Apache configration file:
You should add the following to your Apache profile:

FilesMatch ".php"
Sethandler application/x-httpd-php
</FilesMatch >
"FilesMatch"
Sethandler application/x-httpd-php-source
</FilesMatch >

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
````

```sh '
root@ykla: ~pkginfo-D nextcloud-php83
Nextcloud-php83-300.0.6:
On install:
The FreeBSPackage REQUIRES the apps_paths conformation as /!
Seen in config/config.sample.php to fight/!
/! FreeBSD packages need to be configured apps_paths, as indicated in config/config.sample.php to work properly / \!

Please note that everything has been incorporated in/usr/local/www/textcloud.
Please note that all files are installed in /usr/local/www/nextcloud.

You will probably want to add an amount to your httpd.conf file,
Something like this:
You may need to add an alias to the httpd.conf file, similar to the following:

Alias /nextcloud /usr/local/www/nextcloud
AcceptPathInfo On
<Directory/usr/local/www/nextcloud>
Alloverride All
Require all Graned
</Directory >

And restart Apache.
Once the blind instarers finishes, instead configuration can
You know, when you're done 'Settings', 'Adminization'.
Oh, options are available in
Then restart Apache. Nextcloud will start a binding installation on its first visit. When the installation is complete, it can be further configured through 'Settings' and 'Admination'. More configuration options can be found in:

/usr/local/www/nextcloud/config/config.php

You can find anticipated solutions in config.docmented.php
In the same direction.
You can find an annotated configuration option in the same directory.config.documented.php. Nextcloud 's configuration document is referred to:

https://docs.nextcloud.com/server/stable/admin_manual/configuration_server

The competing options apply to the final Nextcloud settlement.
The cache option requires an additional Nextcloud configuration.

On upward:
After a version migration you should increase your nextcloud presence
We're in the middle of nowhere.
After upgrading, you should use the command line to upgrade your nextcloud instance:

oc upgrad

Merge any changes to/usr/local/www/nextcloud/.htaaccess.dist into.htaaccess
# #DO NOT CHANGE ANYTHING ABOVE THIS LINE ##'divider if it emerges)
And update the dynamic part of the file using the company:
Merge any changes in /usr/local/www/textcloud/.htaaccess.dist to the .htaaccess file (please merge to ##### DO NOT CHANGE ANYTHING ABOVE THIS LINE####' above the separator) and use the command line to update the dynamic part of the document:

This post is part of our special coverage Global Voices 2011.

As of Nextloud 27.1.0 the returned PHP version is 8.2.
Nextcloud 27.1.0, Recommended PHP version 8.2.
````


Edit `/usr/local/etc/apache24/httpd.conf ' , add:

```ini '
FilesMatch ".php"
Sethandler application/x-httpd-php
</FilesMatch >
"FilesMatch"
Sethandler application/x-httpd-php-source
</FilesMatch >

Alias /nextcloud /usr/local/www/nextcloud
AcceptPathInfo On
<Directory/usr/local/www/nextcloud>
Alloverride All
Require all Graned
</Directory >
````

Launch Apache:

```sh '
# Service apace24 start
````



# Start

`http://ip/nextcloud ' is sufficient. Replace `ip ' with your LAN ip.

[nextcloud FreeBSD installation interface] (..gitbook/assets/nextclould1.png)

Enter the login account and password you need. The rest is fine.

[nextcloud FreeBSD installation] (..gitbook/assets/nextclould2.png)

The installation is completed and reoriented to the plugin recommendation: ignore it and reposition to "http://ip/nextcloud" for normal use.

[nextcloud FreeBSD installed] (..gitbook/assets/nextclould3.png)

[nextcloud FreeBSD Start Interface] (..gitbook/assets/nextclould4.png)


# Mount samba share in nextcloud

# # Install module 'php83-pecl-smbclient '

On nextcloud serverend:

```sh '
# pkg install php83-pecl-smbclient
````

Or...

```sh '
#cd /usr/ports/net/pell-smbclient/
# Make install clean
````

Restart apace:

```sh '
# Service apace24 present
````

# # Set samba share

Find Application

[nextcloud_smb_1] (..gitbook/assets/nextcloud_smb_1.png)

External storage support found and enabled (default disabled)

[nextcloud_smb_2] (..gitbook/assets/nextcloud_smb_2.png)

Access management settings:

[nextcloud_smb_3] (..gitbook/assets/nextcloud_smb_3.p)ng)

Find managed external storage (not external storage inside "persons")

[nextcloud_smb_4] (..gitbook/assets/nextcloud_smb_4.png)

View all files, samba enabled:

[nextcloud_smb_5] (..gitbook/assets/nextcloud_smb_5png)


Remarks

Other commonly used plugins can be found in `pkg search-x nextcloud | grep php82 ' , pkg installation.

Note**
>
> Some versions before the initialization of nextcloud will have access issues. Please check the `config ' directory in `/usr/local/www/nextcloud ' and access to the following files to see if users running `apache ' can read and write.

# References

- [System requirements] (https://docs.nextcloud.com/server/latest/admin_manual/institution/system_requirements.html), version requirements for various software
- [PHP Modules & Configuration] (https://docs.nextcloud.com/server/latest/admin_manual/information/php_conformation.html), required and optional PHP modules and configurations
