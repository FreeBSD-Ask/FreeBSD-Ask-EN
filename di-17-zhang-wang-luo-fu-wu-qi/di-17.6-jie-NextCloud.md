# Section 17.6 NextClaud - Based on PostgreSQL


# install nextcloud


For ease of installation, use Ports instead of pkg:

```sh
# cd /usr/ports/www/nextcloud/
# make config # 为了方便，仅配置 nextcloud 本体
```

THIS BOX SELECTS __CODESPAN_0, __CODESPAN_1_, _CODESPAN_2_; UNCHECK __CODESPAN_3_:

[nextclaud Port] (. .gitbook/assets/ports-netclould-pgsql.png)

Compile installation:

```sh
# make BATCH=yes install clean
```

# Install Configuration PostgreSQL

Installation (please note the __CODESPAN_0_ version of the above default ports installation, as consistent as possible)

Note**
>
>For pkg installation, install __CODESPAN_0_, php version should be the same

```sh
# pkg install postgresql16-server
```

Or:

```sh
# cd /usr/ports/databases/postgresql16-server/ 
# make install clean
```

Configure:

```sh
root@ykla:~ # service postgresql enable
postgresql enabled in /etc/rc.conf
```

Initialize Database

```sh
root@ykla:~ # service postgresql initdb
The files belonging to this database system will be owned by user "postgres".
This user must also own the server process.

The data ruler will be intitiated with this local situation:
no, no, no, no
LC_COLLATE:
LC_CTYPE: C.UTF-8
LC_MSAGES: C.UTF-8
LC_MONETARY: C.UTF-8
LC_NUMERIC: C.UTF-8
LC_TIME: C.UTF-8
The default text will be set to "english".

Data page checks are disabled.

/ var/db/postgres/data16... ok
creating subdirectors... ok
i don't know if i'm going to be able to help you with this
i'm sorry, i'm sorry
i'm not sure I'm going to be able to do this
singing default time zero..
creating configries... ok
running bootstream... ok
i don't know what you're talking about
syncing data to disk... ok

initdb: warning: enabling "trust"
you can change this by tinging pg_hba. cof or using the option-A, or-auth-local and-auth-host, the next time you run initb.

You can now start the database service us:

    /usr/local/bin/pg_ctl -D /var/db/postgres/data16 -l logfile start

```

```sql
root@ykla:/usr/ports/www/nextcloud #  su - postgres #切换到数据库用户
$ /usr/local/bin/pg_ctl -D /var/db/postgres/data16/ -l logfile start # 初始化
waiting for server to start.... done
server started
$ psql -Upostgres # 进入命令模式
psql (16.7)
Type "help" for help.

postgres=#create user nextcloud; # create the desired user
CREATE ROLE
postgres =#\password nextcloud # create user nextcloud password, note slash to enter: \
Enter new password for user "nextcloud":
Enter it again:
postgres=#create database nextcloud owner=nextcloud;# create owner of the required database
CREATE DATABASE
postgres-#\ # exit, note the slash to enter:\
````

>** Skills**
>
> REMOTE ACCESS TO DATABASE SERVER PLEASE CONFIGURE __CODESPAN_0_。
>
> EXAMPLE (IP PARAGRAPH _CODESPAN_0_ < < NOT USED FOR COPYING):
>
> ```sh '
>host nextcloud nextcloud 10.0.50.5/32 scram-sha-256
> ````



# INSTALL __CODESPAN_0_

NOTE THAT THE VERSION CAN BE JUDGED BY __CODESPAN_0_ COMMAND AND MUST BE CONSISTENT:

```sh
root@ykla:~ # php -v
PHP 8.3.17 (cli) (built: Feb 15 2025 01:11:28) (NTS)
Copyright (c) The PHP Group
Zend Engine v4.3.17, Copyright (c) Zend Technologies
    with Zend OPcache v8.3.17, Copyright (c), by Zend Technologies
```

```sh
# pkg install mod_php83
```

```
# service php_fpm enable
# service php_fpm start
```


# Based on Apache

```sh
# pkg install apache24
```

Or..

```sh
# cd /usr/ports/www/apache24/ 
# make install clean
```

Configure services:

```sh
# service apache24 enable
```

# # View Apache Configuration Method


```sh
root@ykla:/usr/ports/www/nextcloud # pkg info -D mod_php83
root@ykla:~ # pkg info -D mod_php83
mod_php83-8.4.4_1:
On install:
******************************************************************************

Consider switching to pp-fpm and mod_fast_cgi as per Apache httpd project
see https://cwiki.apache.org/confluence/display/HTTPD/PHP-FPM
It is recommended to switch to php-fpm and mod_fast_cgi, as recommended by the Apache httpd project. For further information, see https://cwiki.apache.org/confluence/display/HTTPD/PHP-FPM

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***

If you are building PHP-based reports in poudriere (8) or Synth with ZTS capable,
i'm sorry to bother you, but I'm sorry.
Add WITH_MPM=event to /etc/make.conf if you build a PHP base port with ZTS enabled in poudriere (8) or Synd。

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***

Make sure inex.php is part of your Directory Index.
Make sure that index.php is part of Directory Index。

You should add the following to your Apache configration file:
You should add the following to your Apache profile:

FilesMatch ".php"
Sethandler application/x-httpd-php
</FilesMatch >
"FilesMatch"
Sethandler application/x-httpd-php-source
</FilesMatch >

*** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***
````

```sh
root@ykla:~ # pkg info -D nextcloud-php83
nextcloud-php83-30.0.6:
On install:
 /!\ The FreeBSD package REQUIRES the apps_paths configuration as    /!\
 /!\ seen in config/config.sample.php to function                    /!\
 /!\ FreeBSD 包需要配置 apps_paths，如 config/config.sample.php 中所示才能正常工作 /!\

Please note that everything has been incorporated in/usr/local/www/textcloud.
please note that all files are installed in /usr/local/www/nextcloud。

You will probably want to add an amount to your httpd.conf file,
something like this:
you may need to add an alias to the httpd.conf file, similar to the following:

    	Alias /nextcloud /usr/local/www/nextcloud
	AcceptPathInfo On
	<Directory /usr/local/www/nextcloud>
	    AllowOverride All
	    Require all granted
	</Directory>

And restart Apache
once the blind instarers finishes, instead configuration can
you know, when you're done 'Settings', 'Adminization'
oh, options are available in
Then restart Apache. Nextcloud will start a binding installation on its first visit. When the installation is complete, it can be further configured through 'Settings' and 'Admination'. More configuration options can be found in:

	/usr/local/www/nextcloud/config/config.php

You can find anticipated solutions in config.docmented.php
in the same direction
You can find an annotated configuration option in the same directory.config.documented.php. Nextcloud 's configuration document is referred to:

	https://docs.nextcloud.com/server/stable/admin_manual/configuration_server

The competing options apply to the final Nextcloud settlement.
The cache option requires an additional Nextcloud configuration。

On upward:
After a version migration you should increase your nextcloud presence
we're in the middle of nowhere
after upgrading, you should use the command line to upgrade your nextcloud instance:

oc upgrad

Merge any changes to/usr/local/www/nextcloud/.htaaccess.dist into.htaaccess
# #DO NOT CHANGE ANYTHING ABOVE THIS LINE ##'divider if it emerges)
and update the dynamic part of the file using the company:
Merge any changes in /usr/local/www/textcloud/.htaaccess.dist to the .htaaccess file (please merge to ##### DO NOT CHANGE ANYTHING ABOVE THIS LINE####' above the separator) and use the command line to update the dynamic part of the document:

this post is part of our special coverage global voices 2011

As of Nextloud 27.1.0 the returned PHP version is 8.2.
Nextcloud 27.1.0, Recommended PHP version 8.2。
````


EDIT __CODESPAN_0_, ADD:

```ini
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>
<FilesMatch "\.phps$">
    SetHandler application/x-httpd-php-source
</FilesMatch>

Alias /nextcloud /usr/local/www/nextcloud
AcceptPathInfo On
<Directory/usr/local/www/nextcloud>
Alloverride All
Require all Graned
</Directory >
````

Launch Apache:

```sh
# service apache24 start
```



# Start

It's fine. Replace __CODESPAN_1_ with your LAN ip。

[nextcloud FreeBSD integration interface]

Enter the login account and password you need. The rest is fine。

[nextcloud FreeBSD establishment] (..gitbook/assets/nextclould2.png)

the installation is completed and reoriented to the plugin recommendation: ignore it and reposition to "http://ip/nextcloud" for normal use。

[nextcloud FreeBSD agreed]

[nextcloud FreeBSD start interface] (. .gitbook/assets/nextclould4.png)


# mount samba share in nextcloud

# # INSTALL MODULE __CODESPAN_0_

on nextcloud serverend:

```sh
# pkg install php83-pecl-smbclient
```

Or..

```sh
# cd /usr/ports/net/pecl-smbclient/ 
# make install clean
```

restart apace:

```sh
# service apache24 restart
```

# # set samba share

Find Application

[nextcloud_smb_1] (..gitbook/assets/nextcloud_smb_1.png)

External storage support found and enabled (default disabled)

[nextcloud_smb_2] (..gitbook/assets/nextcloud_smb_2.png)

Access management settings:

[nextcloud_smb_3] (..gitbook/assets/nextcloud_smb_3.png)

Find managed external storage (not external storage inside "persons")

[nextcloud_smb_4] (..gitbook/assets/nextcloud_smb_4.png)

view all files, samba enabled:

[nextcloud_smb_5] (..gitbook/assets/nextcloud_smb_5png)


Remarks

Other commonly used plugins can be found in __CODESPAN_0_, pkg installation。

Note**
>
> Some versions before the initialization of nextcloud will have access problems. Please check the access rights of __CODESPAN_0 in __CODESPAN_1 _1 _ directory and its next file to see if the user running __CODESPAN_2 __ can read and write。

# References

- [Systems understandings] (https://docs.nextcloud.com/server/latest/admin_manual/international/system_requirements.html), version requirements for various software
- [PHP Modules & Configuration] (https://docs.nextcloud.com/server/latest/admin_manual/information/php_conformation.html), required and optional PHP modules and configurations
