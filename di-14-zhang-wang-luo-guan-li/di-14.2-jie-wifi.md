# Section 14.2 WiFi


>** Skills**
>
>A graphical network configuration tool similar to plasma-nm/networkmanager.
>
>- Install with pkg:
>
> ```sh '
>pkg install net-mgmt/networkmgr
> ````
>
>- or install with Ports:
>
> ```sh '
>cd /usr/ports/net-mgmt/networkmgr/
>make install clean
> ````

# General wireless card drive (based on COMFAST CF-912AC 1200M 802.11AC)

# Check if the wireless card is supported

Run `sysctl net.wlan.devices ' : He'll tell you which one your wireless card driver should use. The following should be similar:

```sh '
# Syscl net.wlan.devices
No, no, no, no.
````

If there is nothing behind the output with the colon `: ' , the probability is simply that it cannot be identified. Please replace the wireless card.

## Create 'wlan0 '

- Next, `wlan0 ' : `rtwn0 ' is created as the upper colon `: `rtwn0 ' , in this case, is `rtwn0 ' , please change to your own, copying is useless (~ unless you also use COMFAST CF-912AC 1200M 802.11AC~).

```sh '
# If config wlan0 create wlandev #
````

- Observation of `ifconfig ' output (Ethernet cards and `lo0 ' omitted):

```sh '
# If config

...some parts are omitted here...

wlan0: flags=8802 <BROADCAST, SIMPLEX, MULTICAST>Metric 0 mtu 1500
Options = 200001 < RXCSUM, RXCSUM_IPV6>
Other 20:0d:b0:c4:ab:59
I'm sorry.
""channel 1 (2412 MHz 11b)
I'm sorry, but I don't know what you're talking about.
Scanvalid 60 wme bitval 0
I'm sorry.
IEE 802.11 Wireless Ethernet effect
Status: no carrier
nd6 options =29<PERFORMND, IFDISABLED, AUTO_LINKLOCAL>
````

There should be a `wlan0 ' instead.


Scan WiFi

```sh '
# If config wlan0 up scan
SID/MSH ID BSID Chan RATE S:N INT CAPS

...some parts are omitted here...

test_5G50:d6:c5:93:d7:d7:643654M-78:-95100 EP APchanREP WPA RSN WPS BSSLOAD HTCAP VHTOMODE WME
````

Connect to unencrypted WiFi

- Set the WiFi (** without password**):

```sh '
# If config wlan0 Ssid test_5G #1
````

1 `test_5G 'WiFi name for my test (SSID)

- If you can't scan it, replace the WiFi area with China:

```sh '
# if config wlan0 destroy # if config: SIOCS80211: Device busy
# If config wlan0 create wlandev #
# ifconfig wlan0 country CN regdomain NONE # Set the area to China, use NONE
````

- Reactivate network services to access WiFi:

```sh '
♪ service net first
# Dhlit wlan0
````

# Connect to encrypted networks #


- Create `/etc/wpa_supplicant.conf ':


```sh '
I don't know.
"test_5G."
"freebsdcn."
♪ I'm sorry ♪
````

above:

- `ssid ' is WiFi, this is `test_5G '
- `psk ' is WiFi password, this is `freebsdcn '

I don't...

- Add or modify the relevant entries in `rc.conf ' as follows:

```sh '
Wlans_rtwn0
If config_wlan0
Create_args_wlan0
````

- Reboot the system.

```sh '
# Reboot
````

- Checking the connection to see that the connection has been successful (IP is `192.168.31.178 ' ):

```sh '
wlan0: flags =8843 < UP, BROADCAST, RUNING, SIMPLEX, MULTICAST > Metric 0 mtu 1500
Options = 200001 < RXCSUM, RXCSUM_IPV6>
Other 11:7c:e8:c4:ab:58
Inet. 192.168.31.78 netmask 0xffffff00 Broadcast 192.168.312.555
I'm sorry.
Ssid test_5G channel 36 (5180 MHz 11a ht/20) bssid 50:d6:c5:93:d7:64
{\cHFFFFFF}{\cH00FFFF} Regdomain's NONE country {\cHFFFFFF}{\cH00FFFF}
Dftxkey UNDEF TKIP 2:128-bit txpower 17 bmiss 7 mcastral 6
Mgmtrate 6 scanvalid 60 ht20 ampdulimit 64k
- You've got to be kidding me.
I'm sorry.
IEEE 802.11 Wireless Ethernet MCS Mode 11na
status: agreed
nd6 options =29<PERFORMND, IFDISABLED, AUTO_LINKLOCAL>
````

# Intel card drive


The iwlwifi driver [applied to] (https://wiki.freebsd.org/WiFi/Iwlwifi/Chipsets) `AC 8265, AC 9260, AC 9560, AX200, AX201, AX210, AX 211 ' and the old iwm driver Linux* support can be found in [Intel_wirewire adapter] (https://www.intel.cn/content/www/cn/zh/support/articles/00000005511/wiress.html).

I don't...

- Write the following into `/etc/rc.conf ':

```sh '
# If you still load iwm, replace it with devmtch_blocklist=if_iwm
Wlans_iwlwifi0
If config_wlan0
````

- Create `/etc/wpa_supplicant.conf ':

```sh '
I don't know.
Ssid = "WIFI Name (SSID)"
Psk= "WIFI Password"
♪ I'm sorry ♪
````

- Let's load the drive first.

```sh '
# kldload if_iwlwifi
````

- Activate WiFi. Look:

```sh '
# If config wlan0 create wlandev iwlwifi0
# /etc/rc.d/netifstart wlan0
````

(https://wiki.freebsd.org/wiFi/Iwlwifi)

# Broadcom web-driven

FreeBSD's own cartoons drive two types: bwn and bwi, of which bwi is for older models, bwn is for newer models. There is an overlap in the range of support, and bwn is better for hardware.

So, what kind of driver should we use? Reference is made to [FreeBSD Broadcom Wi-Fi Improvements] (https://www.landonf.org/code/freebsd/Bruadcom_WiFi_Improvements20180122.html). It may not be open and can be used for [archived] in the Internet archive (https://web.archive.org/web/2024020310135/https://www.landonf.org/code/freebsd/Broa)dcom_WiFi_Improvements20180122.html)

Example: BCM4301, BCM4303, BCM4306 rev 2

Only the bwi drive can be judged.

- First, add in `/boot/loader.conf ':

```sh '
If_bwi_load = "yes"
````

- Then install solids (no binary packages provided, same as:

```sh '
#cd /usr/ports/net/bwi-firmware-kmod/
# Make install clean
````

It can be installed using USB mobile phones or Ethernet. You can also place the required dependency in the directory first.

- Add in `/etc/rc.conf ':

```sh '
Wlans_bwi0
````

Restart it.

## # Example: Configure bwn driver

- Installation of solid:

```sh '
#cd/usr/ports/net/bwn-firmware-kmod/
# Make install clean
````

- Configure `/boot/loader.conf ' , add:

```sh '
If_bwn_load=YES
````

- Configure `/etc/rc.conf ' , add:

```sh '
Wlans_bwn0
````

I don't...

> ** Note**
>
> Some in [FreeBSD Broadcom Wi-Fi Improvements] (https://www.landonf.org/code/freebsd/Broadcom_WiFi_Improvements20180122.html) (possibly unopenable, using [archived] in the Internet archive The models listed (https://web.archive.org/web/202420031035/https://www.landonf.org/code/freebsd/Broadcom_WiFi_Improvements2018012.html)) are shown with `$ ' Note: `The alternative bwn (4) PHY driver is proposed from b43 GPL code, and must be technically available. ' , i.e., some GPL-based codes are required. FreeBSD basic systems, including kernels, are known to be de-engineered and therefore need to be re-compiled to support the agreement.
>
> ```sh '
> #cd /usr/src/ # This is the kernel source installation directory.
#cd sys/amd64/conf/ # pay attention to architecture!
> #cp GENERIC MYKERNEL #renamed to facilitate identification
> #echo "options BWN_GPL_PHY" > MYKERNEL # Add kernel parameters
> #cd /usr/src
> # make-j4 buildkernel KERNCONF=MYKERNEL #-j after parameter is CPU core, same as
@make-j4 installkernel KernCONF=MYKERNEL
> ````
>
> Add in `/boot/loader.conf ':
>
> ```sh '
> hw.bwn_pci.prefered=1
>if_bwn_pci_load= "YES"
>bwn_v4_ucode_load= "YES"
>bwn_v4_n_ucode_load= "YES"
>bwn_v4_lp_ucode_load= "YES"
> ````
>
> Then restart. `ifconfig ' observes the presence of `wlan0 ' , which is then configured according to the first course.

References

- [10.5. Compile and install custom kernel] (https://handbook.bsdcn.org/di-10-zhang-pei-zhi-freebsd-nei-he/10.5.-bian-yi-yu-an-zhuang-ding-zhi-nei-he.html)
- [Bruadcom Wi-Fi Modernization] (https://freebsdfoundation.org/project/broadcom-wi-fi-modernization/)
- [Revision 326841] (https://svnweb.freebsd.org/base?view=revision&revision=326841)
- [Installing Broadcom BCM43236 Wifi on 11.3 missing firmware Error] (https://forums.freebsd.org/threads/installing-broadcom-bcm43236-wifi-on-11-3-missing-firmware-error76470/)
- <https://github.com/helloSystem/ISO/issues/78>

# It's broken

If you can't connect or find the debugging channel

Try to select the WiFi area code `NONE ' and then `China '

- Write in `/etc/rc.conf ':

```sh '
Create_args_wlan0
````

Then restart the system.

# Disconnect # WiFi

```sh '
# If config wlan0 down
````

# # WPA Authentication

```sh '
# ifconfig_wlan0= "WPA inet 192.168.1.100 netmask 255.255.255.0"
````

Set static ip

```sh '
#ifconfig wlan0 inet 192.168.0.100 netmask 255.252.55.0
````

Turn on the wireless hotspot

- Make sure your card supports hostap:

```sh '
# If config wlan0 list caps
Drivercaps = 591c541 < STA, FF, IBSS, HOSTAP, SHSLOT, SHPREAMBLE, MONITOR, WPA1, WPA2, WME
cryptops=b<WEP, TKIP, AES_CCM>
htcaps =207002d <LDEC, SHOTGI20
````

You can see that my card is supported.

- Destroy them first.

```sh '
# If config wlan0 detroy
````

- Recreate.

```sh '
# If config wlan0 state wlandev rtwn0 wlanmode hostap
#ifconfig wlan0 inet 192.168.0.1 netmask 255.255.255.0 ssid freebsdap mode 11g Channel 1
````

![.. .gitbook/assets/wifi1.png]

