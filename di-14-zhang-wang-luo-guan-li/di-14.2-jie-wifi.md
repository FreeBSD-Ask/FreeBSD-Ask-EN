# Section 14.2 WiFi


>** Skills**
>
>a graphical network configuration tool similar to plasma-nm/networkmanager。
>
>- install with pkg:
>
> ```sh '
>pkg install net-mgmt/networkmgr
> ````
>
>- or install with Ports:
>
> ```sh '
>cd /usr/ports/net-mgmt/networkmgr/
>make install clean
> ````

# GENERAL WIRELESS CARD DRIVE (BASED ON COMFAST CF-912AC 1200M 802.11AC)

# Check if the wireless card is supported

RUN __CODESPAN_0: HE'LL TELL YOU WHICH ONE OF YOUR WIRELESS CARD DRIVES SHOULD BE USED. THE FOLLOWING SHOULD BE SIMILAR:

```sh
# sysctl net.wlan.devices
net.wlan.devices: rtwn0
```

IF THERE'S NOTHING ON THE BACK OF THE OUTPUT WITH THE COLON __CODESPAN_0, THE PROBABILITY IS NOT RECOGNIZED. PLEASE REPLACE THE WIRELESS CARD。

## CREATE_CODESPAN_0_

- NEXT, CREATE __CODESPAN_0: __CODESPAN_1 __ AS THE OUTPUT OF THE UPPER COLON __CODESPAN_2 __, IN THIS CASE __CODESPAN_3 __, AND CHANGE IT TO YOUR OWN, WITH NO EFFECT (~ UNLESS YOU ALSO USE COMFAST CF-912AC 1200M 802.11AC~)。

```sh
# ifconfig wlan0 create wlandev rtwn0
```

- OBSERVATION OF __CODESPAN_0_ OUTPUT (ETHERNET CARDS AND __CODESPAN_1_ OMITTED):

```sh
# ifconfig

...some parts are omitted here..

wlan0: flags=8802 <BROADCAST, SIMPLEX, MULTICAST>Metric 0 mtu 1500
options = 200001 < RXCSUM, RXCSUM_IPV6>
other 20:0d:b0:c4:ab:59
i'm sorry
""channel 1 (2412 MHz 11b)
i'm sorry, but I don't know what you're talking about
scanvalid 60 wme bitval 0
i'm sorry
iEE 802.11 Wireless Ethernet effect
status: no carrier
nd6 options =29<PERFORMND, IFDISABLED, AUTO_LINKLOCAL>
````

THERE SHOULD BE A CODESPAN THAT'S RIGHT。


Scan WiFi

```sh
# ifconfig wlan0 up scan
SSID/MESH ID                      BSSID              CHAN RATE    S:N     INT CAPS

...some parts are omitted here..

test_5G50:d6:c5:93:d7:d7:643654M-78:-95100 EP APchanREP WPA RSN WPS BSSLOAD HTCAP VHTOMODE WME
````

Connect to unencrypted WiFi

- Set the WiFi (** without password**):

```sh
# ifconfig wlan0 ssid test_5G #①
```

1_CODESPAN_0_WiFi name for my test (SSID)

- If you can't scan it, replace the WiFi area with China:

```sh
# ifconfig wlan0 destroy # 先销毁，否则提示 ifconfig: SIOCS80211: Device busy
# ifconfig wlan0 create wlandev rtwn0 # 再创建
# ifconfig wlan0 country CN regdomain NONE # 设置区域为中国，使用 NONE
```

- Reactivate network services to access WiFi:

```sh
# service netif restart
# dhclient wlan0
```

# Connect to encrypted networks #


- CREATE __CODESPAN_0_:


```sh
network={
ssid="test_5G"
psk="freebsdcn"
}
```

above:

- CODESPAN_0 is WiFi's name, and this is CODESPAN_1..
- CODESPAN_0 is the WiFi password. This is CODESPAN_1_

---|---

- ADD OR MODIFY THE FOLLOWING ENTRIES TO ___CODESPAN_0:

```sh
wlans_rtwn0="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"
create_args_wlan0="country CN regdomain NONE"
```

- Reboot the system

```sh
# reboot
```

- SEE THE CONNECTION AND SEE THE SUCCESS OF THE CONNECTION (IP IS __CODESPAN_0_):

```sh
wlan0: flags=8843<UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST> metric 0 mtu 1500
	options=200001<RXCSUM,RXCSUM_IPV6>
	ether 11:7c:e8:c4:ab:58
	inet 192.168.31.178 netmask 0xffffff00 broadcast 192.168.31.255
	groups: wlan
	ssid test_5G channel 36 (5180 MHz 11a ht/20) bssid 50:d6:c5:93:d7:64
	regdomain NONE country CN authmode WPA2/802.11i privacy ON
	deftxkey UNDEF TKIP 2:128-bit txpower 17 bmiss 7 mcastrate 6
	mgmtrate 6 scanvalid 60 ht20 ampdulimit 64k ampdudensity 4 shortgi
	-stbc -uapsd wme roaming MANUAL
	parent interface: rtwn0
	media: IEEE 802.11 Wireless Ethernet MCS mode 11na
	status: associated
	nd6 options=29<PERFORMNUD,IFDISABLED,AUTO_LINKLOCAL>
```

# Intel card drive


iwlwifi drives [Applicable] (https://wiki.freebsd.org/WiFi/Iwlwifi/Chipsets)_CODESPAN_0_ and old iwm drives contain webcards, see [Linux* support for Intel's Wirless adapter] (https://www.intel.cn/content/www/cn/zh/support/articles/00000005511/wiress.html)。

---|---

- WRITE THE FOLLOWING TO ___CODESPAN_0:

```sh
devmatch_blocklist="iwm"  # 如果依然加载 iwm，换成 devmatch_blocklist="if_iwm" 试一下
wlans_iwlwifi0="wlan0"
ifconfig_wlan0="WPA SYNCDHCP"
```

- CREATE __CODESPAN_0_:

```sh
network={
ssid="WIFI 名字（SSID）"
psk="WIFI 密码"
}
```

- Let's load the drive first

```sh
# kldload if_iwlwifi
```

- Activate WiFi. Look:

```sh
# ifconfig wlan0 create wlandev iwlwifi0
# /etc/rc.d/netif start  wlan0
```

(https://wiki.freebsd.org/wiFi/Iwlwifi)

# broadcom web-driven

FreeBSD's own cartoons drive two types: bwn and bwi, of which bwi is for older models, bwn is for newer models. There is an overlap in the range of support, and bwn is better for hardware。

So, what kind of driver should we use? For information, please refer to [FreeBSD Broadcom Wi-Fi Improvements] (https://www.landonf.org/code/freebsd/Bruadcom_WiFi_Improvements20180122.html). It may not be open and can be viewed in the [Archive] of the Internet archive (https://web.archive.org/web/2024020310235/https://www.landonf.org/code/freebsd/Broadcom_WiFi_Improvements20180122.html)。

Example: BCM4301, BCM4303, BCM4306 rev 2

only the bwi drive can be judged。

- FIRST, ADD IN __CODESPAN_0_:

```sh
if_bwi_load="YES"
```

- then install solids (no binary packages provided, same as:

```sh
# cd /usr/ports/net/bwi-firmware-kmod/
# make install clean
```

IT CAN BE INSTALLED USING USB MOBILE PHONES OR ETHERNET. YOU CAN ALSO PLACE THE REQUIRED DEPENDENCY IN THE DIRECTORY FIRST。

- ADD AT __CODESPAN_0_:

```sh
wlans_bwi0="wlan0"
 ```

Restart it。

## # example: configure bwn driver

- Installation of solid:

```sh '
#cd/usr/ports/net/bwn-firmware-kmod/
# make install clean
````

- CONFIGURE __CODESPAN_0_, ADD:

```sh
if_bwn_load="YES"
```

- CONFIGURE __CODESPAN_0_, ADD:

```sh
wlans_bwn0="wlan0"
```

---|---

> ** Note**
>
> Some of the models listed in [FreeBSD Broadcom Wi-Fi Improvements] (https://www.landonf.org/code/freebsd/Broadcom_WiFi_Improvements2018012.html) (may not be opened, can be found in the [Archive] of the Internet Archives (https://web.archive.org/web/20242020030335/https://www.landonf.org/code/freebsd/Broadcom_WiFi_Improvements2018012.html) with __CODESPAN_0_Note: _CODESPAN_1___ _ _ _CodeSPAN_ _ _ _ _ _ _ _ _ _ _Code_ _ need some code based on GPL protocols. FreeBSD basic systems, including kernels, are known to be de-engineered and therefore need to be re-compiled to support the agreement。
>
> ```sh '
> #cd /usr/src/ # this is the kernel source installation directory。
#cd sys/amd64/conf/ # pay attention to architecture
> #cp GENERIC MYKERNEL #renamed to facilitate identification
> #echo "options BWN_GPL_PHY" > MYKERNEL # Add kernel parameters
> #cd /usr/src
> # make-j4 buildkernel KERNCONF=MYKERNEL #-j after parameter is CPU core, same as
@make-j4 installkernel KernCONF=MYKERNEL
> ````
>
> ADD IN __CODESPAN_0_:
>
> ```sh '
> hw.bwn_pci.prefered=1
>if_bwn_pci_load= "YES"
>bwn_v4_ucode_load= "YES"
>bwn_v4_n_ucode_load= "YES"
>bwn_v4_lp_ucode_load= "YES"
> ````
>
> THEN RESTART. __CODESPAN_0_ TO OBSERVE THE PRESENCE OF __CODESPAN_1_, THEN CONFIGURATION ACCORDING TO THE FIRST COURSE。

References

- [10.5. Compile and install Custom kernels] (https://handbook.bsdcn.org/di-10-zhang-pei-zhi-freebsd-nei-he/10.5-bian-yi-yu-an-zhuang-ding-zhi-nei-he.html)
- [Bruadcom Wi-Fi Modernization] (https://freebsdfoundation.org/project/broadcom-wi-fi-modernization/)
- [Review 326841] (https://svnweb.freebsd.org/base?view=review &vision=326841)
- [Installing Broadcom BCM43236 Wifi on 11.3 missing first] (https://forums.freebsd.org/threads/installing-broadcom-bcm43236-wifi-on-11-3-missing-firmware-error76470/)
- <https://github.com/helloSystem/ISO/issues/78>

# It's broken

If you can't connect or find the debugging channel

Try to select __CODESPAN_0_and `China`_

- WRITE IN __CODESPAN_0_:

```sh
create_args_wlan0="country CN regdomain NONE"
```

Then restart the system。

# Disconnect # WiFi

```sh
# ifconfig wlan0 down
```

# # WPA AUTHENTICATION

```sh
# ifconfig_wlan0="WPA inet 192.168.1.100 netmask 255.255.255.0"
```

set static ip

```sh
# ifconfig wlan0 inet 192.168.0.100 netmask 255.255.255.0
```

Turn on the wireless hotspot

- make sure your card supports hostap:

```sh
root@ykla:~ # ifconfig wlan0 list caps
drivercaps=591c541<STA,FF,IBSS,HOSTAP,SHSLOT,SHPREAMBLE,MONITOR,WPA1,WPA2,WME>
cryptocaps=b<WEP,TKIP,AES_CCM>
htcaps=207002d<LDPC,SHORTGI20>
```

You can see that my card is supported。

- Destroy them first

```sh
# ifconfig wlan0 destroy
```

- Recreate

```sh
# ifconfig wlan0 create wlandev rtwn0 wlanmode hostap
# ifconfig wlan0 inet 192.168.0.1 netmask 255.255.255.0 ssid freebsdap mode 11g channel 1
```

![.. .gitbook/assets/wifi1.png]

