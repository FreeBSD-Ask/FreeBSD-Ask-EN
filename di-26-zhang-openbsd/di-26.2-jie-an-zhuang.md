# Section 26.2 Install OpenBSD


# Download mirrors

Take the OpenBSD 7.7, AMD 64-bit structure, for example, and access: <https://cdn.openbsd.org/pub/OpenBSD/7.7/amd64> for system mirrors. If you burn a U-disk installation, download __CODESPAN_0 (also supporting UEFI+BIOS); if you have virtual experience, download __CODESPAN_1_。

ISO MIRROR ALSO SUPPORTS UEFI, BIOS STARTUP。

>** Warning**
>
> As of OpenBSD 7.7, do not use Ventoy (version 1.1.05) to guide the installation of the real machine, which will be stuck in the selection section of the file set。


# INSTALLATION PROCESS (UEFI)

Use "install77.iso" and start the UEFI function for VMware virtual machines。

> Help to the OpenBSD/amd64 7.7 establishment program.
>
> (I)nstall, (U)pglade, (A)utoinstall or (S)hell?_CODESPAN_0_

ENTER __CODESPAN_0_, PRESS ** RETURN KEY**, INSTALL

♪ Choose your keyboard playout ('?', or 'L' for list) ♪?

Select the keyboard layout, press **back key**, select the default US keyboard。

> System hostname? (short form, e.g. 'foo')

SYSTEM HOSTNAME, YOU CAN SELECT ONE WITH LESS LETTERS, WHICH WILL BE DISPLAYED AS __CODESPAN_0_。

> Available network interfaces are: em0 vlan0.
>
>
♪ Here you go ♪
>
>IPu4 address for em0? (or 'autoconf' or 'none') [autoconf] # Here press ** return key** automatic DHCP IPv4
>
>IPv6 address for em0? (or 'autoconf' or 'none') [none]
>
Available network interfaces are: em0 vlan0.
>
>Netuork interface to configure? (name, Lladdr, '? ' , or 'done ' \[done] # here press ** Return key** and enter [em0] back a few steps above if you set the error。

THIS STEP SELECTS THE NETWORK CONNECTION. TO AVOID UNNECESSARY TROUBLE, PLEASE SELECT A CABLE NETWORK AS MUCH AS POSSIBLE. YOU CAN ENTER __CODESPAN_0_ FOR DETAILS OF THE NAME OF THE NETWORK BEFORE CHOOSING. FOR EXAMPLE, __CODESPAN_1 IS A CABLE NETWORK。

Follow-up configuration directly ** Back keys** confirm sufficient。

> Password for root account

sets the root account password, enter it and then back to the car for confirmation (the password is not displayed on the screen)。

> Password for root account

enter the root account password again, press ** return key** to confirm。


>Start sshd (8) by default

press **back ** confirm


> Do you want the X Windows System to be started by xenodm(1)? [no] `yes` # Enter `yes`, press ** return key**

Open xenodm to run X

> Setup a user? (inter a lower-case loginname, or 'no') \CODESPAN_0__ # Enter the username you want, press ** return key**

Sets the username。

Full user name for ykla?

User full name, enter or press **back key** default。

> Password for ykla account

Sets the password for the account (the password will not be displayed on screen). Press ** return key** confirm。

> Password for ykla account

Enter the password for the username again. Press ** return key** confirm。

>Allow root ssh login? (yes, no, prohibit-password) [no]_CODESPAN_0_

Enter __CODESPAN_0_ Press ** Return key** to confirm to allow root login ssh。

What timezone are you in? ('? for list)

ENTER __CODESPAN_0_ PRESS ** RETURN KEY** TO CONFIRM

What sub-timezone of 'Asia' are you in

ENTER __CODESPAN_0_(NOTE, __CODESPAN_1_ IS CAPITAL), PRESS ** RETURN KEY** TO CONFIRM

> Available Disks are: sd0.
>
> Encrypt the root disk? (disk, 'no' or '?' for details) [no]

Press ** Return key**, unencrypted disk。

> Available Disks are: sd0
>
> Which one is the root dissk

ENTER __CODESPAN_0_ TO VIEW HARD DRIVES:

```sh
Which disk is the root disk? (‘?‘ for details) [sd0] ?
    sd0: NVMe, VMware Virtual N, 1.3 (50.0G)
Available disks are: sd0.
Which disk is the root disk? (‘?‘ for details) [sd0]
```

THIS STEP IS TO CHOOSE WHICH PIECE OF HARD DRIVE TO INSTALL THE SYSTEM. LISTS ALL IDENTIFIED HARD DRIVES BY __CODESPAN_0_. REMEMBER ALL THE DISCS. THEN ENTER THE LOCATION THAT NEEDS TO BE INSTALLED, AS WE CHOOSE HERE ___CODESPAN_1_. ENTER __CODESPAN_2_BACK。

>Use(W)hole dissk MBR, whole disk(G)PT or (E)dit? \[gpt]

Back to the car。

> Use(A)uto playout, (E)dit auto playout, or create (C)ustom playout? >[a]

Here we go straight back to the car and choose the default partition of the system。

>** Warning**
>
> Because the distribution of storage space is extremely unreasonable, if you use automatic partitions, you will probably not be able to install any desktops。

>** Skills**
>
Custom partition settings are attached at the end of the text for information。

Available disk are: sd。

Let's install the sets!
>
[cd0] Return directly。

SOFTWARE ADDRESS, SELECT __CODESPAN_0_. HERE WE CHOOSE THE INSTALLATION DISK AS A SOFTWARE SOURCE。

> Pathname to the sets? (or 'done') [7.7/and64]。

```sh
Select sets by entering a set name, a file name pattern or 'all'. De-select
sets by prepending a '-', e.g.: '-game*'. Selected sets are labelled `[X]`

[X] bsd [X] bsd.rd [X] comp77.tgz [X] game77.tgz [X] xshare77.tgz [X] xserv77.tgz
[X] bsd.mp [X] base77.tgz [X] man77.tgz [X] xbase77.tgz [X] xfont77.tgz


Set name(s)
````

HERE WE CAN ENTER __CODESPAN_0 TO CANCEL __CODESPAN_1_1, AND ALL THE OTHERS WILL BE TICKED. OR GO STRAIGHT BACK TO THE CAR。

>** Warning**
>
> PLEASE TICK __CODESPAN_0_ IF YOU DO NOT USE THE DESKTOP, OTHERWISE SOME OF THE SOFTWARE MAY NOT RUN PROPERLY。

```sh
Set name(s)? (or 'abort' or 'done') [done] 输入 -game*

[X] bsd [X] bsd.rd [X] comp77.tgz [ ] game77.tgz [X] xshare77.tgz [X] xserv77.tgz
[X] bsd.mp [X] base77.tgz [X] man77.tgz [X] xbase77.tgz [X] xfont77.tgz

Set name(s)? [done]
Directory does not consider SHA256 sig
````


Keep going back to confirm. The installation of the system began thereafter. In about five minutes, the following hints will emerge:

[done]
>
>Time Appears wrong. Set to 'Mon Dec 16 22:43:37CST 2824'? [yes]

>** Warning**
>
>IF YOU DO NOT WANT TO GET STUCK AT __CODESPAN_0 __, PLEASE UNCONNECT THE NETWORK BEFORE PRESSING BACK TO THE CAR, AT THIS TIME。

```sh
CONGRATULATIONS! Your OpenBSD install has been successfully completed!

When you login to your new system the first time, please read your mail
i'm sorry, using the 'mail' code.

Exit to (S)heLL, (H)alt or (R) emboot
# Press back to reboot into the new system
````

Congratulations! The system has been successfully installed and is accessible once restarted。

>** Warning**
>
>IF YOU DO NOT WANT TO ENCOUNTER A __CODESPAN_0_1_ ERROR, RESTORE THE NETWORK CONNECTION BEFORE RESTARTING。

# Appendix: Custom partitions

Automatically installed partitions are as follows:

```sh
ykla# cat /etc/fstab                                                                                            
798e155a2c1de208.b none swap sw
798e155a2c1de208.a / ffs rw 1 1
798e155a2c1de208.l /home ffs rw,nodev,nosuid 1 2
798e155a2c1de208.d /tmp ffs rw,nodev,nosuid 1 2
798e155a2c1de208.f /usr ffs rw,nodev 1 2
798e155a2c1de208.g /usr/X11R6 ffs rw,nodev 1 2
798e155a2c1de208.h /usr/local ffs rw,wxallowed,nodev 1 2
798e155a2c1de208.k /usr/obj ffs rw,nodev,nosuid 1 2
798e155a2c1de208.j /usr/src ffs rw,nodev,nosuid 1 2
798e155a2c1de208.e /var ffs rw,nodev,nosuid 1 2
```

```sh
ykla# disklabel -h sd0
# /dev/rsd0c:
type: SCSI
disk: SCSI disk
label: VMware Virtual N
duid: 798e155a2c1de208
flags:
bytes/sector: 512
sectors/track: 63
tracks/cylinder: 255
sectors/cylinder: 16065
cylinders: 10443
total sectors: 167772160 # total bytes: 81920.0M
boundstart: 532544
boundend: 167772127

16 parties:
# size among fstype
a: 1024.0M 532544 4.2BSD 2048 16384 12960 # /
b: 3343.4M 2629696 swap # none
c: 812.0M 0 unused
d: 4096.0M 9477056 4.2BSD 2048 16384 12960 #/tmp
e: 9268.1M 178656664 4.2BSD 2048 16384 12960 #/var
f: 8567.8M 36846784 4.2BSD 2048 16384 12960 #/usr
g: 1024.0M 54393600 4.2BSD 2048 16384 12960 #/usr/X11R6
h: 11625.7M 56490752 4.2BSD 2048 16384 12960 /usr/local
i: 260.0M 64 MSCOS
j: 2913.5M 80300160 4.2BSD 2048 16384 12960 /usr/src
k: 614.0M 86267104 4.2BSD 2048 16384 12960 #/usr/obj
l: 33653.4M 98850016 4.2BSD 2048 16384 12960 #/home
````

- 400G HARDDISK AUTOMATIC PARTITION AS FOLLOWS:

```
ykla# df -h
Filesystem     Size    Used   Avail Capacity  Mounted on
/dev/sd0a      986M    128M    809M    14%    /
/dev/sd0l      295G   36.0K    281G     1%    /home
/dev/sd0d      3.9G   12.0K    3.7G     1%    /tmp
/dev/sd0f     29.1G    1.4G   26.2G     6%    /usr
/dev/sd0g      986M    321M    615M    35%    /usr/X11R6
/dev/sd0h     19.4G    146K   18.4G     1%    /usr/local
/dev/sd0k      5.8G    2.0K    5.5G     1%    /usr/obj
/dev/sd0j      4.8G    2.0K    4.6G     1%    /usr/src
/dev/sd0e     11.5G    8.0M   11.0G     1%    /var
```

---|---

WHEN PARTITIONING THE SYSTEM, SELECT __CODESPAN_0_(__CODESPAN_1_), I.E. __CODESPAN_2_。

> __CODESPAN_0_(SPACE BETWEEN NOTES)

ENTER __CODESPAN_0_ TO DISPLAY THE HARD DRIVE. OTHER OPTIONS ARE AS FOLLOWS:

| Code | Role |
| :--: | :----------: |
| pm | View Partition Size |
| A | Auto Partition |
| a | Add Division |
| d | Remove Partition |
| z | Remove all partitions |
| q | Confirm Division |

Assuming 80GB capacity, partitions can be set up: __CODESPAN_0, __CODESPAN_1_75G, __ CODESPAN_2_ with the remaining full capacity. ** Orders cannot be moved, otherwise they cannot be activated! You have to split one /, then swap. Basic thinking: Automatic partitions - > Delete partitions other than i - > minutes/ > swap**

> delete existing partitions using __CODESPAN_0, but will retain __CODESPAN_1_ Division, EFI Division (OpenBSD 7.5 and above, **7.5 below, delete all partitions except MSCOS**)
>
> Namely:
>
> ```sh '
>p m
>OpenBSD area: 532544-167772127; size: 81660.0M; free: 81660.0M
> size among fstype [fsize bsize cpg]
>c: 812.0M 0 unused
>i: 260.0M 64 MSCOS
> ````


>CODESPAN_0_
>
> partition: \\[a]
>
> offset: \\ [532544]
>
> size: \\[167239583] 75G
>
> FS type: \\[4.2 BSD]
>
>mount point: > CODESPAN_0_


SETS THE 75GB/ PARTITION HERE。


>CODESPAN_0_
>
> partition: \\[b]
>
> offset: \\[157822560]
>
> size: \\ [9949567]
>
> FS type: \\[swap]


> ```sh '
>p m
>OpenBSD area: 532544-167772127; size: 81660.0M; free: 81660.0M
> size among fstype [fsize bsize cpg]
>a: 76801.8M 532544 4.2BSD 2048 16384 1 #/
>b: 4858.2M 157822560 swap
>c: 812.0M 0 unused
>i: 260.0M 64 MSCOS
> ````

NOTE THAT IN THE COLUMN __CODESPAN_0, WE DID NOT ENTER A NUMBER, BUT WENT STRAIGHT BACK TO THE CAR, WHICH MEANS THAT THE ENTIRE REMAINING CAPACITY OF THE NEXT STEP WAS GIVEN TO THE DIVISION __CODESPAN_1_。

CONFIGURE COMPLETE, REMEMBER TO ENTER __CODESPAN_0_。

>CODESPAN_0_
>
Write new label

That's it。

# upgrade from rebase to stable or current

OpenBSD [Not recommended] (https://www.openbsd.org/faq/current.html) Upgrade from release to curent, recommended for direct use [Snapshot] (https://cdn.openbsd.org/pub/OpenBSD/snapshots/) (i.e. pre-built curent)。

after testing, if you upgrade directly from rebase to current, you will be stuck here:

```sh
===> sbin/shutdown
install -c -s  -o root -g _shutdown  -m 4550 shutdown /sbin/shutdown
install -c -o root -g bin -m 444  /usr/src/sbin/shutdown/shutdown.8 /usr/share/man/man8/shutdown.8
install: unknown group _shutdown
*** Error 1 in target 'realinstall'
*** Error 1 in sbin/shutdown (<bsd.prog.mk>:157 'realinstall')
*** Error 2 in sbin (<bsd.subdir.mk>:48 'realinstall')
*** Error 2 in . (<bsd.subdir.mk>:48 'realinstall')
*** Error 2 in . (Makefile:97 'do-build')
*** Error 2 in /usr/src (Makefile:74 'build'
```

- current:

```sh
$ cd /usr
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -P src
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -P xenocara
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -P ports
```

- 7.3-stable

```sh
$ cd /usr
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -rOPENBSD_7_3 -P src
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -rOPENBSD_7_3 -P xenocara
$ cvs -qd anoncvs@anoncvs.jp.openbsd.org:/cvs checkout -rOPENBSD_7_3 -P ports
```

```sh
# cd /sys/arch/$(machine)/compile/GENERIC.MP  # 要 cvs 拉取完才有该路径
# make obj
# make config
# make -j4 && make install # 编译内核
# cd /usr/src
# make obj && make -j4 build # 编译基本系统
# sysmerge
# cd /dev && ./MAKEDEV all
# cd /usr/xenocara
# make bootstrap 
# make obj
# make build # 编译 xorg
```


# References

- [Anonymous CVS] (https://www.openbsd.org/anoncvs.html)
- [FAQ - Building the System from Source] (https://www.openbsd.org/faq/faq5.html)
- [Please... building an OpenBSD request]
