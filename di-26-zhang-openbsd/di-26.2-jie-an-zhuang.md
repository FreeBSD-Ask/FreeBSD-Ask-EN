# Section 26.2 Install OpenBSD


# Download mirrors

Take the OpenBSD 7.7, AMD 64-bit structure, for example, and access: <https://cdn.openbsd.org/pub/OpenBSD/7.7/amd64> for system mirrors. If the U-disk is written, download `install77.img ' (also supporting UEFI+BIOS); if it is virtual, download `install77.iso ' .

ISO mirror also supports UEFI, BIOS startup.

>** Warning**
>
> As of OpenBSD 7.7, do not use Ventoy (version 1.1.05) to guide the installation of the real machine, which will be stuck in the selection section of the file set.


# Installation process (UEFI)

Use "install77.iso" and start the UEFI function for VMware virtual machines.

> Help to the OpenBSD/amd64 7.7 establishment program.
>
> (I) nstall, (U) pglade, (A)utoinstall or (S)hell? 'i '

Enter `i ' , press ** Return key** for installation

♪ Choose your keyboard playout ('?', or 'L' for list) ♪

Select the keyboard layout, press **back key**, select the default US keyboard.

> System hostname?

The system hostname, which you can select for a lower letter, will be displayed as `ykla ' in the future.

> Available network interfaces are: em0 vlan0.
>
>
♪ Here you go ♪
>
>IPu4 address for em0? (or 'autoconf' or 'none') [autoconf] # Here press ** return key** automatic DHCP IPv4
>
>IPv6 address for em0? (or 'autoconf' or 'none') [none]
>
Available network interfaces are: em0 vlan0.
>
>Netuork interface to configure? (name, Lladdr, '? ' , or 'done ' \[done] # here press ** Return key** and enter [em0] back a few steps above if you set the error.

This step selects the network connection. To avoid unnecessary trouble, please select a cable network as much as possible. You can enter ' ? ' , then choose after you know the name of the network. For example, `em0 ' is a cable network.

Follow-up configuration directly ** Back keys** confirm sufficient.

> Password for root account?

Sets the root account password, enter it and then back to the car for confirmation (the password is not displayed on the screen).

> Password for root account?

Enter the root account password again, press ** Return key** to confirm.


>Start sshd (8) by default?

Press **back ** confirm.


> Do you want the X Windows System to be started by xenodm(1)?

Open xenodm to run X

> Setup a user? (enter a lower-case loginname, or 'no') \[no] `ykla ' # Enter the username you want, press ** return key**

Sets the username.

Full user name for ykla?

User full name, enter or press **back key** default.

> Password for ykla account?

Sets the password for the account (the password will not be displayed on screen). Press ** return key** confirm.

> Password for ykla account?

Enter the password for the username again. Press ** return key** confirm.

> Allow root ssh login?

Enter `yes ' to ** return key** confirm to allow root to log in ssh.

What timezone are you in?

Enter `Asia ' press ** Return Key** to confirm

>What sub-timezone of 'Asia' are you in?

Enter `Shanghai ' (note, `S ' is capital letters), press ** return key** to confirm

> Available Disks are: sd0.
>
> Encrypt the root disk? (disk, 'no' or '?' for details) [no]

Press ** Return key**, unencrypted disk.

> Available Disks are: sd0
>
Which one is the root dissk?

Enter '? ' Can View Hard Disk:

```sh '
Which disk is the root disk?
Sd0: NVME, VMware Virtual N, 1.3 (50.0G)
Available Disks are: sd0.
Which disk is the root disk?
````

This step is to choose which piece of hard drive to install the system. Press `? ' to list all identified hard drives. Remember all the discs. Then enter the location that needs to be installed, as we choose here `sd0 ' . Enter `sd0 ' to return the car.

>Use(W)hole dissk MBR, whole disk(G)PT or (E)dit? \[gpt]

Back to the car.

> Use(A)uto playout, (E)dit auto playout, or create (C)ustom playout? >[a]

Here we go straight back to the car and choose the default partition of the system.

>** Warning**
>
> Because the distribution of storage space is extremely unreasonable, if you use automatic partitions, you will probably not be able to install any desktops.

>** Skills**
>
Custom partition settings are attached at the end of the text for information.

Available disk are: sd.

Let's install the sets!
>
[cd0] Return directly.

Software address, select `cd0 ' . Here we choose the installation disk as a software source.

> Pathname to the sets? (or 'done') [7.7/and64]

```sh '
Security sets by entering a set name, a file name pattern or 'all'.
Seeds by preparing a '-', e.g.: '-game*'.

[X] bsd [X] bsd.rd [X] comp77.tgz [X] game77.tgz [X] xshare77.tgz [X] xserv77.tgz
[X] bsd.mp [X] base77.tgz [X] man77.tgz [X] xbase77.tgz [X] xfont77.tgz


Set name(s)?
````

Here we can enter `-game* ' to cancel `game75.tgz ' , and the rest is ticked. Or go straight back to the car.

>** Warning**
>
> Check the `xserv77.tgz ' option if you do not use the desktop, otherwise some of the software may not be functional.

```sh '
Set name(s)? (or 'abor 'or 'done') [done] enter -game*

[X] bsd [X] bsd.rd [X] comp77.tgz [ ] game77.tgz [X] xshare77.tgz [X] xserv77.tgz
[X] bsd.mp [X] base77.tgz [X] man77.tgz [X] xbase77.tgz [X] xfont77.tgz

Set name(s)? [done]
Directory does not contain SHA256sig[no] Yes, get back in the car.
````


Keep going back to confirm. The installation of the system began thereafter. In about five minutes, the following hints will emerge:

[done]
>
>Time Appears wrong. Set to 'Mon Dec 16 22:43:37CST 2824'? [yes]

>** Warning**
>
>If you do not want to be stuck at `fw_update ' , please unconnect the network before pressing back to the vehicle, at this point, unwieldy the network.

```sh '
Your OpenBSD has been systematically programmed!

When you login to your new system the first time, please read your mail
I'm sorry, using the 'mail' code.

Exit to (S)heLL, (H)alt or (R) emboot?
# Press back to reboot into the new system
````

Congratulations! The system has been successfully installed and is accessible once restarted.

>** Warning**
>
>Recover the network connection before restarting if `no hostkeys available invalid format ' does not want to encounter `ssh (fail) ' error.

# Appendix: Custom partitions

Automatically installed partitions are as follows:

```sh '
Ykla#cat/etc/fstab
798e155a2c1de208.b none swap sw
798e155a2c1de208.a /fs rw 1 1
798e155a2c1de208.l / home ffs rw, nodev, nosuid 1 2
798e155a2c1de208.d /tmpfs rw, nodev, nosuid 1 2
798e155a2c1de208.f /usr ffs rw, nodev 1 2
798e155a2c1de208.g /usr/X11R6fs rw, nodev 1 2
798e155a2c1de208.h /usr/localfs rw, wxallowed, nodev 1 2
798e155a2c1de208.k /usr/objfs rw, nodev, nosuid 1 2
798e155a2c1de208.j /usr/srcfs rw, nodev, nosuid 1 2
798e155a2c1de208.e / varfs rw, nodev, nosuid 1 2
````

```sh '
Ykla#dissklabel-h sd0
#/dev/rsd0c:
type: SCSI
Dist: SCSI disk
This post is part of our special coverage Syria Protests 2011.
: 798e155a2c1de208
flags:
Bytes/sector: 512
I'm sorry.
Tracks/cylinder: 255
@sect: 16065
Cylinders: 10443
# total bytes: 81920.0M
[ Chuckles ] soundstart: 532544
I'm sorry.

16 parties:
# size among fstype
a: 1024.0M 532544 4.2BSD 2048 16384 12960 # /
b: 3343.4M 2629696 swap # none
c: 812.0M 0 unused
d: 4096.0M 9477056 4.2BSD 2048 16384 12960 #/tmp
e: 9268.1M 178656664 4.2BSD 2048 16384 12960 #/var
f: 8567.8M 36846784 4.2BSD 2048 16384 12960 #/usr
g: 1024.0M 54393600 4.2BSD 2048 16384 12960 #/usr/X11R6
h: 11625.7M 56490752 4.2BSD 2048 16384 12960 /usr/local
i: 260.0M 64 MSCOS
j: 2913.5M 80300160 4.2BSD 2048 16384 12960 /usr/src
k: 614.0M 86267104 4.2BSD 2048 16384 12960 #/usr/obj
l: 33653.4M 98850016 4.2BSD 2048 16384 12960 #/home
````

- 400G harddisk automatic partition as follows:

````
Ykla#df-h
Filesystem Size Used Avail Capital Mounted on
/dev/sd0a 986M 128M 809M 14% /
/dev/sd0l 295G 36.0K 281G 1%/home
/dev/sd0d 3.9G 12.0K 3.7G 1%/tmp
/dev/sd0f 29.1G 1.4G 26.2G 6%/usr
/dev/sd0g 986M 321M 615M 35%/usr/X11R6
1%/usr/local
/dev/sd0k 5.8G 2.0K 5.5G 1%/usr/obj
/dev/sd0j 4.8G 2.0K 4.6G 1%/usr/src
/dev/sd0e 11.5G 8.0M 11.0G 1%/var
````

I don't...

When partitioning the system, select `C '(`(((C)Stom ' ) or `Custom ' .

> `p m ' (space between notes)

Enter `p m ' to display the hard drive. Other options are as follows:

Code, action, action, action.
|: --: |: |
See partition size for pm mm
|A | Automatic Partition
Zero.
|d | Delete partition
|z| Delete All Divisions
| Confirmed Zone

Assuming 80 GB capacity, subdivisions are available: `EFI 260MB ' , `75G ' , `swap ' is the remaining full capacity. ** Orders cannot be moved, otherwise they cannot be activated! You have to split one /, then swap. Basic thinking: Automatic partitions - > Delete partitions other than i - > minutes/ > swap**

> Delete existing partitions using `d ' but retain `i ' partitions as EFI Divisions (OpenBSD 7.5 and above, **7.5 below, delete all Divisions except MSDOS**)
>
> Namely:
>
> ```sh '
>p m
>OpenBSD area: 532544-167772127; size: 81660.0M; free: 81660.0M
> size among fstype [fsize bsize cpg]
>c: 812.0M 0 unused
>i: 260.0M 64 MSCOS
> ````


> `a '
>
> Partition: \\[a]
>
> offset: \\ [532544]
>
> size: \\[167239583] 75G
>
> FS type: \\[4.2 BSD]
>
>mount point: \


Sets the 75GB/ partition here.


> `a '
>
> partition: \\[b]
>
> offset: \\[157822560]
>
> size: \\ [9949567]
>
> FStype: \\[swap]


> ```sh '
>p m
>OpenBSD area: 532544-167772127; size: 81660.0M; free: 81660.0M
> size among fstype [fsize bsize cpg]
>a: 76801.8M 532544 4.2BSD 2048 16384 1 #/
>b: 4858.2M 157822560 swap
>c: 812.0M 0 unused
>i: 260.0M 64 MSCOS
> ````

Note that we did not enter values in the `size ' column, but went straight back to the car, which meant that the entire remaining capacity of the next step was given to the section, the `swap ' .

Configure complete, remember to enter `q ' confirmation.

> `q '
>
Write new label?

That's it.

# Upgrade from rebase to stable or current

OpenBSD [not recommended] (https://www.openbsd.org/faq/current.html) Upgrade from release to current, recommending direct use of [snapshot version] (https://cdn.openbsd.org/pub/OpenBSD/snapshots/) (i.e. pre-built current).

After testing, if you upgrade directly from rebase to current, you will be stuck here:

```sh '
== sync, corrected by elderman ==
Install-c-o root-g-m 4550 shutdown/sbin/shutdown
Install-c-o root-g bin-m444/usr/src/sbin/shutdown/shutdown.8/usr/share/man/man8/shutdown.8
install: unknown group_shutdown
*** Error 1 in target 'realinstall'
*** Error 1 in sbin/shutdown (<bsd.prog.mk>:157 'realinstall')
*** Error 2 in sbin (<bsd.subdir.mk>:48 'realinstall')
*** Error 2 in. (<bsd.subdir.mk>:48 'realinstall')
*** Error 2 in.
*** Error 2 in /usr/src
````

- current:

```sh '
$cd /usr
$ cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-P src
US$cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-P xenocara
US$cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-Pports
````

- 7.3-stable.

```sh '
$cd /usr
$ cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-roPENBSD_7_3-P src
US$cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-roPENBSD_7_3-P xenocara
US$cvs-qd anoncvs@anoncvs.jp.openbsd.org:/cvscheckout-roPENBSD_7_3_Pports
````

```sh '
# cd /sys/arch/$ (machine)/compile/GENERIC.MP # cvs to get the path
# Make obj
# Make config
# make-j4 & make initial # compile kernel
# cd /usr/src
# make obj & & make-j4 build
# Sysmerge
# cd /dev & . /MAKEEV all
# cd /usr/xenocara
# Make Bootstream
# Make obj
# make built # compile xorg
````


# References

- [Anonymous CVS] (https://www.openbsd.org/anoncvs.html)
- [FAQ - Building the System from Source] (https://www.openbsd.org/faq/faq5.html)
(https://man.openbsd.org/release)
