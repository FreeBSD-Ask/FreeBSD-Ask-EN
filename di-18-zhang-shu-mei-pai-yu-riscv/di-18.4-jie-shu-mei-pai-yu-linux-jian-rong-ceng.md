# Section 18.4 Berry pie and Linux compatibility layer

# Arch Linux Compatible Layer



The script reads as follows:

```sh
#/bin/sh

rootdir=/compat/arch
url = "https://mirrors.jlu.edu.cn/archlinuxarm/os/archLinuxARM-rpi-aarch64-latest.tar.gz"

"begin to install achlinux..."
"check motors..."

♪ check the linux motore
if [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start linux."
it's not a good idea

♪ check dbus
if
"dbus-daemon not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
pkg install-y dbus
;
that's it
f

if ["sysrc-n dbus_enable"]
"dbus should be able."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start dbus."
it's a service dbus start

"now we will bootstrap arclinux."

fetch $ {url}
mkdir-p {rootdir}
i'm sorry, I'm sorry
rm ArchLinuxARM-rpi-aarch64-latest.tar.gz


if it's not "YES"
"nullfs should read
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
that's it
f

if
i'm sorry
kldload-v nulls
f

"mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
echo "/tmp ${rootdir}/tmp nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home nulls rw, late 0" > /etc/fstab
"mount-al."

"for arclinux, we should change 'compat.linux.osrelease'.continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> /etc/sysctl.conf
i'm sorry, sysctl compat.linux.osrelease=6.1.45
;
that's it
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"but for easy use, i can do some init config."
"if agree: "
"i set up a search
"init pacman keeping"
"use tsinghuamiror"
"Continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"set your aschlinux by yourself.by!"
exit 0
;
[Yy] [Ee] [S] [Yy]|"]
rm ${rootdir}/etc/resolv.conf
>${rootdir}/etc/resolv.conf
/bin/bash-c "pacman-key-init"
/bin/bash-c "pacman-key-populate achlinuxarm"


epho 'Server = https://mirrors.ustc.edu.cn/archlinuxarm/$arch/$repo' >${rootdir}/etc/pacman.d/mirrorlist
 >rootdir}/etc/pacman.conf
epho 'Server = https://mirror.sjtu.edu.cn/archlinux-cn/aarch64' >${rootdir}/etc/pacman.conf
"Refresh sources and systems."
/bin/bash-c "pacman-Syyu-noconform"
"Refresh key."
/bin/bash-c "Pacman-S-noconfirm achlinuxcn-keyring"
"Install yay."
/bin/bash-c "pacman-S-noconfil-base-devel-nano-y wqy-zenhei"
"Create user."
/bin/bash-c "userad-G sheel-m test"
"Now modify the sudo configation"
epho '%heel alll=(ALL)All' > ${rootdir}/etc/sudores
epho '%sudo Alll=(All:All)All' > ${rootdir}/etc/sudores
"change fakeroot."
/bin/bash-c "pacman-S-noconfirm fakeroot-tcp"
"Make localised settings"
echo 'zh_CN.UTF-8 UTF-8' > ${rootdir}/etc/locale.gen
/bin/bash-c "locale-gen"
"all done."
;
that's it
"Now you can run 'choot /compat/arch/ bin/bash' Into ArchLinux"
````

# References

- [Raspberry Pi 4 and Arch Linux] (https://tonoo71.github.io/posts/archlinux-on-raspberrypi4)

