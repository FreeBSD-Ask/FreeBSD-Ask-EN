# Section 18.4 Berry pie and Linux compatibility layer

# Arch Linux Compatible Layer



The script reads as follows:

```sh '
#/bin/sh

Rootdir=/compat/arch
url = "https://mirrors.jlu.edu.cn/archlinuxarm/os/archLinuxARM-rpi-aarch64-latest.tar.gz"

"begin to install achlinux..."
"Check motors..."

♪ Check the linux motore
If [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
Exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"start linux."
It's not a good idea.

♪ Check dbus
If!
"dbus-daemon not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
Pkg install-y dbus
;
That's it.
F

If ["sysrc-n dbus_enable"]!
"dbus should be able."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"Start dbus."
It's a service dbus start.

"now we will bootstrap arclinux."

Fetch $ {url}
mkdir-p {rootdir}
I'm sorry, I'm sorry.
Rm ArchLinuxARM-rpi-aarch64-latest.tar.gz


If it's not "YES"
"nullfs should read.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
Exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
That's it.
F

If!
I'm sorry.
Kldload-v Nulls
F

"Mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, Mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
Echo "/tmp ${rootdir}/tmp Nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home Nulls rw, late 0" > /etc/fstab
"Mount-al."

"for arclinux, we should change 'compat.linux.osrelease'.continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
Exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> /etc/sysctl.conf
I'm sorry, sysctl compat.linux.osrelease=6.1.45
;
That's it.
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"but for easy use, I can do some init config."
"if agree: "
"I set up a search.
"Init Pacman keeping"
"use tsinghuamiror"
"Continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"Set your aschlinux by yourself.by!"
Exit 0
;
[Yy] [Ee] [S] [Yy]|"]
rm ${rootdir}/etc/resolv.conf
>${rootdir}/etc/resolv.conf
/bin/bash-c "pacman-key-init"
/bin/bash-c "pacman-key-populate achlinuxarm"


epho 'Server = https://mirrors.ustc.edu.cn/archlinuxarm/$arch/$repo' >${rootdir}/etc/pacman.d/mirrorlist
 >rootdir}/etc/pacman.conf
epho 'Server = https://mirror.sjtu.edu.cn/archlinux-cn/aarch64' >${rootdir}/etc/pacman.conf
"Refresh sources and systems."
/bin/bash"Pacman-Syyu-noconform."
"Refresh key."
/bin/bash-c "Pacman-S-noconfirm achlinuxcn-keyring"
"Install yay."
/bin/bash-c "pacman-S-noconfil-base-devel-nano-y wqy-zenhei"
"Create user."
/bin/bash-c "userad-G sheel-m test"
"Now modify the sudo configation"
epho '%heel alll=(ALL)All' > ${rootdir}/etc/sudores
epho '%sudo Alll=(All:All)All' > ${rootdir}/etc/sudores
"change fakeroot."
/bin/bash-c "pacman-S-noconfirm fakeroot-tcp"
"Make localised settings"
echo 'zh_CN.UTF-8 UTF-8' > ${rootdir}/etc/locale.gen
/bin/bash-c "locale-gen"
"all done."
;
That's it.
"Now you can run 'choot /compat/arch/ bin/bash' Into ArchLinux"
````

# References

- [Raspberry Pi 4 に Arch Linux] (https://tonoo71.github.io/posts/archlinux-on-raspberrypi4)

