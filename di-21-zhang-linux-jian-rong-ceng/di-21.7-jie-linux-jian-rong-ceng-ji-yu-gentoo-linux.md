# Section 21.7 Gentoo Linux Compatibility Layer


# Build basic systems

```sh '
# Sysrc linux_enable #
# Service Linux start
# service dbus capable # normal desktop is configured
# service dbus start # normal desktop is configured
````

```sh '
#wget https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobuilds/2023001T164658Z/sage3-amd64-systemd-202301T164658Z.tar.xx #The link is not fixed! Find yourself.
#mkdir-p /compat/gentoo
#tar xpvf status3-amd64-systemd-202330101T164658Z.tar.xx-C/compat/gentoo-numeric-owner
````

Edit `ee/etc/fstab ' , add:

```sh '
# Device Mountain FStype Options Dump Pass #
devfs /compat/gento/dev Devfs rw, late 0
tmpfs /compat/gentoo/dev/shmtmpfs rw, late, size = 1g, Mode = 1777 0 0
fdescfs/compat/gentoo/dev/fd fdescfs rw, late, linrdlnk 0
/compat/gentoo/proc Linprocfs rw, late 0
linsysfs /compat/gentoo/sys linsysfs rw, late 0 0
/tmp /compat/gento/tmp nulfs rw, late 0
#/home /compat/gentoo/home nulfs rw, late 0
````

```sh '
♪ track-al ♪
````

Edit:

`ee /compat/gentoo/etc/portage/make.conf '

Accession:

```sh '
MAKEOPTS = "-j2"
GENTOO_MIRRRORS= "https://mirrors.ustc.edu.cn/gentoo"
FEATURES = "-ipc-sandbox-mount-sandbox-network-sandbox-spid-sandbox-actr-sandbox-usersandbox"
````

Common configuration:

```sh '
#mkdir-p/compat/gentoo/etc/portage/repos.conf # at FreeBSD!
#cp /compat/gentoo/usr/share/portage/config/repos.conf /compat/gentoo/etc/portage/repos.conf/gentoo.conf #is at FreeBSD!
#cp /etc/resolv.conf /compat/gentoo/etc/ #is at FreeBSD! Copy DNS resolution.
````

# Gentoo for source

```sh '
#ee /compat/gentoo/etc/portage/repos.conf/gento.conf # this is FreeBSD!
````

Amend `sync-uri = rsync://rsync.gentoo.org/gentoo-portage ' to `sync-uri = rsync://mirrors.tsinghua.edu.cn/gentoo-portage ' .

```sh '
# Chorot /compat/gentoo / bin/bash # this is Gentoo!
````

Get Gentuo ebuild database snapshots

```sh '
# Emerge-websync
````


# After changing source

Test installation

```sh '
# Emerge-v screenfetch

?
Are you sure?


These are the packs that would be made, in order:

Calculating endeavours... done!
Dependency resolution took 2.51 s.

[ebuild N] App-misc/screenfetch-3.9.1: :gentoo USE= "-X-curl" 76 KiB

. . . . . . . . . . .

Recording app-misc/screenfetch in "world" favorites file...

Completed (1 of 1) app-misc/screenfetch-3.9.1: gentoo
````

Software can be installed normally.


```sh '
# screenfetch
grep: warning:
grep: warning:
-/Yoddmdhs+:. ykla@ykla
-OdNMMMMMMNMNmhy+-`OS: Gentoo
- yNMMMMMMMMMMMnNmmdhy+-Kernel: x86_64 Linux 6.2.10
`omMMMMMMMMMMMMMMMNmmmmddhhy/`Uptime: 1h 26m
OMMMMMMMMMNhyyohmdddhhdo ' Packages: 295
.ydMMMMMMMdhs+so/smddddhhhmdm+`Shell:bash 5.1.16
I'm sorry.
:Yehd NNMMMMMMMNNmmddddhhhyymhm: Not Found
. : +sydNMMMNNnmmddddhhhmmy Disk: 8.9G / 45G (20%)
/MMMMMNNNmmmdddhhhhmMNhs: CPU: Intel Core i5-3230M
`oNMMMMMNNNmmdddddddhdmNhs+ `RAM: 3209MiB / 4038MiB
`sNMMMMMNNNmmdddddmNMmmhs/.
/NMMMMMNNNNNmmmddddmNNdso: '
+MMMMMNNNNNNmmmmdmNMNdso/-
YMNNNNNNNmmmmNMmmhs+/-`
/HMNNNNNNNdhs++/- '
`/ohdmmddhys+++/: `
`-/////:--
ykla / #
````

# Shell script


Script content:

```sh '
#/bin/sh

Rootdir=/compat/gentoo
Fetch https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobulds/latest-stage3-amd64-systemd.txt
Gentoodownload=$US$
This post is part of our special coverage Global Development 2011.


url="https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobuilds/"

"Begin to install last Gentoo Linux..."
"Check motors..."

♪ Check the linux motore
If [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
Exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"start linux."
It's not a good idea.

♪ Check dbus
If!
"dbus-daemon not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
Pkg install-y dbus
;
That's it.
F

If ["sysrc-n dbus_enable"]!
"dbus should be able."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"Start dbus."
It's a service dbus start.

"now we will Bootstream Gentoo."

Fetch ${url}/$gentoodownload
mkdir-p {rootdir}
*.tar.nz-C {rootdir}-numeric-owner
I'm sorry stage3-amd64-system*.tar.xx

If it's not "YES"
"nullfs should read.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
Exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
That's it.
F

If!
I'm sorry.
Kldload-v Nulls
F

"Mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, Mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
Echo "/tmp ${rootdir}/tmp Nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home Nulls rw, late 0" > /etc/fstab
"Mount-al."

"For Gentoo Linux, we should change 'compat.linux.osrelease' to upgrade Linux Kernel version, continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
Exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> / etc/syscl.conf
It's a good time, sysctl compat.linux.osrelease=6.2.10
;
That's it.
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"I will set back.
"Continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"Set your Gentuo by yourself. Bye!"
Exit 0
;
[Yy] [Ee] [S] [Yy]|"]
>${rootdir}/etc/resolv.conf



"Now write MAKEOPTS FEATURES in /compat/gentoo/etc/portage/make.conf-using USTC imrors for GENTOO_MIRRORS"
"MAKEOPTS=\-j2\> /${rootdir}/etc/portage/make.conf
ec \ \ \ \ \ \ \ > > { { { { { rootdir}/etc/portage/make.conf
"FEATURES=-ipc-sandbox-mount-sandbox-network-sandbox-sandbox-xattr-sandbox-usersandbox"

"Now setting soft sources-Using TUNA imror for emerge-websync."
mkdir-p {rootdir}/etc/portage/repos.conf
cp {rootdir}/usr/share/portage/config/repos.conf {rootdir}/etc/portage/repos.conf/gentoo.conf
sed-i "'s/rsync.gento.org/mirrors.tsinghua.edu.cn/'${rootdir}/etc/portage/repos.conf/gentoo.conf

I don't know"I will run emerge-websync"
/bin/bash-c "emerge-websync"

"all done."
"Now you can run 'choot /compat/gentoo//bin/bash'Intogenoo"
;
That's it.
````

