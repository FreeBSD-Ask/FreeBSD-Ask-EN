# Section 21.6 OpenSUSE Compatibility Layer


# OpenSUSE 15.5-shell script

while the script is based on a dnf package manager, the opi automatically installs zypper to co-exist a double package manager, but requires a user (https://mirrors.tsinghua.edu.cn/help/opensuse/)。


The script reads as follows:

```sh
#/bin/sh

rootdir=/compat/suse
url = "https://download.opensuse.org/repository/Virtualization:/containers:/images:/openSUSE-Tumbleweed/container/opensuse-tumbleweed-dnf-image.x86_64-lxc-dnf.tar.xxz"

"Begin to install last Opensuse Leap..."
"check motors..."

♪ check the linux motore
if [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start linux."
it's not a good idea

♪ check dbus
if
"dbus-daemon not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
pkg install-y dbus
;
that's it
f

if ["sysrc-n dbus_enable"]
"dbus should be able."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start dbus."
it's a service dbus start

"now we will bootstrap openuse"

fetch $ {url}
mkdir-p {rootdir}
i'm sorry, I'm sorry
rm opensuse-leap-dnf-image.x86_64-lxc-dnf.tar.xxz

if it's not "YES"
"nullfs should read
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
that's it
f

if
i'm sorry
kldload-v nulls
f

"mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
echo "/tmp ${rootdir}/tmp nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home nulls rw, late 0" > /etc/fstab
"mount-al."

"for effect, we should change 'compat.linux.osrelease'.continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> / etc/syscl.conf
it's a good time, sysctl compat.linux.osrelease=6.2.10
;
that's it
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"I will set back
"Continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"set your opensuse by yourself.by!"
exit 0
;
[Yy] [Ee] [S] [Yy]|"]
>${rootdir}/etc/resolv.conf

    echo " I will install opi nano tar and vim"   
    chroot ${rootdir} /bin/bash -c "dnf update && dnf install -y  opi nano tar vim"


    echo "all done."
    echo "Now you can run '#chroot /compat/suse/ /bin/bash' Into Opensuse "

;
that's it
````

# OpenSUSE Tumbleweed-shell script

>This section is problematic and is not available for the time being。


Tumbleweed, the windroller, is a rolling update of OpenSUSE。

```sh
# fetch http://book.bsdcn.org/suset.sh
# sh suset.sh
```

The script reads as follows:

```sh
#/bin/sh

rootdir=/compat/suse
url = "https://download.opensuse.org/repository/Virtualization:/containers:/images:/openSUSE-Tumbleweed/container/opensuse-tumbleweed-dnf-image.x86_64-lxc-dnf.tar.xxz"

"Begin to install OpenSUSE Tumbleweed..."
"check motors..."

♪ check the linux motore
if [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start linux."
it's not a good idea

♪ check dbus
if
"dbus-daemon not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
pkg install-y dbus
;
that's it
f

if ["sysrc-n dbus_enable"]
"dbus should be able."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
that's it
f
"start dbus."
it's a service dbus start

"now we will bootstrap openuse"

fetch $ {url}
mkdir-p {rootdir}
i'm sorry, I'm sorry
rm opensuse-tumbleweed-dnf-image.x86_64-lxc-dnf.tar.xxz

if it's not "YES"
"nullfs should read
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
that's it
f

if
i'm sorry
kldload-v nulls
f

"mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
echo "/tmp ${rootdir}/tmp nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home nulls rw, late 0" > /etc/fstab
"mount-al."

"for effect, we should change 'compat.linux.osrelease'.continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> / etc/syscl.conf
it's a good time, sysctl compat.linux.osrelease=6.2.10
;
that's it
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"I will set back
"Continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"set your opensuse by yourself.by!"
exit 0
;
[Yy] [Ee] [S] [Yy]|"]
>${rootdir}/etc/resolv.conf

    echo " I will install opi nano tar and vim"   
    chroot ${rootdir} /bin/bash -c "dnf update && dnf install -y  opi nano tar vim"


    echo "all done."
    echo "Now you can run '#chroot /compat/suse/ /bin/bash' Into Opensuse "

;
that's it
````

# Fragmentation and unfinished business

- zypper is not available when using the LXC Leap mirror. Similarly, dnf and zypper are not available when using openSUSE Tumbleweed. The problem doesn't affect our lap script, but it affects the second wind-rolling step, which makes it impossible to use it properly. Reported in [Bug] (https://bugzilla.openuse.org/show_bug.cgi?id=1213158)。

For example, when trying to install Vim, you encounter an error message。

```sh
Installation of perl-5.36.1-1.2.x86_ 64 failed:
Error's Subprocessg faited.c Error: RPM failed: Command exited with status 1
```

In LXC Leap, replace rpm-ndb with rpm can solve this problem and dnf will not experience this problem. The problem is zypper-specific. However, in openSUSE Tumbleweed LXC, both dnf and zypper have this problem, and the replacement rpm-ndb cannot be resolved。


