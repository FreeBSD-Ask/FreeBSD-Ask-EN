# Section 21.3 Ubuntu/ Debian Compatibility Layer

Video tutorial: [06-FreeBSD-Ubuntu compatible script instructions] (https://www.bilibili.com/video/BV1iM4y1j7E9)

# Ubuntu compatibility layer

![./.gitbook/assets/UbuntuonBSD.png]

The following course was passed at the 14.2-RELEASE test. A similar approach can build the Debian Compatibility Layer. For more systems see `/usr/local/share/debootstream/scripts/ ' .

Start building Ubuntu Compatible Layer (based on Ubuntu 22.04 LTS)

```sh '
# Sysrc linux_enable #
# Service Linux start
# service dbus capable # normal desktop is configured
# service dbus start # normal desktop is configured
````

```sh '
# pkg install debootstream
#debootstream jammy /compat/ubuntu http://mirrors.ustc.edu.cn/ubuntu/
````

Mount File System

`nullfs_load= "YES" `/boot/loader.conf ' .

Write the following lines to `/etc/fstab ':

```ini '
# Device Mountain FStype Options Dump Pass #
devfs /compat/ubuntu/dev Devfs rw, late 0
tmpfs /compat/ubuntu/dev/shmtmpfs rw, late, size = 1g, Mode = 1777 0
fdescfs /compat/ubuntu/dev/fd fdescfs rw, late, linrdlnk 0 0
/compat/ubuntu/proc linprocfs rw, late 0
linsysfs /compat/ubuntu/sys linsysfs rw, late 0 0
/tmp /compat/ubuntu/tmp Nullfs rw, late 0
#/home /compat/ubuntu/home Nulls rw, late 0
````

Check the wall with no errors:

```sh '
# Mount-al
````

If the hint does not have a home folder, create it:

```sh '
#mkdir /compat/ubuntu/home
````

Restart:

```sh '
# Reboot
````

# # Enter Ubuntu Compatibility Layer

First, chorot goes in Ubuntu, removes the wrong software:

```sh '
#chroot /compat/ubuntu/bin/bash
#apt remove rsyslog # is already in Ubuntu compatibility.
````

# # Ubuntu for source

After unmounting rsyslog, switch source, as SSL certificates are not updated, the https source is not yet available:

```sh '
# ee /compat/ubuntu/etc/apt/sources.list # is in the FreeBSD system at this time! Because the Ubuntu Compatibility Layer does not yet have a text editor.
````

Writing:

```sh '
Deb http://mirrors.ustc.edu.cn/ubuntu/jammymainrestrictedunversion
%1 %2
%1 %2
_Other Organiser
%1 %1
%1 %2
%1 %1
Deb-src http://mirrors.ustc.edu.cn/ubuntu/jammy-backportsmain reported unevere
````

Enter Ubuntu Compatibility Layer, start updating the system and installing commonly used software:

```sh '
♪ LANG=C ♪ Set character set to prevent errors
#apt update & apt upgrad & apt install nano wget fonts-wqy-microhei fonts-wqy-zenhei language-pack-zh-hans # is already in Ubuntu at this time.
````


# Appendix: Ubuntu Compatible Layer Script (based on Ubuntu 22.04 LTS, FreeBSD 14.2 RELEASE Test)


The script reads as follows:

```sh '
#/bin/sh

Rootdir=/compat/ubuntu
"https://mirrors.ustc.edu.cn/ubuntu/"
@codename=jammy

"begin to install ubuntu..."
"Check motors..."

♪ Check the linux motore
If [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
Exit 1
;
*)
== sync, corrected by elderman ==
;
That's it.
F
"start linux."
It's not a good idea.

♪ Check dbus
If!
"dbus-daemon not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
Exit 2
;
*)
Pkg install-y dbus
;
That's it.
F

If ["sysrc-n dbus_enable"]!
"dbus should be able."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
I don't know"dbus not running"
Exit 2
;
*)
== sync, corrected by elderman ==
;
That's it.
F
"Start dbus."
It's a service dbus start.

If it's not true.
"debootstream not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"debootstep not incorporated"
Exit 3
;
*)
Pkg install-y debootstream
;
That's it.
F
"now we will Bootstream $ {codename}.
Now, read answer

dbootstrap ${codename} ${rootdir}${baseurl}

If it's not "YES"
"No, no, no, no.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
Exit 4
;
*)
sysrc-f /boot/loader.conf nulls_load=yes
;
That's it.
F

If!
I'm sorry.
Kldload-v Nulls
F

"Mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, Mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
Echo "/tmp ${rootdir}/tmp Nullfs rw, late 0" >/etc/fstab
"/home {rootdir}/home nulfs rw, late 0" > /etc/fstab
"Mount-al."

"Addd must attours."
Echo "deb http://mirrors.ustc.edu.cn/ubuntu/jammymain reversed multiverse" /compat/ubuntu/etc/apt/sources.list
> /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
"deb http://mirrors.ustc.edu.cn/ubuntu/jammy-updatesmain retrained United multiverse" /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
Echo "deb http://mirrors.ustc.edu.cn/ubuntu/jammy-backportsmain restricted United multiverse" /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list

"remove rsyslog and install nano fonts-wqy-microhei fonts-wqy-zenh-hans and wget"
/bin/bash-c "apt move rsyslog & apt update & apt upgrad & apt install nano wget fonts-wqy-microhei fonts-wqy-zh-hans"
"Now you can run 'choot /compat/ubuntu/bin/bash' Into Ubuntu 22.04 LTS"
````

# Appendix: Debian 12 (bookwork) (FreeBSD 14.2 RELEASE test passed)


The script reads as follows:

```sh '
#/bin/sh

Rootdir=/compat/debian
"https://mirrors.ustc.edu.cn/debian/"
Codename=bookwork

AKA bookwork...
"Check motors..."

♪ Check the linux motore
If [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
Exit 1
;
*)
== sync, corrected by elderman ==
;
That's it.
F
"start linux."
It's not a good idea.

♪ Check dbus
If!
"dbus-daemon not found.
Ri don't know.
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
Exit 2
;
*)
Pkg install-y dbus
;
That's it.
F

If ["sysrc-n dbus_enable"]!
"dbus should be able."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
Exit 2
;
*)
== sync, corrected by elderman ==
;
That's it.
F
"Start dbus."
It's a service dbus start.

If it's not true.
"debootstream not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"debootstep not incorporated"
Exit 3
;
*)
Pkg install-y debootstream
;
That's it.
F
"now we will Bootstream $ {codename}.
Now, read answer

dbootstrap ${codename} ${rootdir}${baseurl}

If it's not "YES"
"No, no, no, no.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
Exit 4
;
*)
sysrc-f /boot/loader.conf nulls_load=yes
;
That's it.
F

If!
I'm sorry.
Kldload-v Nulls
F

"Mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, Mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
Echo "/tmp ${rootdir}/tmp Nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home Nulls rw, late 0" > /etc/fstab
"Mount-al."

"Now I will change 'compat.linux.osrelease'.continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
Exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> / etc/syscl.conf
It's a good time, sysctl compat.linux.osrelease=6.2.10
;
That's it.

"Addd must attours."
/compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stablemaincontrib non-free-free-firmware" /compat/debian/etc/apt/sources.list
>/compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stable-updatesmainnon-free-firmware" /compat/debian/etc/apt/sources.list
"#deb http://mirrors.ustc.edu.cn/debian stable-proposed-updatesmain non-free-free-firmware" /compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stable-proposed-updatesmain non-free-free-firmware"
>/compat/debian/etc/apt/sources.list
"#deb-src http://mirrors.ustc.edu.cn/debian-securitymain non-freecontrib"


"install nano funts-wqy-microhei fonts-wqy-zenhai and wget"
/bin/bash-c "apt update & & apt-fix install-y & apt upgrad & apt install nano wgetfonts-wqy-microheifts-wqy-zenhei-y"
"Now you can run 'choot /compat/debian/bin/bash' Into debian 12 bookwork"
````


# Appendix: Install Windows 11 fonts (optional). Homemade, packaged and compatible debian, low Ubuntu)

```sh '
# Apt install #
# Let's go@github.com/ykla/ttf-mswin11-zh-deb
# cdtf-mswin11-zh-deb
#dpkg-i ttf-ms-win11*.deb
````

# Appendix: Run X11

```sh '
# xhost + local: # At this point in FreeBSD system!
````

# Fragmentation and unfinished business

I don't know what the program's command line is

Find in order (for example, `gedit ' ):

- Direct implementation of software package name `#gedit ';
- `whereis package name ' , positiond and executed. `whereis edit ';
- Find `#find / — name package name — `#find / — name edit ' through the `find ' command.
- Paths `/usr/share/applications ' are located through software icon positioning, software is found by the name of the software package and is opened by a text editor (e.g. `ee ' , `nano ' ). (Software icon is essentially a text file, not a soft connection or a picture) and a command to find a program to run can be copied to a terminal;

> How to find software?
>
> ```sh '
#apt search-names-only XXX
> ````
>
> Replace XXX with the name of the software you want to search for.

### # Missing .so file

- First look at which.so files are missing, usually not just one.

```sh '
Root@ykla:/#ldd/usr/bin/qq
linux_vdso.so.1 (0x007ffffffffffff000)
I don't know.
Libdl.so.2 =>/lib/x86_64-linux-gnu/libdl.so.2 (0x00000000801061000)
Libpthread.so.0 =>/lib/x86_64-linux-gnu/libpthread.so.0 (0x00000801066,000)
The following omissions
````

`libffmpeg.so = > not found , missing “libffmpeg.so”.

- Installation tool

```sh '
# Upstall anapt-file
# Put-file update #
````

- See which package `libffmpeg.so ' belongs to:

```sh '
Root@ykla:/apt-file search libffmpeg.so
qmmp: /usr/lib/qmmp/plugins/Input/libffmpeg.so
Webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSink/libffmpeg.so
Webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSrc/libffmpeg.so
Webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/VideoCapture/libffmpeg.so
Root@ykla:/#
````

You can see that several packages provide this so-called file and install one at all:

```sh '
# Upstall webcamoid-plugins
````

- Copy the file following the above path and refresh the ldd cache:

```sh '
#cp /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSink/libffmpeg.so/usr/lib# Copy to system lib
# Idconfig
````

- View:

```sh '
Root@ykla:/#ldd/usr/bin/qq
linux_vdso.so.1 (0x007ffffffffffff000)
Libffmpeg.so =>/lib/libffmpeg.so (0x00000080063,000)
The following omissions
````

# systemd with wine

Systemd is not available but can be used as `server xx start ' .

Imported [https://github.com/zq1997/deepin-wine] (https://github.com/zq1997/deepin-wine) from sources to install deepin-qq, deepin-wechat, etc., but all warn of `paragraph error ' . None of the Wine programs is running properly. If you can fix this, please raise the issue or pull.

。