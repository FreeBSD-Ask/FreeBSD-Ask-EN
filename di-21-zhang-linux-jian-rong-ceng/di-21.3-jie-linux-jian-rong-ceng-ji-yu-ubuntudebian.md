# Section 21.3 Ubuntu/ Debian Compatibility Layer

Video tutorial: [Description of the use of the 06-FreeBSD-Ubuntu compatible script] (https://www.bilibili.com/video/BV1iM4y1j7E9)

# Ubuntu compatibility layer

![./.gitbook/assets/UbuntuonBSD.png]

The following course was passed at the 14.2-RELEASE test. A similar approach can build the Debian Compatibility Layer. For more systems see __CODESPAN_0_。

Start building Ubuntu Compatible Layer (based on Ubuntu 22.04 LTS)

```sh
# sysrc linux_enable="YES"
# service linux start
# service dbus enable #一般桌面已经配置
# service dbus start #一般桌面已经配置
```

```sh
# pkg install debootstrap
# debootstrap jammy /compat/ubuntu http://mirrors.ustc.edu.cn/ubuntu/
```

Mount File System

WRITE __CODESPAN_0_IN_CODESPAN_1___。

WRITE THE FOLLOWING LINES TO __CODESPAN_0_:

```ini
# Device        Mountpoint              FStype          Options                      Dump    Pass#
devfs           /compat/ubuntu/dev      devfs           rw,late                      0       0
tmpfs           /compat/ubuntu/dev/shm  tmpfs           rw,late,size=1g,mode=1777    0       0
fdescfs         /compat/ubuntu/dev/fd   fdescfs         rw,late,linrdlnk             0       0
linprocfs       /compat/ubuntu/proc     linprocfs       rw,late                      0       0
linsysfs        /compat/ubuntu/sys      linsysfs        rw,late                      0       0
/tmp            /compat/ubuntu/tmp      nullfs          rw,late                      0       0
#/home           /compat/ubuntu/home     nullfs          rw,late                      0       0
```

Check the wall with no errors:

```sh
# mount -al
```

if the hint does not have a home folder, create it:

```sh
# mkdir /compat/ubuntu/home
```

Restart:

```sh
# reboot
```

# # Enter Ubuntu Compatibility Layer

First, chorot goes in Ubuntu, removes the wrong software:

```sh
# chroot /compat/ubuntu /bin/bash
# apt remove rsyslog # 此时已经位于 Ubuntu 兼容层了。
```

# # Ubuntu for source

After unmounting rsyslog, switch source, as SSL certificates are not updated, the https source is not yet available:

```sh
# ee /compat/ubuntu/etc/apt/sources.list # 此时处于 FreeBSD 系统！因为 Ubuntu 兼容层还没有文本编辑器。
```

Writing:

```sh
deb http://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb-src http://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse
deb http://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
deb-src http://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse
deb http://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb-src http://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse
deb http://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
deb-src http://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse
```

Enter Ubuntu Compatibility Layer, start updating the system and installing commonly used software:

```sh
# LANG=C #设定字符集，防止错误
# apt update && apt upgrade && apt install nano wget fonts-wqy-microhei  fonts-wqy-zenhei language-pack-zh-hans # 此时已经位于 Ubuntu 兼容层了。
```


# Appendix: Ubuntu Compatible Layer Script (based on Ubuntu 22.04 LTS, FreeBSD 14.2 RELEASE Test)


The script reads as follows:

```sh
#/bin/sh

rootdir=/compat/ubuntu
"https://mirrors.ustc.edu.cn/ubuntu/"
@codename=jammy

"begin to install ubuntu..."
"check motors..."

♪ check the linux motore
if [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
exit 1
;
*)
== sync, corrected by elderman ==
;
that's it
f
"start linux."
it's not a good idea

♪ check dbus
if
"dbus-daemon not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
exit 2
;
*)
pkg install-y dbus
;
that's it
f

if ["sysrc-n dbus_enable"]
"dbus should be able."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
exit 2
;
*)
== sync, corrected by elderman ==
;
that's it
f
"start dbus."
it's a service dbus start

if it's not true
"debootstream not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"debootstep not incorporated"
exit 3
;
*)
pkg install-y debootstream
;
that's it
f
"now we will bootstream $ {codename}
now, read answer

dbootstrap ${codename} ${rootdir}${baseurl}

if it's not "YES"
"No, no, no, no
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
exit 4
;
*)
sysrc-f /boot/loader.conf nulls_load=yes
;
that's it
f

if
i'm sorry
kldload-v nulls
f

"mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
echo "/tmp ${rootdir}/tmp nullfs rw, late 0" >/etc/fstab
"/home {rootdir}/home nulfs rw, late 0" > /etc/fstab
"mount-al."

"addd must attours."
echo "deb http://mirrors.ustc.edu.cn/ubuntu/jammymain reversed multiverse" /compat/ubuntu/etc/apt/sources.list
> /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
"deb http://mirrors.ustc.edu.cn/ubuntu/jammy-updatesmain retrained united multiverse" /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list
echo "deb http://mirrors.ustc.edu.cn/ubuntu/jammy-backportsmain restricted united multiverse" /compat/ubuntu/etc/apt/sources.list
>/compat/ubuntu/etc/apt/sources.list

"remove rsyslog and install nano fonts-wqy-microhei fonts-wqy-zenh-hans and wget"
/bin/bash-c "apt move rsyslog & apt update & apt upgrad & apt install nano wget fonts-wqy-microhei fonts-wqy-zh-hans"
"Now you can run 'choot /compat/ubuntu/bin/bash' Into Ubuntu 22.04 LTS"
````

# Appendix: Debian 12 (bookwork) (FreeBSD 14.2 RELEASE test passed)


The script reads as follows:

```sh
#/bin/sh

rootdir=/compat/debian
"https://mirrors.ustc.edu.cn/debian/"
codename=bookwork

aKA bookwork..
"check motors..."

♪ check the linux motore
if [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
exit 1
;
*)
== sync, corrected by elderman ==
;
that's it
f
"start linux."
it's not a good idea

♪ check dbus
if
"dbus-daemon not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
exit 2
;
*)
pkg install-y dbus
;
that's it
f

if ["sysrc-n dbus_enable"]
"dbus should be able."
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
exit 2
;
*)
== sync, corrected by elderman ==
;
that's it
f
"start dbus."
it's a service dbus start

if it's not true
"debootstream not found
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"debootstep not incorporated"
exit 3
;
*)
pkg install-y debootstream
;
that's it
f
"now we will bootstream $ {codename}
now, read answer

dbootstrap ${codename} ${rootdir}${baseurl}

if it's not "YES"
"No, no, no, no
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
exit 4
;
*)
sysrc-f /boot/loader.conf nulls_load=yes
;
that's it
f

if
i'm sorry
kldload-v nulls
f

"mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
echo "/tmp ${rootdir}/tmp nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home nulls rw, late 0" > /etc/fstab
"mount-al."

"Now I will change 'compat.linux.osrelease'.continue?"
now, read answer
if you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> / etc/syscl.conf
it's a good time, sysctl compat.linux.osrelease=6.2.10
;
that's it

"addd must attours."
/compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stablemaincontrib non-free-free-firmware" /compat/debian/etc/apt/sources.list
>/compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stable-updatesmainnon-free-firmware" /compat/debian/etc/apt/sources.list
"#deb http://mirrors.ustc.edu.cn/debian stable-proposed-updatesmain non-free-free-firmware" /compat/debian/etc/apt/sources.list
echo "#deb-src http://mirrors.ustc.edu.cn/debian stable-proposed-updatesmain non-free-free-firmware"
>/compat/debian/etc/apt/sources.list
"#deb-src http://mirrors.ustc.edu.cn/debian-securitymain non-freecontrib"


"install nano funts-wqy-microhei fonts-wqy-zenhai and wget"
/bin/bash-c "apt update & & apt-fix install-y & apt upgrad & apt install nano wgetfonts-wqy-microheifts-wqy-zenhei-y"
"Now you can run 'choot /compat/debian/bin/bash' Into debian 12 bookwork"
````


# Appendix: Install Windows 11 fonts (optional). Homemade, packaged and compatible debian, low Ubuntu)

```sh
# apt install git
# git clone https://github.com/ykla/ttf-mswin11-zh-deb
# cd ttf-mswin11-zh-deb
# dpkg -i ttf-ms-win11-*.deb
```

# APPENDIX: RUN X11

```sh
# xhost +local：#此时处于 FreeBSD 系统！
```

# Fragmentation and unfinished business

I don't know what the program's command line is

FIND IN ORDER (FOR EXAMPLE __CODESPAN_0_):

- DIRECTLY EXECUTE SOFTWARE PACKAGE NAME ___CODESPAN_0_
- CODESPAN_0_, LOCATE AND EXECUTE. ___ CODESPAN_1
- SEARCH THE WHOLE AREA OF __CODESPAN_1 _ _ __CODESPAN_2 __ BY __CODESPAN_0 __。
- POSITIONING THROUGH SOFTWARE ICONS, FINDING THE PATH ___ CODESPAN_0, FINDING THE SOFTWARE ACCORDING TO THE NAME OF THE PACKAGE, AND OPENING IT WITH A TEXT EDITOR (E.G. __CODESPAN_1 __, ___ CODESPAN_2 __). (SOFTWARE ICON IS ESSENTIALLY A TEXT FILE, NOT A SOFT CONNECTION OR A PICTURE) AND A COMMAND TO FIND A PROGRAM TO RUN CAN BE COPIED TO A TERMINAL

> How to find software
>
> ```sh '
#apt search-names-only XXX
> ````
>
> REPLACE XXX WITH THE NAME OF THE SOFTWARE YOU WANT TO SEARCH FOR。

### # missing .so file

- first look at which.so files are missing, usually not just one。

```sh
root@ykla:/# ldd /usr/bin/qq
	linux_vdso.so.1 (0x00007ffffffff000)
	libffmpeg.so => not found
	libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x0000000801061000)
	libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x0000000801066000)
…………………………以下省略……………………………………
```

See __CODESPAN_0, missing "libffmpeg.so"。

- Installation tool

```sh
# apt install apt-file
# apt-file update
```

- SEE WHICH PACKAGE __CODESPAN_0_ BELONGS TO:

```sh
root@ykla:/# apt-file search libffmpeg.so
qmmp: /usr/lib/qmmp/plugins/Input/libffmpeg.so
webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSink/libffmpeg.so
webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSrc/libffmpeg.so
webcamoid-plugins: /usr/lib/x86_64-linux-gnu/avkys/submodules/VideoCapture/libffmpeg.so
root@ykla:/#
```

you can see that several packages provide this so-called file and install one at all:

```sh
# apt install webcamoid-plugins
```

- copy the file following the above path and refresh the ldd cache:

```sh
# cp /usr/lib/x86_64-linux-gnu/avkys/submodules/MultiSink/libffmpeg.so /usr/lib # 复制到系统的 lib 中
# ldconfig
```

- View:

```sh
root@ykla:/# ldd /usr/bin/qq
	linux_vdso.so.1 (0x00007ffffffff000)
	libffmpeg.so => /lib/libffmpeg.so (0x0000000801063000)
…………………………以下省略……………………………………
```

# systemd with wine

Systemd is not available, but can be used __CODESPAN_0_。

Imported [https://github.com/zq1997/deepin-wine] (https://github.com/zq1997/deepin-wine) from sources to install deepin-qq, deepin-wechat, etc., but both hints to CODESPAN_0_. None of the Wine programs is running properly. If you can fix this, please raise the issue or pull。

