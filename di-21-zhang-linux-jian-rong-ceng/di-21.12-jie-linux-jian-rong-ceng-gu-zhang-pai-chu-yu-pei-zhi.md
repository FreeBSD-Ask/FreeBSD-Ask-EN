# Section 21.12 Linux Compatibility Fragmentation and Unfinished Matters

# Linux Compatible Sound

You may need to run the Linux program directly in the FreeBSD without sound in the current Chroot Linux compatibility layer, not chorot。

Ubuntu Compatible Layer:

EDIT __CODESPAN_0, WRITE THE FOLLOWING TWO LINES, NOTE THAT __CODESPAN_1 IS NOT A NUMBER __CODESPAN_2_。

```sh
pcm.!sysdefault pcm.plug:oss
pcm.!default pcm.sysdefault
```

# Run software directly from the FreeBSD command line (based on Ubuntu compatible)

Method to run the software from the FreeBSD command line without chroot:

One

```sh
# sysctl compat.linux.emul_path=/compat/ubuntu # 立即生效
# echo compat.linux.emul_path=/compat/ubuntu >> /etc/sysctl.conf # 永久化设置
```

Two

```sh
# mv /compat/ubuntu/lib64/ld-linux-x86-64.so.2  /compat/ubuntu/lib64/ld-linux-x86-64.so.2.back
# ln -s /compat/ubuntu/lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 /compat/ubuntu/lib64/ld-linux-x86-64.so.2
```

Then there is no need for choot to run the Linux program directly at the terminal (only partially)。

** Arch and OpenSUSE compatibility only need one, not two**

References

- [FREEBSD, SYSTEM ADMINISTRA TION Ubuntu base system into FreeBSD's Linux Binary Compatibility] (https://www.micski.dk/2021/12/21/install-ubuntu-base-system-into-freebsds-linux-binary-compatibility/)

RUN QQQ WITH NORMAL USER PRIVILEGES

Compatible layer users have uid map relationships with FreeBSD users。

Assuming that your common user name for FreeBSD is ykla, uid is 1001 (normally default 1001):

```sh
# useradd --uid 1001 --gid 0 -m ykla # 此步骤在兼容层里操作！
```

>** Warning**
>
> After creating the user ykla in Arch, this user cannot be used for the yay installation software and still need to use the test user created by the default shell script。

# Set icon double-click to start the program

- QQ.desktop content (for example, Ubuntu compatibility layer):

```ini
[Desktop Entry]
Name=QQ
Exec=/compat/ubuntu/opt/QQ/qq --no-sandbox --in-process-gpu %U
Terminal=false
Type=Application
Icon=/compat/ubuntu/usr/share/icons/hicolor/512x512/apps/qq.png
StartupWMClass=QQ
Categories=Network;
Comment=QQ
MimeType=x-scheme-handler/tencent;
```

- Chrome.desktop content (for example, Ubuntu compatible layer):

```ini
[Desktop Entry]
Version=1.0
Type=Application
Name=Chrome
Comment=
Exec=/compat/ubuntu/opt/google/chrome/chrome --no-sandbox --in-process-gpu
Icon=/compat/ubuntu/opt/google/chrome/product_logo_256.png
Path=
Terminal=false
StartupNotify=false
```

# Run Chrome

```sh
# wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb # 无需代理软件，可以直连。此时已经位于 Ubuntu 兼容层了。
# apt install ./google-chrome-stable_current_amd64.deb # 此时已经位于 Ubuntu 兼容层了。
```

```sh
# /usr/bin/google-chrome-stable --no-sandbox --no-zygote --in-process-gpu  # 此时已经位于 Ubuntu 兼容层了。
```

# proxy software (for example, clash for window)

The Linux Compatibility Layer proxy software also affects the network status of FreeBSD, so that you can install clash for windows directly on the Compatibility Layer, and you can use the Agent to access the website as if you set the Agent. Normal installation configuration is sufficient

# Linux Compatible Layer Network (Linux QQQ without Network)

If this machine has an Ethernet card em0, and a wireless card wlan0. However, using a wlan0 network, the Linux Compatibility Layer may have no network. Because FreeBSD em0 corresponds to the eth0, wlan0 corresponds to eth1 and so on. However, the Linux Compatibility Layer does not automatically identify which is netted and defaults on an eh0。

so, if ethernet em0 is useless, use wlan0, this is when you're giving a non-observed ethernet em0 just to name a non-observed ip:

- TEMPORARY SET-UP (RELAUNCH EFFECTIVE): __CODESPAN_0_
- Permanent setting: i.e., the addition of FreeBSD __CODESPAN_0_ (without prejudice to the normal use of the card):

```sh
# ifconfig_em0_alias0="inet 192.168.11.1 netmask 255.255.255.0"
```

OVER __CODESPAN_0... FOR UNDISTRIBUTED FALSE IP, YOU CAN SET YOURSELF UP AS SOMETHING ELSE。

# Chinese input

PLACE __CODESPAN_1 UNDER __CODESPAN_0_ IN THE __CODESPAN_2_ DIRECTORY OF COMPATIBILITY:

```sh
export LANG=zh_CN.UTF-8
export LANGUAGE=zh_CN.UTF-8
export LC_ALL=zh_CN.UTF-8

=m=fcitx'
i'm sorry
qT_IM_MODULE=fcitx
````

If an error like sh: warning: setlocale: LC_ALL: cannott change locale (zh_CN.uTF-8) occurs. In the case of OpenSUSE, two packages __CODESPAN_0 and __CODESPAN_1 __ are installed, and re-entry is sufficient after exit of the compatibility layer. Other systems can search similar packages, such as the CentOS Compatibility Layer, which should be installed with __CODESPAN_2, __CODESPAN_3_。

# sysctl variable

```sh
# sysctl -a -d  | grep -E "linux|compat.linux"
```

You can list commonly used variables。
