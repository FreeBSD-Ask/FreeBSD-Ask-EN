# Section 21.5 ArchLinux Compatibility Layer (based on archlinux-pacman)



# Arch Linux Compatible Layer Installation Step

Switch to last source and install __CODESPAN_0_ and __CODESPAN_1_

- EDIT __CODESPAN_0_, WRITE:

```sh
FreeBSD: { url: "https://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/latest" }
```

- Installation of relevant software:

```
# pkg update && pkg install archlinux-pacman archlinux-keyring
```

Edit __CODESPAN_0_ files to join Arch Linux software repository

```sh
[core]
Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/x86_64

[extra]
Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/x86_64
````

CREATE A SOFT LINK TO POINT __CODESPAN_0_ TO __CODESPAN_1_CATALOGUE AND START __CODESPAN_2_SERVICE

```sh
# ln -s archlinux /compat/linux
# service linux enable && service linux start
```

The advantage of this is that you do not need to automount the Linux file system by manually editing the __CODESPAN_0_file on the FreeBSD layer, nor do you need to configure the __CODESPAN_1_option

Even if ___CODESPAN_1 __ were set in __CODESPAN_1 __, __CODESPAN_2 __ would have been loaded earlier than __CODESPAN_3 __, leading to the re-launching of the Linux file systems under __CODESPAN_4 __. It is then necessary to restart the ___CODESPAN_5_service manually once the system has been restarted, so that the __CODESPAN_6_ set-up becomes effective, so it is in fact the simplest and most effective to make a direct soft linkã€‚

Update the pacman source and install the C/C++ running time library for Arch Linux

```sh
# pacman -Sy glibc gcc-libs
```

5. Tie the __CODESPAN_0_file of FreeBSD layer to the Arch Linux compatibility layer

```sh
# mount -t nullfs -o ro /etc/resolv.conf /compat/archlinux/etc/resolv.conf
```

Skipping this step will result in Linux applications not performing DNS resolution properly, so that Linux applications cannot access the Internet

6. Tie __CODESPAN_0 and __CODESPAN_1_ files to Arch Linux Compatibility Layer

```sh
# mount -t nullfs -o ro /etc/passwd /compat/archlinux/etc/passwd
# mount -t nullfs -o ro /etc/group  /compat/archlinux/etc/group
```

Skipping this step will prevent Linux applications from identifying your username on the FreeBSD level so that some Linux applications display your username as __CODESPAN_0_

# About the use of Arch Linux Compatibility

You can put all the bindings involved on the FreeBSD level in ___CODESPAN_0_, edit __CODESPAN_1_, add:

```sh
/etc/resolv.conf  /compat/archlinux/etc/resolv.conf  nullfs  ro  0  0
/etc/passwd       /compat/archlinux/etc/passwd       nullfs  ro  0  0
/etc/group        /compat/archlinux/etc/group        nullfs  ro  0  0
```

To download some applications that originally only supported Linux, you can theoretically try to run on FreeBSD at this time

FreeBSD automatically calls the C/C++ running time library in Arch Linux Compatibility

# Upgrade Arch Linux Compatibility to full choot environment

If you believe you really need to upgrade the Arch Linux Compatibility to a complete chorot environment, you can fill the necessary packages with a pacman on FreeBSD

```sh
# pacman -S base
# chroot /compat/archlinux bash

# uname-srv
Linux 4.4.0 FreeBSD 13.2-RELEASE relent/13.2-n254617-525ecfdad597 GENERIC
````

# Fault removal and unfinished business

- Use AUR Helper to start installation and management of the AUR package
- Briefly parse some magic in FreeBSD Linuxulator path translation
- And how we should use this mechanism to increase productivity
