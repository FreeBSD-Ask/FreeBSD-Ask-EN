# Section 21.5 ArchLinux Compatibility Layer (based on archlinux-pacman)



# Arch Linux Compatible Layer Installation Step

Switch to last source and install `archlinux-pacman ' and `archlinux-keyring ' packages using pkg commands

- Edit `/usr/local/etc/pkg/repos/FreeBSD.conf ' to write:

```sh '
FreeBSD: {url: "https://mirrors.ustc.edu.cn/freebsd-pkg/${ABI}/latest"}
````

- Installation of relevant software:

````
# pkg update & pkg install arclinux-pacman aschlinux-keyring
````

Edit `/usr/local/etc/pacman.conf ' files to the Arch Linux software repository

```sh '
[core]
Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/x86_64

[extra]
Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/x86_64
````

3. Create soft link will point `/compat/linux ' to `/compat/archlinux ' directory and start `linux ' service

```sh '
# In-s arclinux/compat/linux
# Service Linux & service Linux start
````

The advantage of this is that you do not need to automount the Linux file system by manually editing the FreeBSD layer `/etc/fstab ' files, or configure the `compat.linux.emul_path ' option

Even if `compat.linux.emul_path ' had been set up in `etc/sysctl.conf ' files, `compat.linux.emul_path ' would have been loaded earlier than `/etc/sysctl.conf ' , leading to the re-establishment of Linux file systems under the `/compat/linux ' directory. The `linux ' service must then be restarted manually after the system has been restarted in order to make the `compat.linux.emul_path ' set-up effective, so it is in fact the simplest and most effective to make a direct soft link.

Update the pacman source and install the C/C++ running time library for Arch Linux

```sh '
# Pacman - Sy glibc gcc-libs
````

5. Tie FreeBSD layer `/etc/resolv.conf ' files to Arch Linux Compatibility

```sh '
#mount-t Nullfs-o / ec/resolv.conf/compat/archlinux/etc/resolv.conf
````

Skipping this step will result in Linux applications not performing DNS resolution properly, so that Linux applications cannot access the Internet

6. Tie FreeBSD layer `/etc/passwd ' and `/etc/group ' files to Arch Linux Compatibility

```sh '
#mount-t Nullfs-o / etc/passwd/compat/archlinux/etc/passwd
#mount-t Nullfs-o r/etc/group/compat/archlinux/etc/group
````

Skipping this step will prevent Linux applications from identifying your username on FreeBSD so that some Linux applications display your username as `I have no name! '

# About the use of Arch Linux Compatibility

You can place all the binding operations involved above in the FreeBSD layer `/etc/fstab ' and edit `/etc/fstab ' to add:

```sh '
/etc/resolv.conf /compat/archlinux/etc/resolv.conf nulfs ro 0
/etc/passwd /compat/archlinux/etc/passwd Nullfs ro 0
/etc/group /compat/archlinux/etc/groupnulfs ro 0
````

To download some applications that originally only supported Linux, you can theoretically try to run on FreeBSD at this time.

FreeBSD automatically calls the C/C++ running time library in Arch Linux Compatibility

# Upgrade Arch Linux Compatibility to full choot environment

If you believe you really need to upgrade the Arch Linux Compatibility to a complete chorot environment, you can fill the necessary packages with a pacman on FreeBSD.

```sh '
# Pacman-S base
# choroot /compat/archlinux bash

# Uname-srv
Linux 4.4.0 FreeBSD 13.2-RELEASE relent/13.2-n254617-525ecfdad597 GENERIC
````

# Fault removal and unfinished business

- Use AUR Helper to start installation and management of the AUR package
- Briefly parse some magic in FreeBSD Linuxulator path translation
- And how we should use this mechanism to increase productivity.
