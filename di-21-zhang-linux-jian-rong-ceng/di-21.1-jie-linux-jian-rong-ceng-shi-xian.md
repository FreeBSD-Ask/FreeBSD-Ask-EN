# Section 21.1 Linux Compatible Layer

Note**
>
>A common misunderstanding is to use the Linux Compatibility layer of FreeBSD as a virtual machine, which is considered to reduce the efficiency of software operations. The reality is that not only will it not be slow, but some software will run faster and more efficiently than in Linux. Because he's not a simulator, not a translation, but Linux ABI.

<https://cgit.freebsd.org/src/tree/sys/compat/linux/linux_file.c>

It's not hard to see from here. There's only one thing to do: identify Linux calls, and then find the corresponding FreeBSD calls. Put the original Linux syscall on the way to the entrance to FreeBSD syscall.

What's Linuxulator

Since we're talking about FreeBSD compatible Linux applications, we're gonna start with Linuxluator. Linuxulator means Linux Emulator -- it's easy to imagine that this is Linux simulator. Linuxulator, however, is not a traditional simulator and does not even have a FreeBSD application with a single executable. Linuxulator is just a popular name for a FreeBSD kernel module in the FreeBSD official document, which is called `linux ' .

Take a look at the `man ' page of this kernel module.

# # man page

```sh '
$ man 4 Linux
````

The output of `man 4 Linux ' is translated as follows:

I don't...

**LINUX(4)** FreeBSD kernel interface manual**LINUX(4)**

** Name**
Linux – Linux ABI support

** Introduction**
To enable Linux ABI on startup, add the following row in `rc.conf(5) ':

```sh '
== sync, corrected by elderman ==
````

** Description**
The Linux kernel module provides limited Linux ABI compatibility, allowing many unmodified Linux applications to run without virtualization and simulation. Some of the functions provided include:

- Linux to the primary system.
- Linux-specific system call.
- Special signal processing for Linux processes
- Path conversion mechanism
- Linux-specific virtual file system

The path conversion mechanism allows the Linux process to search for the file path first under `emul_path ' (defaultly `/compat/linux ' ) and then `/ ' . For example, when a Linux process tries to open `/etc/passwd ' , it first visits `/compat/linux/etc/passwd ' and backslides to `/etc/passwd ' if compatible paths do not exist. This mechanism ensures that the Linux process loads the Linux shared library rather than their corresponding FreeBSD version and provides alternative versions for some other documents and virtual file systems.

To install Linux shared library and system files to `/compat/linux ' , the Port `emulators/linux_base-c7 ' or package could be used, or the `debootstream (8) ' could be installed from `sysutils/debootstream ' .

To avoid mounting Linux-specific file systems on startup, the following rows can be added to the `rc.conf(5) ' file:

```sh '
== sync, corrected by elderman ==
````

** SYSCTL Variable**
The following variables may be used either as `sysctl (8) ' variables or as `loader (8) ' adjustable parameters:

- `compat.linux.debug'
Enables debug messages. Set to `0 ' silent. Default as '3 '. Sets to `1 ' to print debug messages and to report unrealized functions (only once). Set to `2 ' to be similar to `1 ' but also print messages (only once) for functions that have been achieved but not tested. Set to `3 ' and higher, similar to `2 ' , but no frequency limit for messages.

- `compat.linux.default_openfiles'
The default soft open file resource limit for Linux applications. Sets to '1 ' to disable this limit. Default `1024 '.

- `compat.linux.emul_path'
Path to Linux running the environment. Default `/compat/linux '.

- `compat.linux.osname'
Name of Linux kernel operating system. Default is "Linux".

- `compat.linux.osrelease'
The Linux kernel operating system release version. It is not recommended to modify this value on non-developed systems, as this may affect the way Linux programs work. Some versions of GNU libc are known to use different systems depending on the value.

- `compat.linux.oss_version'
Linux Open Audio System version. Default `198144 ' .

- `compat.linux.preserve_vstatus'
Set to 1 to prevent Linux applications from resetting VSTATUS settings for 'termios (4) '. From a user ' s point of view, this makes `SIGINFO ' valid for Linux executable. Default is '1 '.

- `compat.linux.setid_allowed'
Enables user ID and group ID settings (set-user-ID and set-group-ID) to process new process mirror files. When set to 0, the new Linux mirror always uses the `execve(2) ' caller 's voucher to ignore the mirror file mode. Because FreeBSD does not have a complete simulation of Linux environment, the missing functionality could lead to a security gap. Default is '1 '.

`compat.linux32.emulate_i386 '
Enable real i386 Linuxulator behavior in x86_64 (amd64) environment. For example, when set to `0 ' , even if `uname ' is i386 Linux executable, `uname-m ' returns "x86_64". When set to `1 ' , Linux i386 `uname-m ' returns "i686". Default is `0 '.

** Documentation**
`/compat/linux ' Linux Runtime Environment
`/compat/linux/dev ' device file system, see `devfs(5) '
`/compat/linux/dev/fd ' file descriptor system with `linrdlnk ' options mounted, see `fdescfs(5) '
`/compat/linux/dev/shm ' RAM system, see `tmpfs(5) '
`/compat/linux/proc` Linux Process File System, see `linprocfs(5) '
`/compat/linux/sys ' Linux kernel object file system, see `linsysfs(5) '

** See **
`brandelf(1), `pty(4) ' , `elf(5) ' , `fdescfs(5) ' , `linprocfs(5) ' , `linsysfs(5) ' ,
`tmpfs(5) '

History**
Linux ABI supports the first appearance in FreeBSD 2.1. Support for the amd64 binary document appears for the first time in FreeBSSD 10.3. Support for the arm64 binary file appears for the first time in FreeBSD 12.0.

**BUG**
Support for certain Linux-specific system calls and system calls parameters is still missing.

FreeBSD 14.2-RELEASE 2022 9 January

I don't...

What is this concept? So Linuxulator is neither a WSL2 shell virtual machine, nor an WINE interpretation enforcement. The rationale is that the system call request for the FreeBSD kernel to identify and capture the Linux process, to find the system call for FreeBSD, and to use the system call for FreeBSD kernel to respond to the Linux request.

Note**
>
> ** Linuxulator is a system call from FreeBSD to respond to Linux process system call requests**.

In other words, with Linuxulator's kernel module, the FreeBSD kernel can disguise itself as a Linux kernel, but in fact the Linux process is still being run by the FreeBSD kernel, and processing the Linux system is still the code in the FreeBSD kernel. And from the perspective of the FreeBSD kernel, the Linux and FreeBSD processes run through Linuxulator ** do not differ in substance**. The Linux process is the FreeBSD process.

# What's a Linux Compatible Layer

Path conversion mechanism to find `emul_path ' (default `/compat/linux) before the Linux process`) the file path under. For example, when the Linux process tries to open `/etc/passwd ' , it will actually visit `/compat/linux/etc/passwd ' unless the latter does not exist. This is used to ensure that the Linux process loads the Linux shared library, instead of the FreeBSD counterpart library with a similar name, and provides an alternative version of some other documents and virtual file systems.

# Extraterrestrial: Why use Linux Compatibility is not the philosophy of suffering?

`kldload llinux64 ' , `kldload llinux ' should not be blamed or sarcastic, even though the twig once called “the man is born, the man is born, the man is false”. The same applies to the Linux Compatibility Layer. There is nothing ridiculous about this, but similar technologies like the Win/Crossover (and even [ReactOS] (https://reactos.org/)); the Linux and Android interfaces on Windows are popular.

。