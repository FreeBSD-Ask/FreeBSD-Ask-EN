# Section 21.4 ArchLinux Compatibility Layer (based on ArchLinux Bootstream)

Video tutorial: [07-FreeBSD-ArchLinux compatible script instructions] (https://www.bilibili.com/video/BV1wg4y1w7QV)

# ArchLinux Compatibility Layer

![.. ..gitbook/assets/arch.png]


> ** Note**
>
>ArchLinux Compatibility appears to have slightly more than Ubuntu Compatibility because of the running Google Crome Browser.

Reference is made to the following section: [Arch Linux is installed from the existing Linux distribution version] (https://wiki.archlinuxcn.org/wiki/%E4BB%8E%8E%E7%E0%E6%9C%89_Linux%E5%8F%91%E8%A1%E1%8%E7%8%E8%E8%89%EE5%89%EE8%E8%E8%E3%8%E3%E8%E3%E3%E3%85_Arch_Linux)

Because the default kernel for Linux Compatibility is 3.17, it's too low. `FATL: kernel too old '. The kernel version of the Linux Compatible layer needs to be changed to 6.12.20 (or other higher) to:

```sh '
# Echo "compat.linux.osrelease=6.12.20" > /etc/syscl.conf
````

It can enter into force permanently.

# Build basic systems #

```sh '
# Sysrc linux_enable #
# Service Linux start
# service dbus capable # normal desktop is configured
# service dbus start # normal desktop is configured
````

```sh '
# mkdir-p/compat
#fetch http://mirrors.cqu.edu.cn/archlinux/so/latest/archlinux-bootstream-x86_64.tar.zst
#tar-use-compress-program=unzstd-xpvf achlinux-bootstrap-x86_64.tar.zst-C/compat-numeric-owner #tar: Error exit delayed from previous priorities. - What?
#mv /compat/ root. x86_64 /compat/arch # Rename /
````

Mount File System

`nullfs_load= "YES" `/boot/loader.conf ' .

Write the following lines to `/etc/fstab ':

```sh '
# Device Mountain FStype Options Dump Pass #
devfs /compat/arch/dev devfs rw, late 0 0
tmpfs /compat/arch/dev/shmtmpfs rw, late, size = 1g, mode = 1777 0 0
fdescfs /compat/arch/dev/fd fdescfs rw, late, linrdlnk 0
/compat/arch/proc linprocfs rw, late 0 0
linsysfs /compat/arch/sys linsysfs rw, late 0
/tmp /compat/arch/tmp nulfs rw, late 0
#/home /compat/arch/home Nulls rw, late 0
````

Check the wall with no errors:

```sh '
# Mount-al
````

If the hint does not have a home folder, create it:

```sh '
#mkdir /compat/arch/home
````

Restart:

```sh '
# Reboot
````

Basic configuration

# # Initialize pacman keyring #

```sh '
#cp /etc/resolv.conf /compat/arch/etc/ #is at FreeBSD! Copy DNS resolution.
# choroot /compat/arch / bin/bash #
# Pacman-key-init
# Pacman-key-populate arclinux
````

Change source

Because the newly installed Arch does not have any text manager, we need to edit the files in FreeBSD:

```sh '
#ee /compat/arch/etc/pacman.d/mirrorlist # Adds the following line to the top of the file.

Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
````

Installation of some basic software:

```sh '
# Pacman #
````

###archlinuxcn source configuration

```sh '
# nano/etc/pacman.conf # Add the next two rows to the bottom of the file.

[archlinuxcn]
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
````

Import key:

```sh '
# Pacman-Sarchlinuxcn-keyring
````

**tip: `locally signing letters in Keyring... `This step may take 10 minutes or more. Please wait. **

Since direct root is prohibited for yay and software like the installation aur, it is necessary to create a user with normal permission in chroot (the original user in FreeBSD tested is not available):

```sh '
# Userad-g heyl-m best
````

Edit sudo profile (not if red alert):

```sh '
# nano /etc/sudoers
````

Delete `# %heel alll=(ALL) alll ' in front of `#'.
Delete `##subdo Alll=(All:All) Alll ' before `#'.

Unmount fakeroot to fakeroot-tcp, otherwise it is not possible to use aur:

>The Bug See <https://archlinuxarm.org/forum/viewtopic.php?t=14466>

```sh '
# Pacman - S fakeroot-tcp # will ask whether to unload fakeroot, please confirm and unload.
````

Note that if a password is set for `test ' but still indicates a password error, you need to open a new terminal and enter `reboot ' to restart FreeBSD and then proceed.

Area Settings

> ** Tip: The Chinese input method cannot be used in ArchLinux graphics without setting. **

Edit `/etc/locale.gen ' , delete the note `zh_CN.UTF-8 UTF-8 ' preceding `# ' .

Regenerated area file:

```sh '
# Locale-gen
````

# Shell script

The script reads as follows:

```sh '
#/bin/sh

Rootdir=/compat/arch
url = "https://mirrors.cqu.edu.cn/archlinux/iso/latest/archlinux-bootstream-x86_64.tar.zst"

"begin to install achlinux..."
"Check motors..."

♪ Check the linux motore
If [ "$(sysrc-n linux_enable)] = "NO"; then
"Linux module should be loaded."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"linux module not loaded"
Exit 1
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"start linux."
It's not a good idea.

♪ Check dbus
If!
"dbus-daemon not found.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not mentioned"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
Pkg install-y dbus
;
That's it.
F

If ["sysrc-n dbus_enable"]!
"dbus should be able."
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"dbus not running"
Exit 2
;
[Yy] [Ee] [S] [Yy]|"]
== sync, corrected by elderman ==
;
That's it.
F
"Start dbus."
It's a service dbus start.

"now we will bootstrap arclinux."

Fetch $ {url}
mkdir /compat
= = = = = = = = =
I'm sorry archlinux-bootstream-x86_64.tar.zst
mv /compat/ root. x86_64 {rootdir}

If it's not "YES"
"nullfs should read.
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"nulfs not load"
Exit 3
;
[Yy] [Ee] [S] [Yy]|"]
sysrc-f /boot/loader.conf nulls_load=yes
;
That's it.
F

If!
I'm sorry.
Kldload-v Nulls
F

"Mount some fs for linux"
> > ecc/fstab
epho "tmpfs $ {rootdir}/dev/shmtmpfs rw, late, size=1g, Mode=17770" >/etc/fstab
>/etc/fstab
>/etc/fstab
> et ecc/fstab
Echo "/tmp ${rootdir}/tmp Nullfs rw, late 0" >/etc/fstab
#cho "/home {rootdir}/home Nulls rw, late 0" > /etc/fstab
"Mount-al."

"for arclinux, we should change 'compat.linux.osrelease'.continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"clos to access"
Exit 4
;
[Yy] [Ee] [S] [Yy]|"]
> /etc/sysctl.conf
It's not like it's a good idea, sysctl compat.linux.osrelease=6.12.20
;
That's it.
"complete!"
echo "to use: chorot $ {rootdir}/bin/bash"
echo"
"but for easy use, I can do some init config."
"if agree: "
"I set up a search.
"Init Pacman keeping"
"use tsinghuamiror"
"Continue?"
Now, read answer
If you don't mind, case dollar in
[Nn] [OO]| [Nn]
"Set your aschlinux by yourself.by!"
Exit 0
;
[Yy] [Ee] [S] [Yy]|"]
>${rootdir}/etc/resolv.conf
/bin/bash-c "pacman-key-init"
/bin/bash-c "pacman-key-populate arclinux"
Cat {rootdir}/etc/pacman.d/mirrorlist > mlst.tmp
epho 'Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch' >${rootdir}/etc/pacman.d/mirrorlist
Cat mlst.tmp > ${rootdir}/etc/pacman.d/mirrorlist
I'm sorry.
 >rootdir}/etc/pacman.conf
epho 'Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch'>${rootdir}/etc/pacman.conf
"Refresh sources and systems."
/bin/bash-c "pacman-Syyu-noconform"
"Refresh key."
/bin/bash-c "Pacman-S-noconfirm achlinuxcn-keyring"
"Install yay."
/bin/bash-c "pacman-S-noconfil-base-devel-nano-y wqy-zenhei"
"Create user."
/bin/bash-c "userad-G sheel-m test"
"Now modify the sudo configation"
echo '%heel alll=(ALL)All'>${root/etc/sudoers
epho '%sudo Alll=(All:All)All' > ${rootdir}/etc/sudores
"change fakeroot."
/bin/bash-c "pacman-S-noconfirm fakeroot-tcp"
"Make localised settings"
echo 'zh_CN.UTF-8 UTF-8' > ${rootdir}/etc/locale.gen
/bin/bash-c "locale-gen"
"all done."
;
That's it.
"Now you can run 'choot /compat/arch/ bin/bash' Into ArchLinux"
````

# References

- [linux - Linux ABI support] (https://man.freebsd.org/cgi/man.cgi?linux(4))

