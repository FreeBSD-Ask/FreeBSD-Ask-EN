Section 23.4 NTFS & Fat32

# NTFS

# install ntfs-3g

[Bug 206978 - sysutils/fuses-ntfs: Disable UBLO as it breaks mkntfs] (https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=206978) and [Bug 194526 - sysutils/fuses-ntfs: ntfs-3g with libublio lost files] (https://bugs.freebsd.org/bugzilla/show_bug.cgi?id= 194526). Do not install with pkg, use Ports:

```sh
# cd /usr/ports/filesystems/ntfs
# make config
```

[FreeBSD integration ntfs-3g] (..gitbook/assets/ntfs1.png)


UNCHECK __CODESPAN_0_, COMPILE INSTALLATION:


```sh
# make BATCH=yes install clean
```

# # configure ntfs-3g

Inserts your ntfs format hard drive/ U disk into the computer. At this point you will see its device name, for example __CODESPAN_0 (see __CODESPAN_1_)。

MODIFY ___CODESPAN_0_:

```sh
# sysrc kld_list+="fusefs"
```

create nfts partition

## # MBR PARTITION TABLE

```sh
# gpart create -s mbr da0    #  使用 mbr 分区，如果已经是，则不需要
# gpart add -t ntfs da0
```

# # GPT PARTITION TABLE

```sh
# gpart create -s gpt da0    #  使用 gpt 分区，如果已经是，则不需要
# gpart add -t ms-basic-data da0
```

format ntfs partition


```sh
# mkntfs -vf /dev/da0s1
```

- __CODESPAN_0_ MEANS FAST FORMATTING。
- __CODESPAN_0_ STANDS FOR DETAILED OUTPUT。


References

[i'm sorry, ntfs on freebsdn] (https://www.gridbugs.org/ntfs-on-freebsd/)



AUTOMOUNT NTFS

TO START THE AUTOMOUNT, AMEND _`/etc/fstab` TO ADD:

```sh
/dev/da0s1  /media/NTFS ntfs  rw,mount_prog=/usr/local/bin/ntfs-3g,late  0  0
```

MANUALLY MOUNT NTFS

```sh
# ntfs-3g  /dev/da0s1  /media/NTFS   -o  rw,uid=1000,gid=1000,umask=0
```

- IF IT IS NOT KNOWN WHICH DISK PARTITION IS NTFS, IT CAN BE VIEWED BY ORDER

```sh
# fstyp /dev/da0s1
```


- If you are wrong, try to delete the hibernation file:

```sh
# ntfs-3g  /dev/da0s1 /mnt/NTFS -o remove_hiberfile
```

- If there's still a problem:

```sh
# ntfsfix /dev/da0s1
```

Then remount。

References

- [ntfs-3g manpage] (https://www.freebsd.org/cgi/man.cgi?query=ntfs-3g&format=html). various parameters。

# FAT32 FILESYSTEM

FAT32 IS GENERALLY DISPLAYED AS __CODESPAN_1_:

```sh
# gpart show -p nda1 # 已忽略无用信息
=>      34  41942973    nda1  GPT  (20G)
  29360128   4194304  nda1p3  ms-basic-data  (2.0G) # 即为 fat32
```

Note**
>
> Remark file system type to mount

```sh
# mount -v -t msdosfs  /dev/nda1p3  /mnt # 测试挂载。-v 参数，即 Verbose 显示详细信息；- t 参数即 type（类型），指定文件系统。
/dev/nda1p3 on /mnt (msdosfs, local, writes: sync 1 async 0, reads: sync 512 async 0, fsid 7d00000032000000, vnodes: count 1 )
# ls /mnt/ # 检查挂载情况
me	test1	test2
# umount /mnt # 卸载文件系统
```

