# Section 23.1 Automount file system


# automount

Note**
>
> > CODESPAN_0_ MAY HAVE A PROBLEM OF COMPETENCE, AND USE DSBMD IF REQUESTED。

Support NTFS/FAT/exFAT/EXT2/EXT3/EXT4/UFS/HFS/XFS/ISO9660。

# install automount #

- install with pkg:

```sh
# pkg install automount
```

- Or install with Ports:

```sh
# cd /usr/ports/filesystems/automount/
# make install clean
```

Yeah。

# DSBMD AUTOMOUNT

DSBMD is the media/filesystem type detection daemon for FreeBSD, which allows the client to mount the storage device. It is configured to open the box。

# INSTALL DSBMD

- install with pkg:

```sh
# pkg install dsbmd      # 这是守护进程
# pkg install dsbmc-cli  # 命令行客户端
# pkg install dsbmc      # QT 界面客户端
```

- Or install with Ports:

```sh
# cd /usr/ports/filesystems/dsbmd/ && make install clean 	 # 这是守护进程
# cd /usr/ports/filesystems/dsbmc-cli/ && make install clean # 命令行客户端
# cd /usr/ports/filesystems/dsbmc/ && make install clean 	 # QT 界面客户端
```

THE CLIENT SELECTS A LOAD AND THE RECOMMENDED OPTION __CODESPAN_0_ FOR THE DESKTOP IS EASIER。

# # DSBMD CONFIGURATION METHOD

>** Skills**
>
> USED IN TWO PARTS, THE DAEMON AND THE CLIENT. CLIENT CAN REQUEST DSBMD TO MOUNT, UNMOUNT AND EJECT MEDIA, OR SET A CD/DVD READING SPEED. THE DAEMON EXECUTES CLIENT REQUESTS. THE DAEMON IS A SYSTEM PROCESS, SO ALL OPERATIONS CAN BE PERFORMED, AND THE CLIENT IS AN ORDINARY USER PROCESS, SO ANY USER CAN DO IT. THE UNAUTHORISED USER REQUEST WILL NOT BE EXECUTED, AND THE DAEMON WILL JUDGE ACCORDING TO THE CONFIGURATION OF THE USER AND GROUP。

- THE DÆMON CONFIGURATION FILE IS IN __CODESPAN_0_。

- DEFAULT CONFIGURATION __CODESPAN_0 AND __CODESPAN_1_ GROUPS CAN BE MOUNTED, IF NOT FOR THESE GROUPS, TO MODIFY THE CONFIGURATION FILE (SIMPLISTIC CONFIGURATION FILE)

Enable daemon:

```sh
# sysrc dsbmd_enable=YES
# service dsbmd start
```

### # QT CLIENT

__CODESPAN_0_ CLIENT WILL ONLY SEND A REQUEST TO THE DAEMON WHEN IT IS RUNNING, SO YOU HAVE TO START THE CLIENT ON THE DESKTOP。

OPEN __CODESPAN_0_, AN ICON FOR `dsbmc`_ CAN BE FOUND IN THE TRAY AREA

[♪ systray ♪]

OPEN MAIN WINDOW, __CODESPAN_0-> __CODESPAN_1, TICK `automatically mount devices` TO USE AUTOMOUNTING

[GUI](../.gitbook/assets/dsbmd_dsbmc_gui.png)

[Set Automount]

FOLLOWING THE INSERTION OF THE U-DISK, THE DESKTOP HINT IS:

[Insert Mounttip]

THE DEFAULT MOUNTED BELOW __CODESPAN_0_, IS THE CLIENT。

[mount information] (. .gitbook/assets/dsbmd_dsbmc_userm.png)

### # xfce autostart

CLICK __CODESPAN_0> `会话和启动`, CONFIGURED AS FOLLOWS:

[Turn yourself on]

# # The command line client #

```sh
% dsbmc-cli
```

- Common parameters:
- __CODESPAN_0_ EJECT
-_CODESPAN_0_MOUNT
- __CODESPAN_0_ UNMOUNT
- The following command can be written in a shell starter file, or __CODESPAN_0, __CODESPAN_1_, etc., to be mounted automatically in the backstage (of course, no interface hint)

```sh
dsbmc-cli -a&
```

### DAEMON CONFIGURATION (CONFIG FILE __CODESPAN_0_)

THE DEFAULT CONFIGURATION IS ALREADY WORKING WELL, BUT FOR MORE DETAILED MOUNT CONTROL, CHANGES THE CONFIGURATION FILE FOR THE DAEMON. THE FOLLOWING PROFILE IS IN __CODESPAN_0_。

# # ourmount description


```sh
# usermount - Controls whether DSBMD mounts devices as user. This requires the
# sysctl variable vfs.usermount is set to 1.
usermount = true
```

IN THE CONFIGURATION FILE, __CODESPAN_0_ HAS BEEN OPENED BY DEFAULT, BUT __CODESPAN_1_SYSTEM VARIABLE IS SET FOR STARTUP AND WRITTEN IN __CODESPAN_2_

```sh
vfs.usermount=1
```

- AFTER OPENING __CODESPAN_0, THE PROGRAM USED FOR MOUNTS IS PERFORMED IN USER-BASED SPACES WITHOUT OPENING __CODESPAN_1_, AND THE MOUNT IS DOMINATED BY __CODESPAN_2_ USERS。
- WHETHER OR NOT ___CODESPAN_0_, THE OWNER OF THE MOUNTED POINT IS THE CLIENT。

## # Set users allowed to mount automatically

```sh
# allow_users - Comma separated list of users who are allowed to connect.
# allow_users = jondoe, janedoe

# Allow_groups - Comma secured list of groups whose members are allowed
# to respect.
♪ allow_groups ♪
````

MODIFY __CODESPAN_0 AND __CODESPAN_1 TO MANAGE THE USER THAT CAN BE MOUNTED AUTOMATICALLY。

#### MODIFY ACCESS TO MOUNT POINT AND THE NEXT FILE DIRECTORY (E. G. NTFS)

For example, by mount NTFS file system, modify access to __CODESPAN_0 (rw-r--) and directory access to __CODESPAN_1 (rwxr-x--)。

```sh
...
ntfs_mount_cmd = "/usr/local/bin/ntfs-3g -o \"uid=${DSBMD_UID},gid=${DSBMD_GID}\" ${DSBMD_DEVICE} \"${DSBMD_MNTPT}\""
...
ntfs_mount_cmd_usr = "/sbin/mount_fusefs auto \"${DSBMD_MNTPT}\" ntfs-3g ${DSBMD_DEVICE} \"${DSBMD_MNTPT}\""
...
```

THERE ARE TWO CONFIGURATIONS FOR NTFS, AND __CODESPAN_0_ IS USED FOR __CODESPAN_1_, OR `ntfs_mount_cmd`. AMEND TO READ AS FOLLOWS:

```sh
...
ntfs_mount_cmd = "/usr/local/bin/ntfs-3g -o \"uid=${DSBMD_UID},gid=${DSBMD_GID},fmask=137,dmask=027\" ${DSBMD_DEVICE} \"${DSBMD_MNTPT}\""
...
ntfs_mount_cmd_usr = "/sbin/mount_fusefs auto \"${DSBMD_MNTPT}\" ntfs-3g -o fmask=137,dmask=027 r${DSBMD_DEVICE} \"${DSBMD_MNTPT}\""
...
```

This is the __CODESPAN_0_ mask parameter provided for the ntfs-3g mount option to control the mount option。

[Change Mount Missions] (./.gitbook/assets/dsbmd_customperm.png)
