# SECTION 23.2 ZFS

CURRENTLY ZFS IS ALMOST OPEN AND DOES NOT NEED ADDITIONAL CONFIGURATION。

# ZFS COMPRESSION

View the default compression format for FreeBSD 14:

```sh
root@ykla:~ # zfs get compression
NAME                PROPERTY     VALUE           SOURCE
zroot               compression  lz4             local
zroot/ROOT          compression  lz4             inherited from zroot
zroot/ROOT/default  compression  lz4             inherited from zroot
zroot/home          compression  lz4             inherited from zroot
zroot/home/ykla     compression  lz4             inherited from zroot
zroot/tmp           compression  lz4             inherited from zroot
zroot/usr           compression  lz4             inherited from zroot
zroot/usr/ports     compression  lz4             inherited from zroot
zroot/usr/src       compression  lz4             inherited from zroot
zroot/var           compression  lz4             inherited from zroot
zroot/var/audit     compression  lz4             inherited from zroot
zroot/var/crash     compression  lz4             inherited from zroot
zroot/var/log       compression  lz4             inherited from zroot
zroot/var/mail      compression  lz4             inherited from zroot
zroot/var/tmp       compression  lz4             inherited from zroot
```

replace zstd with:

```sh
root@ykla:/home/ykla # zfs set compression=zstd-5 zroot
```

View after restarting:

```sh
root@ykla:/home/ykla # zfs get compression
NAME                PROPERTY     VALUE           SOURCE
zroot               compression  zstd-5          local
zroot/ROOT          compression  zstd-5          inherited from zroot
zroot/ROOT/default  compression  zstd-5          inherited from zroot
zroot/home          compression  zstd-5          inherited from zroot
zroot/home/ykla     compression  zstd-5          inherited from zroot
zroot/tmp           compression  zstd-5          inherited from zroot
zroot/usr           compression  zstd-5          inherited from zroot
zroot/usr/ports     compression  zstd-5          inherited from zroot
zroot/usr/src       compression  zstd-5          inherited from zroot
zroot/var           compression  zstd-5          inherited from zroot
zroot/var/audit     compression  zstd-5          inherited from zroot
zroot/var/crash     compression  zstd-5          inherited from zroot
zroot/var/log       compression  zstd-5          inherited from zroot
zroot/var/mail      compression  zstd-5          inherited from zroot
zroot/var/tmp       compression  zstd-5          inherited from zroot
```

View actual compression rate:

```sh
root@ykla:/home/ykla # zfs get compressratio
NAME                PROPERTY       VALUE  SOURCE
zroot               compressratio  2.70x  -
zroot/ROOT          compressratio  2.68x  -
zroot/ROOT/default  compressratio  2.68x  -
zroot/home          compressratio  1.00x  -
zroot/home/ykla     compressratio  1.01x  -
zroot/tmp           compressratio  1.00x  -
zroot/usr           compressratio  2.73x  -
zroot/usr/ports     compressratio  1.00x  -
zroot/usr/src       compressratio  2.73x  -
zroot/var           compressratio  1.47x  -
zroot/var/audit     compressratio  1.00x  -
zroot/var/crash     compressratio  1.01x  -
zroot/var/log       compressratio  2.90x  -
zroot/var/mail      compressratio  1.00x  -
zroot/var/tmp       compressratio  1.00x  -
```

# ZFS PICS AND RETURNS

ZFS SNAPSHOTS ARE SIMILAR TO VIRTUAL。

- Create a snapshot

DEFAULT CREATION OF PARTITIONS (__CODESPAN_0_) AS FOLLOWS:

```sh
root@ykla:/home/ykla #  zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
zroot               1.72G   440G       96K  /zroot
zroot/ROOT          1004M   440G       96K  none
zroot/ROOT/default  1004M   440G     1004M  /
zroot/tmp            104K   440G      104K  /tmp
zroot/usr            760M   440G       96K  /usr
zroot/usr/home       128K   440G      128K  /usr/home
zroot/usr/ports       96K   440G       96K  /usr/ports
zroot/usr/src        759M   440G      759M  /usr/src
zroot/var            628K   440G       96K  /var
zroot/var/audit       96K   440G       96K  /var/audit
zroot/var/crash       96K   440G       96K  /var/crash
zroot/var/log        148K   440G      148K  /var/log
zroot/var/mail        96K   440G       96K  /var/mail
zroot/var/tmp         96K   440G       96K  /var/tmp
```

SNAPSHOT __CODESPAN_0 (TESTED TO REPRESENT THE ENTIRE ZFS FILE SYSTEM UNDER THE DEFAULT PARTITION MENTIONED ABOVE, __CODESPAN_1 _1 _ IS RECIPROCATED TO CREATE A SNAPSHOT, __CODESPAN_2 __ IS A RANDOM NAME):

```sh
root@ykla:/home/ykla # zfs snapshot -r zroot@test
root@ykla:/home/ykla # zfs list -t snap
NAME                      USED  AVAIL     REFER  MOUNTPOINT
zroot@test                  0B      -       96K  -
zroot/ROOT@test             0B      -       96K  -
zroot/ROOT/default@test     0B      -     7.18G  -
zroot/tmp@test              0B      -      176K  -
zroot/usr@test              0B      -       96K  -
zroot/usr/home@test         0B      -     31.1M  -
zroot/usr/ports@test        0B      -     1.98G  -
zroot/var@test              0B      -       96K  -
zroot/var/log@test          0B      -      444K  -
root@ykla:/home/ykla # ls /usr/ports/
CHANGES          archivers/       emulators/       misc/            textproc/
CONTRIBUTING.md  astro/           finance/         multimedia/      ukrainian/
COPYRIGHT        audio/           french/          net-im/          vietnamese/
GIDs             base/            ftp/             net-mgmt/        www/
INDEX-13         benchmarks/      games/           net-p2p/         x11-clocks/
Keywords/        biology/         german/          net/             x11-drivers/
MOVED            cad/             graphics/        news/            x11-fm/
Makefile         chinese/         hebrew/          polish/          x11-fonts/
Mk/              comms/           hungarian/       ports-mgmt/      x11-servers/
README           converters/      irc/             portuguese/      x11-themes/
Templates/       databases/       japanese/        print/           x11-toolkits/
Tools/           deskutils/       java/            russian/         x11-wm/
UIDs             devel/           korean/          science/         x11/
UPDATING         distfiles/       lang/            security/
accessibility/   dns/             mail/            shells/
arabic/          editors/         math/            sysutils/
root@ykla:/home/ykla # rm /usr/ports/
```

- Revert

The original snapshot cannot be returned at the time of its restoration and must be returned to each other (if you have a better solution, please tell us that there are some scripts available on the web):

Unlike virtual snapshots, in the default case, the ___CODESPAN_0 __ command cannot roll back to a snapshot other than the latest one (https://docs.oracle.com/cd/E19253-01/819-7065/gbxk/index.html), unless __CODESPAN_1 __ is used, but this removes all snapshots after the creation of the snapshot。

```sh
root@ykla:/home/ykla # zfs rollback -r zroot@test
root@ykla:/home/ykla # zfs rollback -r zroot/ROOT@test
root@ykla:/home/ykla # zfs rollback -r zroot/ROOT/default@test
root@ykla:/home/ykla # zfs rollback -r zroot/tmp@test
root@ykla:/home/ykla # zfs rollback -r zroot/usr@test
root@ykla:/home/ykla # zfs rollback -r zroot/usr/home@test
root@ykla:/home/ykla # zfs rollback -r zroot/usr/ports@test
root@ykla:/home/ykla # zfs rollback -r zroot/var@test
root@ykla:/home/ykla # zfs rollback -r zroot/var/log@test
```

- Destroy the snapshot

DESTRUCTION OF SNAPSHOTS (AVAILABLE FOR DESTRUCTION USING __CODESPAN_0_CMR):

```sh
root@ykla:/home/ykla # zfs destroy -r zroot@test
root@ykla:/home/ykla # zfs list -t snap
no datasets available
root@ykla:/home/ykla #

```

> __CODESPAN_0 __ CAN BE ABBREVIATED IN THE COMMAND AS __CODESPAN_1 __。


# Start environment

What is a start-up environment? Combine with snapshot and rollback, which is equivalent to jump-up at a time. A start-up environment is equivalent to a time line, a copy of a start-up environment is equivalent to another time line (the two start-up environments after the copy are independent of each other) and the switch between the start-up environments is the passage of two time lines (or parallel space). The default installed __CODESPAN_0 is the default startup environment。

```sh
# zfs snap zroot/ROOT/default@new                         # 建一个 zfs 快照
# zfs clone zroot/ROOT/default@new zroot/ROOT/new         # 用刚建的快照复制一个镜像
```

DUPLICATED MIRRORS CAN BE USED AS A STARTUP ENVIRONMENT TO VIEW AVAILABLE STARTUP ENVIRONMENTS WITH __CODESPAN_0_

```sh
# bectl list
BE                                Active Mountpoint Space Created
0915                              -      -          4.00M 2023-09-19 19:44
13.2-RELEASE-p2_2023-09-13_141111 -      -          29.0M 2023-09-13 14:11
new                               -      -          432K  2023-09-20 15:17
default                           NR     /          40.8G 2023-04-10 10:06
```

In this column __CODESPAN_0, __CODESPAN_1 is the current use of the environment, __CODESPAN_2 is the next use of the environment. __CODESPAN_3_To change the next start-up environment (check __CODESPAN_4_ or change the start-up environment when you start FreeBSD)

```sh
bectl activate new
Successfully activated boot environment new
```

View and observe changes in the Active column again with __CODESPAN_0_

```sh
bectl list
BE                                Active Mountpoint Space Created
0915                              -      -          4.00M 2023-09-19 19:44
13.2-RELEASE-p2_2023-09-13_141111 -      -          29.0M 2023-09-13 14:11
new                               R      /          2.84M 2023-09-20 15:17
default                           N      -          40.8G 2023-04-10 10:06
```

Restart FreeBSD (select __CODESPAN_0_in the start menu, or switch __CODESPAN_1_to the new start-up environment) and watch with __CODESPAN_2_, the installed root directory file system is `zroot/ROOT/new`_

```sh
# df
Filesystem          1K-blocks     Used     Avail Capacity  Mounted on
zroot/ROOT/new      110611616 42612156  67999460    39%    /
devfs                       1        1         0   100%    /dev
/dev/gpt/efiboot0      266176     1872    264304     1%    /boot/efi
fdescfs                     1        1         0   100%    /dev/fd
```

Switch back to __CODESPAN_0_, select the default start environment in the startup menu, or switch to __CODESPAN_1_to start the environment above

Expansion: A start-up environment can be upgraded to FreeBSD 14, with 13, 14 versions of co-existence。

>** Warning**
>
>The cost of using extension is that zfs cannot upgrade: the upgrade hangs up as soon as it is upgraded because the old version of the ZFS is not re-compatible backwards. Practice is of little significance and can be used only as a backup。

References

- [this post is part of our special coverage Libya Protests 2011]

# FreeBSD zfs zpool upgrade

13.2 to 14.0, the zpool version has been upgraded。

THIS ASSUMES THAT __CODESPAN_0_ HAS BEEN UPGRADED FROM 13.2 TO 14.0。

pre-start alert: prepare to livecd for accident, livecd for 14.0 and above, 13.2 does not support the zfs (not able to access new zfs file system) 14.0。

VIEW __CODESPAN_0_STATE:

```sh
root@u13t14 # zpool status

i'm sorry
stat state: ONLINE
some supported and relisted oceans are not available on the wall.
The poor can still be used, but some fishes are unviable.
once this is done,
that does not support
see zpool-features (7) for details.
config:

NAME STATE READ WRITE CKSUM
zroot ONLINE 0 0 0
a da0p3 ONLINE 0 0 0

no known data officers
````

none of the zfs' new features could be used before being upgraded. the following upgrades are made:

```sh
root@u13t14 # zpool upgrade zroot

This system supplies ZFS room safe flags.

Allowed the following impacts on 'zroot':
edonr
zilsaxattr
head_errlog
blake3
block_cloning
vdev_zaps_v2

Pool 'zroot' has the Boots policy set, you might need to update
see gptzfsboot (8) and loader.efi (8) for details.
````

# # REWRITE GUIDE (NOT EFI ONLY)

>** Warning**
>
The >`bootfs` attribute is an important sign that guides FreeBSD on the zfs, and it may be all right to ignore this hint, but it is not possible to direct the system when there is a problem, and it is suggested that __CODESPAN_1 be rewritten by the hint (why? ~ because I blew up ~ ). If you don't have the **freebsd-boot** partition, ** do not need** the following operation。

View partition information:

```sh
root@u13t14 # gpart show

=40 33554352 ada0 GPT (16G)
40 1024 1 freebsd-boot (512K)
1064 984 - free - (492K)
2048 4194304 2 freebsd-swap (2.0G)
4196352 29356032 3 freebsd-zfs (14G)
3355384 2008 - free - (1.0M)
````

FOUND __CODESPAN_0-TYPE PARTITION, SERIAL NUMBER __CODESPAN_1_, CORRESPONDING TO THE OPTION __CODESPAN_2_ IN THE FOLLOWING COMMAND, TO HIGHLIGHT __CODESPAN_3_:

```sh
root@u13t14 # gpart bootcode -p /boot/gptzfsboot -i 1 ada0
partcode written to ada0p1
```

SEE __CODESPAN_0_ STATUS AGAIN:

```sh
root@u13t14 # zpool status

i'm sorry
stat state: ONLINE
config:

NAME STATE READ WRITE CKSUM
zroot ONLINE 0 0 0
a da0p3 ONLINE 0 0 0

no known data officers
````

# user-level zfs administration

zfs allows non-privileged users to manage。

From FreeBSSD 14.1 by (see distribution notes, as modified by [Here] (https://cgit.freebsd.org/src/committee/?id=516009ce8d38), the tool used by CODESPAN_0_CODESPAN_1_1: When the parent directory of the user's master directory is on the zfs data set (i.e. if _CODESPAN_2_ is a zfs data set, as well as _CODESPAN_3_) a zfs data set is created for the user's home directory. Parameter __CODESPAN_4_ __CODESPAN_5_ may disable this act. __CODESPAN_6_ is also available for zfs' non-privileged home directory encryption。

THE FOLLOWING OPERATION IS BASED ON __CODESPAN_0_。

# # base user-level zfs administration

let's start with the zfs data set for unprivileged users。

when we first installed the system, we created two ordinary users, “aria2” and “safreya”。

```sh
safreya ~ % zfs list
NAME                                           USED  AVAIL  REFER  MOUNTPOINT
zroot                                         53.7G   396G    96K  /zroot
zroot/ROOT                                    12.8G   396G    96K  none
zroot/ROOT/14.1-RELEASE-p3_2024-09-17_194642     8K   396G  11.6G  /
zroot/ROOT/default                            12.8G   396G  11.9G  /
zroot/aria2                                    187M   396G   187M  /usr/local/data/aria2
zroot/home                                    7.74G   396G    96K  /home
zroot/home/aria2                               128K   396G   128K  /home/aria2   #请注意此行
zroot/home/safreya                            7.74G   396G  7.70G  /home/safreya #请注意此行
zroot/jails                                   3.12G   396G  3.12G  /usr/jails
zroot/sec                                     28.5G   396G  28.5G  /usr/local/data/sec
zroot/tmp                                      102M   396G   102M  /tmp
zroot/usr                                     1.34G   396G    96K  /usr
zroot/usr/ports                               1.34G   396G  1.34G  /usr/ports
zroot/usr/src                                   96K   396G    96K  /usr/src
zroot/var                                     1.58M   396G    96K  /var
zroot/var/audit                                 96K   396G    96K  /var/audit
zroot/var/crash                                 96K   396G    96K  /var/crash
zroot/var/log                                 1.02M   396G  1.02M  /var/log
zroot/var/mail                                 168K   396G   168K  /var/mail
zroot/var/tmp                                  120K   396G   120K  /var/tmp
safreya ~ %
```

Of which:

```sh
zroot/home/aria2                               128K   396G   128K  /home/aria2
zroot/home/safreya                            7.74G   396G  7.70G  /home/safreya
```

THAT IS, WHEN CREATING THE USER, THE USER __CODESPAN_0 AND __CODESPAN_1 HAVE BEEN CREATED BY DEFAULT FOR EACH OF THE RESPECTIVE SEPARATE DATA SETS __CODESPAN_2 AND __CODESPAN_3。

Next, look at the user privileges on each of the two data sets。

```sh
safreya ~ % zfs allow zroot/home/aria2
---- Permissions on zroot/home/aria2 ---------------------------------
Local+Descendent permissions:
        user aria2 create,destroy,mount,snapshot
safreya ~ % zfs allow zroot/home/safreya
---- Permissions on zroot/home/safreya -------------------------------
Local+Descendent permissions:
        user safreya create,destroy,mount,snapshot
```

IT CAN BE SEEN THAT, WHEN CREATING THE USER SET, THE DEFAULT CREATED FOUR PERMISSIONS __CODESPAN_0, __CODESPAN_1, __CODESPAN_2_ AND __CODESPAN_3_。

So, for both data sets, a snapshot can also be used by ordinary users:

```sh
safreya ~ % zfs snap zroot/home/safreya@snap1
safreya ~ % zfs list -t snap
NAME                                       USED  AVAIL  REFER  MOUNTPOINT
zroot/home/safreya@snap1                     0B      -  7.70G  -
```

AND LOOK AT THE FOLLOWING:

```sh
safreya ~ % zfs create zroot/home/safreya/dataset_1
cannot mount 'zroot/home/safreya/dataset_1': Insufficient privileges
filesystem successfully created, but not mounted
```

```sh
safreya ~ % su -m root -c 'sysctl vfs.usermount=1'
Password:
vfs.usermount: 0 -> 1
safreya ~ % zfs create zroot/home/safreya/dataset_2
safreya ~ % zfs list
NAME                                           USED  AVAIL  REFER  MOUNTPOINT
      ...此处省略一部分...

zroot/home 7.79G 396G 96K/home
zroot/home/ria2 128 K 396G 128K/home/ria2
zroot/home/safreya 7.79G 396G 7.68G/home/safreya
zroot/home/safreya/dataset_1 96K 396G 96K/home/safreya/dataset_1
zroot/home/safreya/dataset_2 96K 396G 96K/home/safreya/dataset_2
...a part of this omission...
````

```sh
safreya ~ % zfs destroy zroot/home/safreya/dataset_1
safreya ~ % zfs destroy zroot/home/safreya/dataset_2      
```

As you can see, creating (create) permissions and destroying (destroys) can be used in a normal way, but the mounted (mount) permissions need to open ___CODESPAN_0_ to allow the user-level mount。

Here, the user-level zfs management needs have been largely met. But if you're careful enough, you'll find that the __CODESPAN_0_ permissions are not available, and you can use root users to authorize normal user rollback privileges. Namely:

```sh
safreya ~ % zfs rollback zroot/home/safreya@snap1
cannot rollback 'zroot/home/safreya': permission denied
safreya ~ % su -m root -c 'zfs allow safreya rollback zroot/home/safreya'
Password:
safreya ~ % zfs rollback zroot/home/safreya@snap1
```

## # user-level zfs encryption

FreeBSD 14.1 uses zfs encryption at the user level and requires specific privileges for users。

```sh
safreya ~ % su -m root -c 'zfs allow safreya change-key,load-key,keyformat,keylocation,encryption zroot/home/safreya'
Password:
safreya ~ % zfs allow zroot/home/safreya
---- Permissions on zroot/home/safreya -------------------------------
Local+Descendent permissions:
        user safreya change-key,create,destroy,encryption,keyformat,keylocation,load-key,mount,snapshot
safreya ~ %
```

___ CODESPAN_0, __ CODESPAN_1, __ CODESPAN_2 , __ CODESPAN_3 __ and __ CODESPAN_4 __ are all used for zfs encryption。

NOW CREATE AN ENCRYPTED DATA SET __CODESPAN_0_:

```sh
safreya ~ % zfs create -o encryption=on -o keyformat=passphrase zroot/home/safreya/secret
Enter new passphrase:     #此处输入密码，密码不会回显，就是什么也没有
Re-enter new passphrase:  #此处重复输入上述密码，密码不会回显，就是什么也没有
```

Can not open message

```sh
safreya ~ % zfs get mounted zroot/home/safreya/secret
NAME                       PROPERTY  VALUE    SOURCE
zroot/home/safreya/secret  mounted   yes      -
```

VIEW THE __CODESPAN_0_ ATTRIBUTE, ENCRYPTED DATA SET CREATION IS MOUNTED, NOW CREATE A FILE AND UNMOUNT THE ENCRYPTED DATA SET:

```sh
safreya ~ % cd secret
safreya secret % echo "a secret makes a man mad" >abc.txt
safreya secret % cd ..
safreya ~ % zfs unmount zroot/home/safreya/secret
safreya ~ % zfs unload-key zroot/home/safreya/secret
safreya ~ % zfs get mounted zroot/home/safreya/secret
NAME                       PROPERTY  VALUE    SOURCE
zroot/home/safreya/secret  mounted   no       -
safreya ~ % ls secret #并无输出
safreya ~ %
```

Unmounting an encrypted data set must remember to also unload the key. Mount encryption data sets with keys:

```sh
safreya ~ % zfs load-key zroot/home/safreya/secret
Enter passphrase for 'zroot/home/safreya/secret':
safreya ~ % zfs mount zroot/home/safreya/secret
safreya ~ % ls secret
Permissions Size User    Date Modified Name
.rw-r--r--    25 safreya 19 Sep 20:26  abc.txt
```


Note**
>
>SUB-COMMAND __CODESPAN_0_, WHETHER OR NOT THE DATA SET IS MOUNTED, CAN SUCCESSFULLY DESTROY THE DATASET BECAUSE __CODESPAN_1 IS GRANTED BY DEFAULT, SO THAT IF IT IS NOT THE USER'S OWN OPERATING SYSTEM, THERE MAY BE A SITUATION WHERE “I CAN'T GET IT, DESTROY IT”。
>
> It is also important to remember that “authorization” is granted to an ordinary user's “agent permission” to operate an authorized data set that is equivalent to root and does not require a password. The delegation of competence is therefore subject to a combination of reasonable limitations on the scope of the authorization and the attributes of the authority, such as the disablement of the ___CODESPAN_0_ entitlement。

```sh
safreya ~ % su -m root -c 'zfs unallow safreya destroy zroot/home/safreya'
Password:
safreya ~ % zfs allow  zroot/home/safreya
---- Permissions on zroot/home/safreya -------------------------------
Local+Descendent permissions:
        user safreya change-key,create,encryption,keyformat,keylocation,load-key,mount,rollback,snapshot
```

HERE __CODESPAN_0 __ INHERITS THE AUTHORIZED PROPERTIES OF THE DATA SET __CODESPAN_1 __, BOTH FOR __CODESPAN_2 __ AND FOR THE OPERATION OF __CODESPAN_3 __ (AFTER THE OPERATIONAL PROPERTIES REMAIN UNCHANGED FOR UNKNOWN REASONS)。

## __CODESPAN_0_AND ENCRYPTED USER HOME DIRECTORY

__CODESPAN_0_ COMMANDS CAN DIRECTLY USE ENCRYPTED MASTER DIRECTORY DATASETS, BUT THE PERMISSIONS GIVEN BY DEFAULT ARE INSUFFICIENT TO BE MOUNTED DIRECTLY BY ORDINARY USERS ONCE UNMOUNTED

```sh
root safreya # adduser
Username: test
Full name:
Uid (Leave empty for default):
Login group [test]:
Login group is test. Invite test into other groups? []:
Login class [default]:
Shell (sh csh tcsh zsh rzsh git-shell bash rbash nologin) [sh]:
Home directory [/home/test]:
Home directory permissions (Leave empty for default):
Enable ZFS encryption? (yes/no) [no]: yes #该功能为新增功能
Use password-based authentication? [yes]:
Use an empty password? (yes/no) [no]:
Use a random password? (yes/no) [no]:
Enter password:
Enter password again:
Lock out the account after creation? [no]:
Username    : test
Password    : *****
Full Name   :
Uid         : 1003
ZFS dataset : zroot/home/test
Encrypted   : yes
Class       :
Groups      : test
Home        : /home/test
Home Mode   :
Shell       : /bin/sh
Locked      : no
OK? (yes/no) [yes]:
Enter encryption keyphrase for ZFS dataset (zroot/home/test):
Enter new passphrase:
Re-enter new passphrase:
adduser: INFO: Successfully created ZFS dataset (zroot/home/test).
adduser: INFO: Successfully added (test) to the user database.
Add another user? (yes/no) [no]: no
Goodbye!
```

Access:

```sh
root safreya # zfs allow zroot/home/test
---- Permissions on zroot/home/test ----------------------------------
Local+Descendent permissions:
        user test create,destroy,mount,snapshot
```

Unmount:

```sh
root safreya # zfs unmount zroot/home/test
root safreya # zfs unload-key  zroot/home/test
```

SWITCH TO NORMAL USER __CODESPAN_0_MOUNT ATTEMPTS:

```sh
# su test
$ zfs load-key zroot/home/test
Enter passphrase for 'zroot/home/test':
Key load error: Permission denied.
```

__CODESPAN_0_, I.E., INADEQUATE ACCESS, DENIED。


References


- [zfs-allow-delegateZFS accreditation missions to unprivileged users] (https://man.freebsd.org/cgi/man.cgi?zfs-allow)
- [zfs-create-create ZFSdataset]
(https://man.freebsd.org/cgi/man.cgi?zfs-create)
FreeBSD manual
- [OpenZFS Enscription Investments on FreeBSD] (https://freebsdfoundation.org/wp-content/uploads-2020/07/OpenZFS-Encryption-Arrives-on-FreeBSD.pdf), which illustrates the similarities and differences between GELI and zfs encryption
- [Merge OpenZFS support in to HEAD] (https://cgit.freebsd.org/src/committee/?id=9e5787d2284e), FreeBSD 13.0 was transferred to OpenZFS

Remarks

- ZFS does not use __CODESPAN_0, but EFI, Swap is still in use。
