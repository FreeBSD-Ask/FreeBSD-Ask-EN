# SECTION 13.4 SSH CONFIGURATION AND ASSOCIATED TOOLS

SSH, Secure Shell, Safe Shell, is by definition a safe use of Shell. Usually used for remote use。

# SSH TOOL

FreeBSD self-belt ssh, with access to other ssh installed devices, by:

```sh
$ ssh 用户名@IP:端口
```

For example:

```sh
$ ssh ykla@192.168.31.1:1022
```

>** Skills**
>
> CODESPAN_0_FreeBSD, which tty
>
> ```sh '
>$tty
> /dev/pts/1 # i.e. pseudo-terminal, pseudo terminal
> ````

# WinSCP #

__CODESPAN_0_i.e. Secure Copy, Safe Copy, by definition, is a safe use of __CODESPAN_1_. It is generally used for remote use to transmit files between different devices。

WinSCP is a graphical encapsulation software for the __CODESPAN_0_ command and supports many protocols such as FTP. You can quickly transfer between Windows and Linux or BSD files。

_Other Organiser

[https://winscp.net/eng/download.php]

Starting with OpenSSH 9.0, the scp command defaults the __CODESPAN_0_ protocol for file transfer. WinSCP default is __CODESPAN_1_。

However, this version is relevant to the operational system of the remote prosecution. FreeBSD view the built-in OpenSSH version:

```sh
root@ykla:~ # ssh -V
OpenSSH_9.7p1, OpenSSL 3.0.14 4 Jun 2024
```

The main version of the output above, OpenSSH, is 9.7 and the user can use WinSCP without any changes。

# Xshell #

Xshell is a powerful shell tool on Windows platforms. Support ** Serial**, SSH, Telnet

Xshell downloads address (enter username and email only):

[https://www.netsarang.com/zh/free-for-home-school] (https://www.netsarang.com/zh/free-for-home-school)

If a reminder needs to be re-verified, please open the above web site and reload it。


# MobaXterm

MobaXterm is a software that integrates SCP functions。

MobaXterm does not currently support Chinese, downloading address <https://mobaxterm.mobatek.net/download-home-education.html>, optional。

[MobaXterm](../.gitbook/assets/MobaXterm1.jpg)

[MobaXterm](../.gitbook/assets/MobaXterm2.jpg)

The actions are consistent with Xshell after selecting the mouse。

# Putty #

download address: <https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html>

The PuTTY interface, known as anti-human, does not support i18n ([chinese version of the house] (https://safe.it168.com/a2001/1305/00001305829.shtml)), nor does it guarantee its own safety ([CVE-2024-31497] (https://nvd.nist.gov/vuln/detail/CVE-2024-3147)), which is generally integrated into the indirect use of other software。

# Termius #

[Termius](..gitbook/assets/Termius.jpg)

Termius download address: <https://termius.com/download/>

Chinese is not currently supported and use requires login and registration。

Termius mouse behaviour is close to PuTTY, the same anti-human (choose shortcut or mouse). The right key doesn't come out of Xshell's behavior。

# CONFIGURE SSH

# # allow root to use ssh

>** Skills**
>
>Visual course [004-FreBSD14.2 Allow root login ssh] (https://www.bilibili.com/video/BV1gji2YLE2o)

edit "/etc/ssh/shd_config" (delete the previous # and modify yes or no to read as follows):

```ini
PermitRootLogin yes          # 允许 root 登录
PasswordAuthentication yes   #（可选）设置是否使用普通密码验证，如果不设置此参数则使用 PAM 认证登录，安全性更高
```


> ** troubleshooting and unfinished business**
>
> If you can't find __CODESPAN_0 __, please see if you've changed `/etc/ssh/`ssh***d***_CODESPAN_2 _ __ __CODESPAN_3***ssh***_CODESPAN_4 __. Ssh***d*** is the document we really want to change。

OPEN SSH SERVICE

```sh
# service sshd restart
```

IF THE HINT IS NOT FOUND __CODESPAN_0_, PLEASE EXECUTE THE FOLLOWING COMMAND:

```sh
# service sshd enable
```

And then..

```sh
# service sshd restart
```


# SSH KEY LOGIN

# # Generate key

```sh
# ssh-keygen
```

> OpenSSH 7.0 and above have by default disabled ssh-dss (DSA) public key algorithms. FreeBSSD 13.0 Adopt OpenSH\7.9. So use the default value。

```sh
root@ykla:~ # ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): #此处回车
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):    #此处输入密码（为了安全建议设置密码）
Enter same passphrase again:     #此处重复输入密码
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:MkcEjGhWCv6P/8y62JfbpEws9OnRN1W0adxmpceNny8 root@ykla
The key's randomart image is:
+---[RSA 2048]----+
|.  o.o...      ..|
|..+.. ..      o+*|
| +.     .     o*B|
|  .    .      o=.|
|   . .o S    . ..|
|    + o+o   .   .|
|   . o *.o o  E .|
|    + Bo= . .  . |
|   . ==O..       |
+----[SHA256]-----+
root@ykla:~ #

```

Configure key

Check permissions (the rights created by default are as follows):

```sh
drwx------  2 root  wheel   512 Mar 22 18:27 /root/.ssh #权限为 700
-rw-------  1 root  wheel  1856 Mar 22 18:27 /root/.ssh/id_rsa  #私钥，权限为 600
-rw-r--r--  1 root  wheel  391 Mar 22 18:27 /root/.ssh/id_rsa.pub #公钥，权限为 644
```

Generate authentication public key:

```sh
# cat /root/.ssh/id_rsa.pub >> /root/.ssh/authorized_keys
-rw-r--r--  1 root  wheel  391 Mar 22 18:39 /root/.ssh/authorized_keys #检查权限 644
```

use winscp to save private and public keys locally and remove redundant files from the server:

```sh
# rm /root/.ssh/id_rsa*
```

## MODIFY __CODESPAN_0_

```sh
# ee /etc/ssh/sshd_config
```

** FOUND ONE BY ONE (DISPERSED IN __CODESPAN_0)** AND MODIFIED AS NECESSARY TO: (DELETE __CODESPAN_1 __ AND MODIFY THE STATUS OF __CODESPAN_2 __ OR __CODESPAN_3 __ TO READ AS FOLLOWS):

```sh
PermitRootLogin yes                          #允许 ROOT 用户直接登录系统

AuthorizedKeysFile.ssh/authorized_keys #modify with the user directory key file, default is configured correctly and can be checked again

PasswordAuthment no # user is not allowed to login using password

ChallengeResponseAuthment no #bar password login authentication

PermitEmptyPasswords no #ban users with empty passwords
````

Restart service

```sh
# service sshd restart
```

Use xshell to log in, enter a key password, import a private key `id_rsa`, and log in。

> make your own key format if you cannot log in with other ssh software。

KEEP SSH LINE

# traditional screen

__CODESPAN_0_ MEANS "SCREEN" IN ENGLISH, WHICH IS TO PROVIDE YOU WITH A VIRTUAL SCREEN。

Installation:

```sh
# pkg install screen
```

Or:

```sh
# cd /usr/ports/sysutils/screen/
# make install clean
```

Methods of use:

```sh
# screen -S xxx
```

USING __CODESPAN_0... YOU CAN SPECIFY __CODESPAN_1_... AS A NAME THAT CAN BE EASILY FOUND。

then you can make a ssh connection and then you can close this window or software without affecting ssh。

see what running screen

```sh
root@ykla:/ # screen -ls
There are screens on:
	18380.pts-0.ykla	(Attached)
	70812.xxx	(Detached)
	67169.pts-0.ykla	(Detached)
3 Sockets in /tmp/screens/S-root.
```

__CODESPAN_0_IS DIRECTLY RECOVERABLE __CODESPAN_1_。

```sh
screen -r xxx
```

__CODESPAN_0_ MUST BE OFFLINE BEFORE RECOVERY:

```sh
root@ykla:/ # screen -d 18380
[18380.pts-0.ykla detached.]

root@ykla: / #screen-r 18380
````

# mosh: moving shell

`mosh`, __CODESPAN_1_, moved shell。

personally, mosh is really only suitable for off-site mobile phones, tablets via traffic remote control servers。

Mosh does not support multiple windows, screen break mode, multiple client connections to the same server. Mosh does not support reconnecting when the client restarts (or the user switches to different machines). To achieve the above, users are usually required to use terminal multiplex reusers such as GNU screen, OpenBSD tmux in Mosh sessions. — [Mosh: A State-of-the-Art Good Old-Fashioned Mobile Shell] (https://www.usenix.org/system/files/login/articles/winstein.pdf)


To use mosh:1 service and client needs to be configured with the same UTF-8 code,2 both need to install mosh。


```sh
# pkg install mosh
```

Or:

```sh
# cd /usr/ports/net/mosh/
# make install clean
```

EDIT __CODESPAN_0_, ADD:


- Default system:

```sh
me:\
        :charset=UTF-8:\
        :lang=en_US.UTF-8:\
        :setenv=LC_COLLATE=C:
```

- Systems of medium culture:

```sh
me:\
        :charset=UTF-8:\
        :lang=zh_US.CN-8:\
        :setenv=LC_COLLATE=zh_CN.UTF-8:
```

Your client needs the same setup, because it's a moving shell, so we're using the Android [JiceSSH] for testing。

download address: <https://play.google.com/store/apps/data?id=com.sonelli.juicessh>

[juicessh]

Click on Service-Purpose, set as follows:

```sh
mosh-server new -s -l LANG=zh_CN.UTF-8
```

other unchanged: the same user name, password and ssh. port 22 is also required for validation。


FreeBSD Open Port:

```sh
root@ykla:~ # sockstat -4l
USER     COMMAND    PID   FD  PROTO  LOCAL ADDRESS         FOREIGN ADDRESS      
root     mosh-serve 19493 4   udp4   192.168.31.187:60001  *:*
root     sshd        1140 4   tcp4   *:22                  *:*
ntpd     ntpd        1068 21  udp4   *:123                 *:*
ntpd     ntpd        1068 24  udp4   127.0.0.1:123         *:*
ntpd     ntpd        1068 26  udp4   192.168.31.187:123    *:*
root     syslogd     1017 7   udp4   *:514                 *:*
```

Based on the above output, it can be seen that my host port is 60001. [And you need to release 60000-61000] (https://mosh.org/#usage)。

Test connection:

[i'm a justicessh mosh]

[i'm a justicessh mosh]

[i'm a justicessh mosh]

Disconnected test:

[mosh of Juicessh Disconnect WiFi]

[mosh of Juicessh retores connection WiFi again]


AS YOU CAN SEE, THERE IS A HINT AFTER THE BREAKUP THAT THE RECONNECTION OF THE NETWORK IS AUTOMATICALLY RESTORED, AS IF IT HAD NOT BEEN BROKEN (USED IN COMBINATION WITH ___CODESPAN_0_)。


# References

- [mosh FAQ] (https://mosh.org/#faq)
- [ssh & mosh] (https://silbertmonaphia.github.io/ssh%E7%99%BB%E5%ED%95%E3%E3%AE%91%E5%E8%E8%E8%BE%BA-&-Mosh.html)
- [spp - OpenSSH security file copy] (https://man.openbsd.org/scp.1)
