# Section 13.4 SSH configuration and associated tools

SSH, Secure Shell, Safe Shell, is by definition a safe use of Shell. Usually used for remote use.

# SSH tool

FreeBSD self-belt ssh, with access to other ssh installed devices, by:

```sh '
$ ssh username@IP: port
````

For example:

```sh '
$ ssh ykla@192.168.31.1:1022
````

>** Skills**
>
> ssh 'FreeBSD, which ty?
>
> ```sh '
>$tty
> /dev/pts/1 # i.e. pseudo-terminal, pseudo terminal
> ````

# WinSCP #

`scp ' , or Secure Copy, is a safe reproduction, by definition, of a secure use of `cp ' orders. It is generally used for remote use to transmit files between different devices.

WinSCP is a graphical encapsulation software for the `scp ' command and supports many protocols, such as FTP. You can quickly transfer between Windows and Linux or BSD files.

_Other Organiser

[https://winscp.net/eng/download.php]

Starting with OpenSSH 9.0, the scp command defaults the `SFTP ' protocol for file transfer. WinSCP default is `SFTP ' .

However, this version is relevant to the operational system of the remote prosecution. FreeBSD view the built-in OpenSSH version:

```sh '
# ssh-V
OpenSSH_9.7p1, OpenSSL 3.5.14 4 Jun 2024
````

The main version of the output above, OpenSSH, is 9.7 and the user can use WinSCP without any changes.

# Xshell #

Xshell is a powerful shell tool on Windows platforms. Support ** Serial**, SSH, Telnet!

Xshell downloads address (enter username and email only):

[https://www.netsarang.com/zh/free-for-home-school] (https://www.netsarang.com/zh/free-for-home-school)

If a reminder needs to be re-verified, please open the above web site and reload it.


# MobaXterm

MobaXterm is a software that integrates SCP functions.

MobaXterm does not currently support Chinese, downloading address <https://mobaxterm.mobatek.net/download-home-education.html>, optional.

[MobaXterm](../.gitbook/assets/MobaXterm1.jpg)

[MobaXterm](../.gitbook/assets/MobaXterm2.jpg)

The actions are consistent with Xshell after selecting the mouse.

# Putty #

Download address: <https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html>

The PuTTY interface is well known as anti-human, and does not support i18n ([Chinese version in wood horses, etc.] (https://safe.it168.com/a2001/1305/0000305829.shtml) and its own safety is not guaranteed ([CVE-2024-31497] (https://nvd.nist.gov/vuln/detail/CVE-2024-3147)), which is generally integrated into indirect use of other software.

# Termius #

[Termius](..gitbook/assets/Termius.jpg)

Termius download address: <https://termius.com/download/>

Chinese is not currently supported and use requires login and registration.

Termius mouse behaviour is close to PuTTY, the same anti-human (choose shortcut or mouse). The right key doesn't come out of Xshell's behavior.

# Configure SSH

# # Allow root to use ssh

>** Skills**
>
>Video course [004-FreBSD14.2 allows root login ssh] (https://www.bilibili.com/video/BV1gji2YLE2o)

Edit "/etc/ssh/shd_config" (delete the previous # and modify yes or no to read as follows):

```ini '
PermitRootLogin yess
PasswordAuthentity yes #(optional) settings verify with normal passwords, use PAM to authenticate login if not set
````


> ** troubleshooting and unfinished business**
>
> If you really can't find `#PasswordAuthmentation no ' , please see if you have changed `/etc/ssh/`ssh***d*** `_config ' or `/etc/ssh/`***ssh*** `_config ' . Ssh***d*** is the document we really want to change.

Open SSH service

```sh '
# Service sshd restart
````

If the tip is not found, please execute the following command:

```sh '
♪ service sshd available
````

And then...

```sh '
# Service sshd restart
````


# SSH Key Login

# # Generate key

```sh '
# ssh-keygen
````

> OpenSSH 7.0 and above have by default disabled ssh-dss (DSA) public key algorithms. FreeBSSD 13.0 Adopt OpenSH\7.9. So use the default value.

```sh '
# ssh-keygen
I'm not sure.
Enter file in which which to save the key (/ root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase): # Enter password here (set password for security suggestions)
Enter same passphrase again: #Repeat password here
Your education has been saved in/root/.ssh/id_rsa.
Your public key has been saved in/root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256: McEjGhWCv6P/8y62Jfbps9OnRN1W0adxmpceNny8 root@ykla
The key's Randall image is:
+- [RSA 2048] - +
♪ O o o o o o ♪
.. * * * * *
+.
. . . . . . . . . . .
..o S . . . . . .
+o+o...
♪ O o o o E ♪
+ Bo=...
. = =
+ - [SHA256] - - +
Root@ykla:

````

Configure key

Check permissions (the rights created by default are as follows):

```sh '
Drwx -- - 2 root wheel 512 Mar 22 18:27 / root/.ssh # Permission 700
-rw -- -- 1 root wheel 1856 Mar 22 18:27 / root/.ssh/id_rsa# private key with 600 permission
-rw-r-r-r- 1 root water 391 Mar 22 18:27 / root/.ssh/id_rsa.pub# public key with permission 644
````

Generate authentication public key:

```sh '
#cat / root/.ssh/id_rsa.pub > / root/.ssh/authorized_keys
-rw-r-r-- 1 root water 391 Mar 22 18:39 / root/.ssh/authorized_keys # check access 644
````

Use winscp to save private and public keys locally and remove redundant files from the server:

```sh '
# rm / root/.ssh/id_rsa*
````

# # Modify `/etc/ssh/shd_config'

```sh '
#ee /etc/ssh/shd_config
````

** Found on a case-by-case basis (dispersed in `sshd_config ' )** and modified as necessary as follows (delete the previous `# ' and amend the status of `yes ' or `no ' to read as follows):

```sh '
PermitRootLogin yess #enable ROOT direct login system

AuthorizedKeysFile.ssh/authorized_keys #modify with the user directory key file, default is configured correctly and can be checked againPasswordAuthment no # user is not allowed to login using password

ChallengeResponseAuthment no #bar password login authentication

PermitEmptyPasswords no #ban users with empty passwords
````

Restart service

```sh '
# Service sshd restart
````

Use xshell login, enter a key password, import a private key `id_rsa ' and login.

> Make your own key format if you cannot log in with other ssh software.

Keep SSH line

# Traditional screen

`screen ' means "screen" in English, which means a virtual screen for you.

Installation:

```sh '
# Pkg install
````

Or:

```sh '
#cd/usr/ports/sysutils/screen/
# Make install clean
````

Methods of use:

```sh '
♪ Screen-S xx
````

Use `-S ' to designate `xx ' as a name that can be easily found.

Then you can make a ssh connection and then you can close this window or software without affecting ssh.

See what running screen?

```sh '
# root-ls
There are screens on:
18380.pts-0ykla (Attached)
70812.xx (Detched)
67169.pts-0ykla (Detached)
Sokets in /tmp/screens/S-root.
````

`Detched ' can be restored directly `-r ' .

```sh '
I don't know.
````

`Attached ' must be offline before it recovers:

```sh '
# screen-d 18380
[18380.pts-0ykla detached.]

Root@ykla: / #screen-r 18380
````

# mosh: moving shell

`mosh ' is `mobile shell ' , moving shell.

Personally, mosh is really only suitable for off-site mobile phones, tablets via traffic remote control servers.

Mosh does not support multiple windows, screen break mode, multiple client connections to the same server. Mosh does not support reconnecting when the client restarts (or the user switches to different machines). To achieve the above, users are usually required to use terminal multiplex reusers such as GNU screen, OpenBSD tmux in Mosh sessions. — [Mosh: A State-of-the-Art Good Old-Fashioned Mobile Shell] (https://www.usenix.org/system/files/login/articles/winstein.pdf)


To use mosh:1 service and client needs to be configured with the same UTF-8 code,2 both need to install mosh.


```sh '
# Pkg install mosh
````

Or:

```sh '
#cd/usr/ports/net/mosh/
# Make install clean
````

Edit ~/.login_conf ' , add:


- Default system:

```sh '
♪ Me: ♪
:charset=UTF-8:\
:lang=en_US.UTF-8:\
:setenv=LC_COLLATE=C:
````

- Systems of medium culture:

```sh '
♪ Me: ♪
:charset=UTF-8:\
:lang=zh_US.CN-8:\
:setenv=LC_COLLATE=zh_CN.UTF-8:
````

Your client needs the same setup, because it's a moving shell, so we're using the Android [JiceSSH] for testing.

Download address: <https://play.google.com/store/apps/data?id=com.sonelli.juicessh>

[juicessh]

Click on Service-Purpose, set as follows:

```sh '
Mosh-server new-s-l LANG=zh_CN.UTF-8
````

Other unchanged: the same user name, password and ssh. Port 22 is also required for validation.


FreeBSD Open Port:

```sh '
# sockstat-4l
USER COMMAND PID FD PROTO LOCAL ADDRESS FOREIGN ADDRESS
Root mosh-serve 19493 4 udp42.168.3187:60001*:*
♪ Root sshd 1140 4 tcp4 ♪ ♪ 22 ♪ ♪ ♪ ♪ and ♪ ♪ And then I'm like, ♪
*: 123*:*
ntpd ntpd 1068 24 udp 4 127.0.0.1:123 *:*
* *
♪ Root sysloged 1017 7 udp4 ♪
````

Based on the above output, it can be seen that my host port is 60001. [And you need to release 60000-61000] (https://mosh.org/#usage).

Test connection:

. ./.gitbook/assets/juicessh2.png

. ./ .gitbook/assets/juicessh3.png

.. ./.gitbook/assets/juicessh4.png)

Disconnected test:

. ./ .gitbook/assets/juicessh5.png

.. ./.gitbook/assets/juicessh6.png


It can be seen that there is a hint after the break-up that the reconnection of the network is automatically restored as if it had not been broken (used in conjunction with `screen ' ).


# References

- [mosh FAQ] (https://mosh.org/#faq)
- [ssh & & mosh] (https://silbertmonaphia.github.io/ssh%E7%99%BB%E5%ED%95%E3%E31%AE%5%E91%A8%E8%BE%BA-&-Mosh.html)
- [scp — OpenSSH security file copy] (https://man.openbsd.org/scp.1)
