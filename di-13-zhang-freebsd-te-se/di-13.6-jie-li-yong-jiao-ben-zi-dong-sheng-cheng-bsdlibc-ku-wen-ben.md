# Section 13.6 Automatically generate BSDlibc library text using scripts

# Forum programme

- Original address [where's bsd libc documentation?] (https://forums.freebsd.org/threads/wheres-bsd-libc-documentation.63107/).
- Author mrclksr.

The original programme has lapsed.

# Improvement programme

Improvements to the original programme:

- `if zgrep-q ' . lb libc' $i & & zgrep-q ' . Sh LIBRARY' dollar; then ' the question is `.Lb libc ' matches not just libc, but library starting with libcalendar, etc. You can correct this by writing '.Lb libc$ '
- The organization of the text is not properly organized, it is not a combination of functional modules, etc., and it is not appropriate for learning, but it is feasible for quick-checking.

I don't...

The required package is first installed.

- Install with pkg:

```sh '
# pkg install groff ghostscript10
````

- Or install with Ports:

```sh '
#cd /usr/ports/textproc/groff/ & make install clean
#cd /usr/ports/print/ghostscript10/ & make install clean
````

I don't...

Then do the script:

```sh '
#!/bin/sh
Fetch https://mirrors.ustc.edu.cn/freebsd/releases/amd/64/14.2-RELEASE/src.txz# Download src
*. # man2, man3
mv usr/ src/ lib/ libc libc# Decrease directory level
I don't know.
Find libc-name *. [23] > cont.list # Write man2, man3 path to center.list
Cat present.list sed-e 's/libc\//-e 's/\.*$/' | uniq |sort > level1.list# delete libc/ prefix, delete tail to/,
# The target is to keep the first level of path under the libc path and use it as the first level of directory
# create level1. list to adjust the order of rows in level 1.list to specify the order of sections
## # # # # # # # # # # # # # # # #

# Generate level 2.list as a level 2 directory, format path: title
# The inner cycle extracts the document title by grouping the level 1
# Write level2.list after each group is sorted by title
Cat /dev/null > level2.list # level2.list. Because I'm working over and over again.
For i in `cat level 1.list ' ;
Cat /dev/null >level15.list
For j in `grep "libc/$i" content.list ' ; do
Col2 = `cat $j | sed-n ' /. Sh NAME/, /. Sh/p' | egrep ' . Nd [^] + ' sed-e 's/^. Nd / / '-e 's/ '///g' #
epho $j: $col2 >level15.list
Don't do that.
Cat level15.list sort-t:-r-k2 > level2.list
Don't do that.
# Generate level 2.list to reorder rows in level 2.list to specify the order of subsections in the chapter
### # # # # # # # # # # #


# toc.mdoc for generating directories
#bookmark.info label for generating pdf
# index.list logs page numbers for every key word
# mktoc has to run twice, first obtains the number of pages in the directory and second uses the number of pages in the directory as an offset to calculate the full page number
mktoc(){
Cat /dev/null > toc.mdoc
Cat /dev/null > bookmark.info
Cat /dev/null > index.list
n=$1 # Start Page Number
xsflag=1
Chapterid = 0
For lv1 in `cat level 1.list ';do # group
Chapterid = $(Capterid + 1)
Sectionid = 0
== sync, corrected by elderman ==
echo "[[ / /Title ($lv1) / Page $n /Count $titlecount /View [/XYZ Null 0]/OUT pdfmark">bookmark.info#pdf
First = 1 # Directory, insert the name of the chapter before the subsections of each chapter, first to mark section 1
For Iv2 in `grep "libc/$" level 2.list cut-d:-f1'; do
title= `cat $lv2 | sed-n ' /.Sh NAME/, /.Sh/p ' | egrep ' .Nd [^] + 'sed-e 's/^.Nd / '-e 's/ '//g '#
Nextp=`mandoc-T ps $lv2 |egrep '%Pages: [0-9]+ 'cut-d: -f2 '# Counts
If [$first-eq 1];then # Insert title before section 1 of each chapter
If [$xsflag-eq 1];then # Chapter I, Section 1, is the first section of the entire directory using XS tags
 >.XS $n > toc.mdoc
Xsflag = 0
I'm sorry, else.
".XA $n" > toc.mdoc
F
echo "$chapterid. ${lv)> toc.mdoc# directory does not support multi-level directories, but only by tag
First=0
F
Sectionid = $((sectionid + 1))
echo ".XA $n" > toc.mdoc # Writes the number of the section page
echo ' ' '$sectionid. $title '> toc.mdoc# Writes subheadings
echo "[[ /Title ($title) / Page $n /View [/Fit] /OUT pdfmark" > bookmark.info#pdf
# There are several keywords in the section, key words and page numbers written to index.list
For key in `cat $lv2 sed-n ' /.ShNAME/, /.Sh/p' egrep ' .m [ +]' cut-d' "-f2 sort-n uniq ' ;
"$key:$n" >index.list
Don't do that.
n= 'expr $n + $textp '# Calculating New Page Numbers
Don't do that.
Don't do that.
Echo ".XE" > toc.mdoc# directory end mark
Echo ".PX" > toc.mdoc
> toc.ps# directory to ps format
♪ I'm sorry ♪

### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  # # # # # # # # # # # # # # # # # # # # # # # # # # # #  # # # # # # # # # # # #

# Each document is converted into a ps format and collled into a document with the Dd(document date) tag replaced with __PAGENO__ to replace it with a page number later
For lv2 in `cat level 2.list' cut-d:-f1 '; do
Cat $lv2 sed-e 's/\.Dd.*$/.Dd_PAGENO__/'-e'/.Os.*/d' mandoc-T ps > libc.ps
Don't do that.

### # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #  # # # # # # # # # # # # # # # # # # # # # # # # # # # #  # # # # # # # # # # # #
# Process page numbers
mktoc 1 # First page number of the text is 1
Tocpages = `cat toc.ps |egrep '%Pages: [0-9] + ' |cut-d: -f2 ' # Calculating directory occupied pages
Newstart = 'expr $tocpages + 1 '
mktoc $newstart # First page of text close to directory page number
Tocpages=`expr $tocpages + 0`# Convert to integer
Cat libc.ps wk-v p=$tocpages '
If ($0 ~ / (PAGENO\)/ {
t = sprintf("(%s)", +p);
sub(/(_PAGENO\)/, t);
♪ I'm sorry ♪
$ 0;
}' > libc.ps.tmp # Generates page numbers for each page
Cat libc.ps.tmp > > toc.ps # Spell toc.ps file, at this time toc.ps is complete


## # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #   # # #   #   # # #   #  #  #  # #  #  # # # # # #

# Generate an index in alphabetical order to key words and merge it with the chapter label
Sort-f index.list > index.list.tmp # Ignore case for keyword sorting
I don't know.
Cut-c 1 index.list tr[:upper:] [:lower:] | uniq > index.level1 # Extract the initials for index by letter
indexcount=`wc-l index.level1 |cut-w-f2`# Calculates a total of subsections (grouping)
echo "[[ / /Title(INDEX) /Count $indexcount /View [/XYZ Null Null 0]/OUT pdfmark" >bookmark.info# index to write to INDEX chapter label
".DS C" > prindex.mdoc
"INDEX" >printindex.mdoc
Echo ".DE" > prindex.mdoc
>prindindex.mdoc
echo "2C" > prindex.mdoc
".LB 0 0 0" >prindindex.mdoc
For a in `cat index.level1 ' ;do # Group in initial to index
# Compute the number of keywords per initial
echo "[[ / /Title ($a) /Count$account /View [/XYZ null 0]/OUT pdfmark" >bookmark.info # Group names
For i in `grep-i "$a" index.list ';do # each keyword writes a label
== sync, corrected by elderman ==
Page = `echo dollars cut-d:-f2'
echo "[ / /Title ($key) / Page $page /View [/XYZ null 0]/OUT pdfmark">bookmark.info
".LI" >printindex.mdoc
printf '%-40s %4d\n' "$key" $page >>printindex.mdoc
Don't do that.
Don't do that.
".LE" > prindex.mdoc
## # # # # # # # # # # # # # # # # # # # # # # #
>toc.ps
ps2pdf toc.ps # Convert to pdf without bookmarks
# Generate labeled libc.pdf with bookmark.info and unlabeled toc.pdf
gs-sDEVICE=pdfwrite-q-dBATCH-dNOPAUE-soutputfile=libc.pdf bookmark.info-f toc.pdf

*Content.listbookmark.info libc.ps libc.ps.tmp
````

# Available text

Runs a script to find PDF documents in the same path folder. Available documents see:

[https://github.com/FreeBSD-Ask/BSDlibc] (https://github.com/FreeBSD-Ask/BSDlibc)
